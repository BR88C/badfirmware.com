<!DOCTYPE html>
<html>
<head>
<title>badfirmware.com</title>
<meta name="description" content="All of the bad firmware, here.">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
<meta charset="utf-8"></head>
<body></body>
<script>!function n(i,a,o){function s(t,e){if(!a[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(f)return f(t,!0);throw(r=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",r}r=a[t]={exports:{}},i[t][0].call(r.exports,function(e){return s(i[t][1][e]||e)},r,r.exports,n,i,a,o)}return a[t].exports}for(var f="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,t,r){e=[e("./pages/dontFlySpirit.js"),e("./pages/life.js"),e("./pages/microphone.js"),e("./pages/particles.js"),e("./pages/pong.js"),e("./pages/sprites.js"),e("./pages/triangles.js")];e[Math.floor(Math.random()*e.length)].execute()},{"./pages/dontFlySpirit.js":204,"./pages/life.js":205,"./pages/microphone.js":206,"./pages/particles.js":207,"./pages/pong.js":208,"./pages/sprites.js":209,"./pages/triangles.js":210}],2:[function(e,t,r){"use strict";r.byteLength=function(e){var t=c(e),e=t[0],t=t[1];return 3*(e+t)/4-t},r.toByteArray=function(e){var t,r,n=c(e),i=n[0],n=n[1],a=new u(function(e,t){return 3*(e+t)/4-t}(i,n)),o=0,s=0<n?i-4:i;for(r=0;r<s;r+=4)t=f[e.charCodeAt(r)]<<18|f[e.charCodeAt(r+1)]<<12|f[e.charCodeAt(r+2)]<<6|f[e.charCodeAt(r+3)],a[o++]=t>>16&255,a[o++]=t>>8&255,a[o++]=255&t;2===n&&(t=f[e.charCodeAt(r)]<<2|f[e.charCodeAt(r+1)]>>4,a[o++]=255&t);1===n&&(t=f[e.charCodeAt(r)]<<10|f[e.charCodeAt(r+1)]<<4|f[e.charCodeAt(r+2)]>>2,a[o++]=t>>8&255,a[o++]=255&t);return a},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i=[],a=0,o=r-n;a<o;a+=16383)i.push(function(e,t,r){for(var n,i=[],a=t;a<r;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(function(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}(n));return i.join("")}(e,a,o<a+16383?o:a+16383));1==n?(t=e[r-1],i.push(s[t>>2]+s[t<<4&63]+"==")):2==n&&(t=(e[r-2]<<8)+e[r-1],i.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return i.join("")};for(var s=[],f=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,a=n.length;i<a;++i)s[i]=n[i],f[n.charCodeAt(i)]=i;function c(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("=");return-1===e&&(e=t),[e,e===t?0:4-e%4]}f["-".charCodeAt(0)]=62,f["_".charCodeAt(0)]=63},{}],3:[function(e,t,r){"use strict";function n(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&--t,t}r.INT_BITS=32,r.INT_MAX=2147483647,r.INT_MIN=-1<<31,r.sign=function(e){return(0<e)-(e<0)},r.abs=function(e){var t=e>>31;return(e^t)-t},r.min=function(e,t){return t^(e^t)&-(e<t)},r.max=function(e,t){return e^(e^t)&-(e<t)},r.isPow2=function(e){return!(e&e-1||!e)},r.log2=function(e){var t,r=(65535<e)<<4;return r|=t=(255<(e>>>=r))<<3,r|=t=(15<(e>>>=t))<<2,(r|=t=(3<(e>>>=t))<<1)|(e>>>=t)>>1},r.log10=function(e){return 1e9<=e?9:1e8<=e?8:1e7<=e?7:1e6<=e?6:1e5<=e?5:1e4<=e?4:1e3<=e?3:100<=e?2:10<=e?1:0},r.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},r.countTrailingZeros=n,r.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},r.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},r.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var i=new Array(256);!function(e){for(var t=0;t<256;++t){var r=t,n=t,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;e[t]=n<<i&255}}(i),r.reverse=function(e){return i[255&e]<<24|i[e>>>8&255]<<16|i[e>>>16&255]<<8|i[e>>>24&255]},r.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},r.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},r.interleave3=function(e,t,r){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},r.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},r.nextCombination=function(e){var t=e|e-1;return 1+t|(~t&-~t)-1>>>n(e)+1}},{}],4:[function(D,e,P){(function(e){(function(){"use strict";var s=D("base64-js"),a=D("ieee754");P.Buffer=l,P.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},P.INSPECT_MAX_BYTES=50;var t=2147483647;function i(e){if(t<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return e.__proto__=l.prototype,e}function l(e,t,r){if("number"!=typeof e)return n(e,t,r);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}function n(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|p(e,t),n=i(r),t=n.write(e,t);t!==r&&(n=n.slice(0,t));return n}(e,t);if(ArrayBuffer.isView(e))return u(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(S(e,ArrayBuffer)||e&&S(e.buffer,ArrayBuffer))return function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');r=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return r.__proto__=l.prototype,r}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return l.from(n,t,r);n=function(e){if(l.isBuffer(e)){var t=0|c(e.length),r=i(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(void 0!==e.length)return"number"!=typeof e.length||j(e.length)?i(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(e);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function o(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return o(e),i(e<0?0:0|c(e))}function u(e){for(var t=e.length<0?0:0|c(e.length),r=i(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function c(e){if(t<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+t.toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||S(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return T(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return C(e).length;default:if(i)return n?-1:T(e).length;t=(""+t).toLowerCase(),i=!0}}function r(e,t,r){var n,i,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0);(!r||r<0||n<r)&&(r=n);for(var i="",a=t;a<r;++a)i+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(e[a]);return i}(this,t,r);case"utf8":case"utf-8":return y(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return n=this,a=r,0===(i=t)&&a===n.length?s.fromByteArray(n):s.fromByteArray(n.slice(i,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}(this,t,r);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function h(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function d(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),j(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,r):m(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){var a=1,o=e.length,s=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o/=a=2,s/=2,r/=2}function f(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i)for(var u=-1,c=r;c<o;c++)if(f(e,c)===f(t,-1===u?0:c-u)){if(-1===u&&(u=c),c-u+1===s)return u*a}else-1!==u&&(c-=c-u),u=-1;else for(o<r+s&&(r=o-s),c=r;0<=c;c--){for(var l=!0,p=0;p<s;p++)if(f(e,c+p)!==f(t,p)){l=!1;break}if(l)return c}return-1}function g(e,t,r,n){return O(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function v(e,t,r,n){return O(function(e,t){for(var r,n,i=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,n=n%256,i.push(n),i.push(r);return i}(t,e.length-r),e,r,n)}function y(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,f,u=e[i],c=null,l=239<u?4:223<u?3:191<u?2:1;if(i+l<=r)switch(l){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&127<(f=(31&u)<<6|63&a)&&(c=f);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&2047<(f=(15&u)<<12|(63&a)<<6|63&o)&&(f<55296||57343<f)&&(c=f);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&65535<(f=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)&&f<1114112&&(c=f)}null===c?(c=65533,l=1):65535<c&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=l}return function(e){var t=e.length;if(t<=b)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=b));return r}(n)}P.kMaxLength=t,(l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),l.poolSize=8192,l.from=n,l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,l.alloc=function(e,t,r){return t=t,r=r,o(e=e),!(e<=0)&&void 0!==t?"string"==typeof r?i(e).fill(t,r):i(e).fill(t):i(e)},l.allocUnsafe=f,l.allocUnsafeSlow=f,l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(S(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),S(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);if(void 0===t)for(i=t=0;i<e.length;++i)t+=e[i].length;for(var r=l.allocUnsafe(t),n=0,i=0;i<e.length;++i){var a=e[i];if(S(a,Uint8Array)&&(a=l.from(a)),!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,n),n+=a.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)h(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},l.prototype.toLocaleString=l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?y(this,0,e):r.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",t=P.INSPECT_MAX_BYTES,e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim();return this.length>t&&(e+=" ... "),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(S(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(i<=n&&r<=t)return 0;if(i<=n)return-1;if(r<=t)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(a,o),f=this.slice(n,i),u=e.slice(t,r),c=0;c<s;++c)if(f[c]!==u[c]){a=f[c],o=u[c];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return d(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return d(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||i<r)&&(r=i),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var a,o,s,f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;(!n||i<(n=Number(n)))&&(n=i),(i=t.length)/2<n&&(n=i/2);for(var a=0;a<n;++a){var o=parseInt(t.substr(2*a,2),16);if(j(o))return a;e[r+a]=o}return a}(this,e,t,r);case"utf8":case"utf-8":return o=t,s=r,O(T(e,(a=this).length-o),a,o,s);case"ascii":return g(this,e,t,r);case"latin1":case"binary":return g(this,e,t,r);case"base64":return a=this,o=t,s=r,O(C(e),a,o,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v(this,e,t,r);default:if(f)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var b=4096;function w(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function A(e,t,r,n){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function _(e,t,r,n,i){return t=+t,r>>>=0,i||A(e,0,r,4),a.write(e,t,r,n,23,4),r+4}function k(e,t,r,n,i){return t=+t,r>>>=0,i||A(e,0,r,8),a.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e);t=this.subarray(e,t);return t.__proto__=l.prototype,t},l.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e+--t],i=1;0<t&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=t,i=1,a=this[e+--n];0<n&&(i*=256);)a+=this[e+--n]*i;return(i*=128)<=a&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);e=this[e]|this[e+1]<<8;return 32768&e?4294901760|e:e},l.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);e=this[e+1]|this[e]<<8;return 32768&e?4294901760|e:e},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),a.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),a.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),a.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),a.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||x(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||x(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;0<=--i&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,r,n){e=+e,t>>>=0,n||x(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var i=0,a=1,o=0;for(this[t]=255&e;++i<r&&(a*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/a>>0)-o&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){e=+e,t>>>=0,n||x(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var i=r-1,a=1,o=0;for(this[t+i]=255&e;0<=--i&&(a*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/a>>0)-o&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,r){return _(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return _(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return k(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return k(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r=r||0,n||0===n||(n=this.length),t>=e.length&&(t=e.length),t=t||0,0<n&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var a=i-1;0<=a;--a)e[a+t]=this[a+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);var i;1===e.length&&(i=e.charCodeAt(0),("utf8"===n&&i<128||"latin1"===n)&&(e=i))}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(e=e||0))for(a=t;a<r;++a)this[a]=e;else{var o=l.isBuffer(e)?e:l.from(e,n),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var E=/[^+/0-9A-Za-z-_]/g;function T(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if(55295<(r=e.charCodeAt(o))&&r<57344){if(!i){if(56319<r){-1<(t-=3)&&a.push(239,191,189);continue}if(o+1===n){-1<(t-=3)&&a.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(t-=3)&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(t-=3)&&a.push(239,191,189);if(i=null,r<128){if(--t<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function C(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(E,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function O(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function S(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function j(e){return e!=e}}).call(this)}).call(this,D("buffer").Buffer)},{"base64-js":2,buffer:4,ieee754:168}],5:[function(e,t,r){"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},{}],6:[function(e,t,r){"use strict";var i=e("color-rgba"),a=e("dtype");t.exports=function(e,t){"float"!==t&&t||(t="array"),"uint"===t&&(t="uint8"),"uint_clamped"===t&&(t="uint8_clamped");var r=new(a(t))(4),n="uint8"!==t&&"uint8_clamped"!==t;return e.length&&"string"!=typeof e||((e=i(e))[0]/=255,e[1]/=255,e[2]/=255),(t=e)instanceof Uint8Array||t instanceof Uint8ClampedArray||!!(Array.isArray(t)&&(1<t[0]||0===t[0])&&(1<t[1]||0===t[1])&&(1<t[2]||0===t[2])&&(!t[3]||1<t[3]))?(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=null!=e[3]?e[3]:255,n&&(r[0]/=255,r[1]/=255,r[2]/=255,r[3]/=255)):n?(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=null!=e[3]?e[3]:1):(r[0]=Math.min(Math.max(Math.floor(255*e[0]),0),255),r[1]=Math.min(Math.max(Math.floor(255*e[1]),0),255),r[2]=Math.min(Math.max(Math.floor(255*e[2]),0),255),r[3]=null==e[3]?255:Math.min(Math.max(Math.floor(255*e[3]),0),255)),r}},{"color-rgba":8,dtype:24}],7:[function(e,t,r){"use strict";var u=e("color-name");t.exports=function(e){var t,r,n=[],i=1;{var a,o,s,f;"string"==typeof e?u[e]?(n=u[e].slice(),r="rgb"):"transparent"===e?(r="rgb",n=[i=0,0,0]):/^#[A-Fa-f0-9]+$/.test(e)?(f=(s=e.slice(1)).length,i=1,f<=4?(n=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],4===f&&(i=parseInt(s[3]+s[3],16)/255)):(n=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],8===f&&(i=parseInt(s[6]+s[7],16)/255)),n[0]||(n[0]=0),n[1]||(n[1]=0),n[2]||(n[2]=0),r="rgb"):(t=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(e))?(a=t[1],o="rgb"===a,s=a.replace(/a$/,""),f="cmyk"===(r=s)?4:"gray"===s?1:3,n=t[2].trim().split(/\s*[,\/]\s*|\s+/).map(function(e,t){if(/%$/.test(e))return t===f?parseFloat(e)/100:"rgb"===s?255*parseFloat(e)/100:parseFloat(e);if("h"===s[t]){if(/deg$/.test(e))return parseFloat(e);if(void 0!==c[e])return c[e]}return parseFloat(e)}),a===s&&n.push(1),i=o||void 0===n[f]?1:n[f],n=n.slice(0,f)):10<e.length&&/[0-9](?:\s|\/)/.test(e)&&(n=e.match(/([0-9]+)/g).map(function(e){return parseFloat(e)}),r=e.match(/([a-z])/gi).join("").toLowerCase()):isNaN(e)?Array.isArray(e)||e.length?(n=[e[0],e[1],e[2]],r="rgb",i=4===e.length?e[3]:1):e instanceof Object&&(n=null!=e.r||null!=e.red||null!=e.R?(r="rgb",[e.r||e.red||e.R||0,e.g||e.green||e.G||0,e.b||e.blue||e.B||0]):(r="hsl",[e.h||e.hue||e.H||0,e.s||e.saturation||e.S||0,e.l||e.lightness||e.L||e.b||e.brightness]),i=e.a||e.alpha||e.opacity||1,null!=e.opacity&&(i/=100)):(r="rgb",n=[e>>>16,(65280&e)>>>8,255&e])}return{space:r,values:n,alpha:i}};var c={red:0,orange:60,yellow:120,green:180,blue:240,purple:300}},{"color-name":5}],8:[function(e,t,r){"use strict";var n=e("color-parse"),i=e("color-space/hsl");t.exports=function(e){Array.isArray(e)&&e.raw&&(e=String.raw.apply(null,arguments));var t=n(e);return t.space?((e=Array(3))[0]=Math.min(Math.max(t.values[0],0),255),e[1]=Math.min(Math.max(t.values[1],0),255),e[2]=Math.min(Math.max(t.values[2],0),255),"h"===t.space[0]&&(e=i.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e):[]}},{"color-parse":7,"color-space/hsl":9}],9:[function(e,t,r){"use strict";e=e("./rgb");t.exports={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(e){var t,r,n,i,a,o=e[0]/360,s=e[1]/100,e=e[2]/100;if(0==s)return[a=255*e,a,a];t=2*e-(r=e<.5?e*(1+s):e+s-e*s),i=[0,0,0];for(var f=0;f<3;f++)(n=o+1/3*-(f-1))<0?n++:1<n&&n--,a=6*n<1?t+6*(r-t)*n:2*n<1?r:3*n<2?t+(r-t)*(2/3-n)*6:t,i[f]=255*a;return i}},e.hsl=function(e){var t,r=e[0]/255,n=e[1]/255,i=e[2]/255,a=Math.min(r,n,i),o=Math.max(r,n,i),e=o-a;return o===a?t=0:r===o?t=(n-i)/e:n===o?t=2+(i-r)/e:i===o&&(t=4+(r-n)/e),(t=Math.min(60*t,360))<0&&(t+=360),n=(a+o)/2,[t,100*(o===a?0:n<=.5?e/(o+a):e/(2-o-a)),100*n]}},{"./rgb":10}],10:[function(e,t,r){"use strict";t.exports={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]}},{}],11:[function(e,t,r){t.exports=["xx-small","x-small","small","medium","large","x-large","xx-large","larger","smaller"]},{}],12:[function(e,t,r){t.exports=["normal","condensed","semi-condensed","extra-condensed","ultra-condensed","expanded","semi-expanded","extra-expanded","ultra-expanded"]},{}],13:[function(e,t,r){t.exports=["normal","italic","oblique"]},{}],14:[function(e,t,r){t.exports=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"]},{}],15:[function(e,t,r){"use strict";t.exports={parse:e("./parse"),stringify:e("./stringify")}},{"./parse":17,"./stringify":18}],16:[function(e,t,r){"use strict";var n=e("css-font-size-keywords");t.exports={isSize:function(e){return/^[\d\.]/.test(e)||-1!==e.indexOf("/")||-1!==n.indexOf(e)}}},{"css-font-size-keywords":11}],17:[function(e,t,r){"use strict";var a=e("unquote"),o=e("css-global-keywords"),s=e("css-system-font-keywords"),f=e("css-font-weight-keywords"),u=e("css-font-style-keywords"),c=e("css-font-stretch-keywords"),l=e("string-split-by"),p=e("./lib/util").isSize,h=(t.exports=n).cache={};function n(e){if("string"!=typeof e)throw new Error("Font argument must be a string.");if(h[e])return h[e];if(""===e)throw new Error("Cannot parse an empty string.");if(-1!==s.indexOf(e))return h[e]={system:e};for(var t,r={style:"normal",variant:"normal",weight:"normal",stretch:"normal",lineHeight:"normal",size:"1rem",family:["serif"]},n=l(e,/\s+/);t=n.shift();){if(-1!==o.indexOf(t))return["style","variant","weight","stretch"].forEach(function(e){r[e]=t}),h[e]=r;if(-1===u.indexOf(t))if("normal"!==t&&"small-caps"!==t)if(-1===c.indexOf(t)){if(-1===f.indexOf(t)){if(p(t)){var i=l(t,"/");if(r.size=i[0],null!=i[1]?r.lineHeight=d(i[1]):"/"===n[0]&&(n.shift(),r.lineHeight=d(n.shift())),!n.length)throw new Error("Missing required font-family.");return r.family=l(n.join(" "),/\s*,\s*/).map(a),h[e]=r}throw new Error("Unknown or unsupported font token: "+t)}r.weight=t}else r.stretch=t;else r.variant=t;else r.style=t}throw new Error("Missing required font-size.")}function d(e){var t=parseFloat(e);return t.toString()===e?t:e}},{"./lib/util":16,"css-font-stretch-keywords":12,"css-font-style-keywords":13,"css-font-weight-keywords":14,"css-global-keywords":19,"css-system-font-keywords":20,"string-split-by":180,unquote:194}],18:[function(e,t,r){"use strict";var n=e("pick-by-alias"),i=e("./lib/util").isSize,a=m(e("css-global-keywords")),o=m(e("css-system-font-keywords")),s=m(e("css-font-weight-keywords")),f=m(e("css-font-style-keywords")),u=m(e("css-font-stretch-keywords")),c={normal:1,"small-caps":1},l={serif:1,"sans-serif":1,monospace:1,cursive:1,fantasy:1,"system-ui":1},p="1rem",h="serif";function d(e,t){if(e&&!t[e]&&!a[e])throw Error("Unknown keyword `"+e+"`");return e}function m(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=1;return t}t.exports=function(e){if((e=n(e,{style:"style fontstyle fontStyle font-style slope distinction",variant:"variant font-variant fontVariant fontvariant var capitalization",weight:"weight w font-weight fontWeight fontweight",stretch:"stretch font-stretch fontStretch fontstretch width",size:"size s font-size fontSize fontsize height em emSize",lineHeight:"lh line-height lineHeight lineheight leading",family:"font family fontFamily font-family fontfamily type typeface face",system:"system reserved default global"})).system)return e.system&&d(e.system,o),e.system;if(d(e.style,f),d(e.variant,c),d(e.weight,s),d(e.stretch,u),null==e.size&&(e.size=p),"number"==typeof e.size&&(e.size+="px"),!i)throw Error("Bad size value `"+e.size+"`");e.family||(e.family=h),Array.isArray(e.family)&&(e.family.length||(e.family=[h]),e.family=e.family.map(function(e){return l[e]?e:'"'+e+'"'}).join(", "));var t=[];return t.push(e.style),e.variant!==e.style&&t.push(e.variant),e.weight!==e.variant&&e.weight!==e.style&&t.push(e.weight),e.stretch!==e.weight&&e.stretch!==e.variant&&e.stretch!==e.style&&t.push(e.stretch),t.push(e.size+(null==e.lineHeight||"normal"===e.lineHeight||e.lineHeight+""=="1"?"":"/"+e.lineHeight)),t.push(e.family),t.filter(Boolean).join(" ")}},{"./lib/util":16,"css-font-stretch-keywords":12,"css-font-style-keywords":13,"css-font-weight-keywords":14,"css-global-keywords":19,"css-system-font-keywords":20,"pick-by-alias":176}],19:[function(e,t,r){t.exports=["inherit","initial","unset"]},{}],20:[function(e,t,r){t.exports=["caption","icon","menu","message-box","small-caption","status-bar"]},{}],21:[function(e,t,r){"use strict";var n=e("type/value/is"),a=e("type/value/ensure"),o=e("type/plain-function/ensure"),s=e("es5-ext/object/copy"),i=e("es5-ext/object/normalize-options"),f=e("es5-ext/object/map"),u=Function.prototype.bind,c=Object.defineProperty,l=Object.prototype.hasOwnProperty,p=function(e,t,r){var n=a(t)&&o(t.value),i=s(t);return delete i.writable,delete i.value,i.get=function(){return!r.overwriteDefinition&&l.call(this,e)?n:(t.value=u.call(n,r.resolveContext?r.resolveContext(this):this),c(this,e,t),this[e])},i};t.exports=function(e){var r=i(arguments[1]);return n(r.resolveContext)&&o(r.resolveContext),f(e,function(e,t){return p(t,e,r)})}},{"es5-ext/object/copy":42,"es5-ext/object/map":50,"es5-ext/object/normalize-options":51,"type/plain-function/ensure":187,"type/value/ensure":191,"type/value/is":192}],22:[function(e,t,r){"use strict";var o=e("type/value/is"),a=e("type/plain-function/is"),s=e("es5-ext/object/assign"),f=e("es5-ext/object/normalize-options"),u=e("es5-ext/string/#/contains");(t.exports=function(e,t){var r,n,i,a;return arguments.length<2||"string"!=typeof e?(i=t,t=e,e=null):i=arguments[2],o(e)?(r=u.call(e,"c"),n=u.call(e,"e"),a=u.call(e,"w")):n=!(r=a=!0),a={value:t,configurable:r,enumerable:n,writable:a},i?s(f(i),a):a}).gs=function(e,t,r){var n,i;return"string"!=typeof e?(i=r,r=t,t=e,e=null):i=arguments[3],o(t)?a(t)?o(r)?a(r)||(i=r,r=void 0):r=void 0:(i=t,t=r=void 0):t=void 0,e=o(e)?(n=u.call(e,"c"),u.call(e,"e")):!(n=!0),e={get:t,set:r,configurable:n,enumerable:e},i?s(f(i),e):e}},{"es5-ext/object/assign":39,"es5-ext/object/normalize-options":51,"es5-ext/string/#/contains":58,"type/plain-function/is":188,"type/value/is":192}],23:[function(e,t,r){"use strict";var c=((t.exports=n).canvas=document.createElement("canvas")).getContext("2d"),l=p([32,126]);function n(e,t){Array.isArray(e)&&(e=e.join(", "));var r,n={},i=16,a=.05;t&&(2===t.length&&"number"==typeof t[0]?r=p(t):Array.isArray(t)?r=t:(t.o?r=p(t.o):t.pairs&&(r=t.pairs),t.fontSize&&(i=t.fontSize),null!=t.threshold&&(a=t.threshold))),r=r||l,c.font=i+"px "+e;for(var o=0;o<r.length;o++){var s=r[o],f=c.measureText(s[0]).width+c.measureText(s[1]).width,u=c.measureText(s).width;Math.abs(f-u)>i*a&&(f=(u-f)/i,n[s]=1e3*f)}return n}function p(e){for(var t=[],r=e[0];r<=e[1];r++)for(var n=String.fromCharCode(r),i=e[0];i<e[1];i++){var a=n+String.fromCharCode(i);t.push(a)}return t}n.createPairs=p,n.ascii=l},{}],24:[function(e,t,r){t.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},{}],25:[function(e,t,r){"use strict";t.exports=function(e,t){switch(void 0===t&&(t=0),typeof e){case"number":if(0<e)return function(e,t){for(var r=new Array(e),n=0;n<e;++n)r[n]=t;return r}(0|e,t);break;case"object":if("number"==typeof e.length)return function e(t,r,n){var i=0|t[n];if(i<=0)return[];var a,o=new Array(i);if(n===t.length-1)for(a=0;a<i;++a)o[a]=r;else for(a=0;a<i;++a)o[a]=e(t,r,n+1);return o}(e,t,0)}return[]}},{}],26:[function(e,t,r){"use strict";var n=e("../../object/valid-value");t.exports=function(){return n(this).length=0,this}},{"../../object/valid-value":57}],27:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Array.from:e("./shim")},{"./is-implemented":28,"./shim":29}],28:[function(e,t,r){"use strict";t.exports=function(){var e,t=Array.from;return"function"==typeof t&&(t=t(e=["raz","dwa"]),Boolean(t&&t!==e&&"dwa"===t[1]))}},{}],29:[function(e,t,r){"use strict";var h=e("es6-symbol").iterator,d=e("../../function/is-arguments"),m=e("../../function/is-function"),g=e("../../number/to-pos-integer"),v=e("../../object/valid-callable"),y=e("../../object/valid-value"),b=e("../../object/is-value"),w=e("../../string/is-string"),x=Array.isArray,A=Function.prototype.call,_={configurable:!0,enumerable:!0,writable:!0,value:null},k=Object.defineProperty;t.exports=function(e){var t,r,n,i,a,o,s,f,u,c,l=arguments[1],p=arguments[2];if(e=Object(y(e)),b(l)&&v(l),this&&this!==Array&&m(this))t=this;else{if(!l){if(d(e))return 1!==(a=e.length)?Array.apply(null,e):((i=new Array(1))[0]=e[0],i);if(x(e)){for(i=new Array(a=e.length),r=0;r<a;++r)i[r]=e[r];return i}}i=[]}if(!x(e))if(void 0!==(u=e[h])){for(s=v(u).call(e),t&&(i=new t),f=s.next(),r=0;!f.done;)c=l?A.call(l,p,f.value,r):f.value,t?(_.value=c,k(i,r,_)):i[r]=c,f=s.next(),++r;a=r}else if(w(e)){for(a=e.length,t&&(i=new t),n=r=0;r<a;++r)c=e[r],r+1<a&&55296<=(o=c.charCodeAt(0))&&o<=56319&&(c+=e[++r]),c=l?A.call(l,p,c,n):c,t?(_.value=c,k(i,n,_)):i[n]=c,++n;a=n}if(void 0===a)for(a=g(e.length),t&&(i=new t(a)),r=0;r<a;++r)c=l?A.call(l,p,e[r],r):e[r],t?(_.value=c,k(i,r,_)):i[r]=c;return t&&(_.value=null,i.length=a),i}},{"../../function/is-arguments":30,"../../function/is-function":31,"../../number/to-pos-integer":37,"../../object/is-value":46,"../../object/valid-callable":55,"../../object/valid-value":57,"../../string/is-string":61,"es6-symbol":70}],30:[function(e,t,r){"use strict";var n=Object.prototype.toString,i=n.call(function(){return arguments}());t.exports=function(e){return n.call(e)===i}},{}],31:[function(e,t,r){"use strict";var n=Object.prototype.toString,i=RegExp.prototype.test.bind(/^[object [A-Za-z0-9]*Function]$/);t.exports=function(e){return"function"==typeof e&&i(n.call(e))}},{}],32:[function(e,t,r){"use strict";t.exports=function(){}},{}],33:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Math.sign:e("./shim")},{"./is-implemented":34,"./shim":35}],34:[function(e,t,r){"use strict";t.exports=function(){var e=Math.sign;return"function"==typeof e&&(1===e(10)&&-1===e(-20))}},{}],35:[function(e,t,r){"use strict";t.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:0<e?1:-1}},{}],36:[function(e,t,r){"use strict";var n=e("../math/sign"),i=Math.abs,a=Math.floor;t.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?n(e)*a(i(e)):e}},{"../math/sign":33}],37:[function(e,t,r){"use strict";var n=e("./to-integer"),i=Math.max;t.exports=function(e){return i(0,n(e))}},{"./to-integer":36}],38:[function(e,t,r){"use strict";var s=e("./valid-callable"),f=e("./valid-value"),u=Function.prototype.bind,c=Function.prototype.call,l=Object.keys,p=Object.prototype.propertyIsEnumerable;t.exports=function(a,o){return function(r,n){var e,i=arguments[2],t=arguments[3];return r=Object(f(r)),s(n),e=l(r),t&&e.sort("function"==typeof t?u.call(t,r):void 0),"function"!=typeof a&&(a=e[a]),c.call(a,e,function(e,t){return p.call(r,e)?c.call(n,i,r[e],e,r,t):o})}}},{"./valid-callable":55,"./valid-value":57}],39:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.assign:e("./shim")},{"./is-implemented":40,"./shim":41}],40:[function(e,t,r){"use strict";t.exports=function(){var e=Object.assign;return"function"==typeof e&&(e(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},{}],41:[function(e,t,r){"use strict";var o=e("../keys"),s=e("../valid-value"),f=Math.max;t.exports=function(t,r){var n,e,i,a=f(arguments.length,2);for(t=Object(s(t)),i=function(e){try{t[e]=r[e]}catch(e){n=n||e}},e=1;e<a;++e)o(r=arguments[e]).forEach(i);if(void 0!==n)throw n;return t}},{"../keys":47,"../valid-value":57}],42:[function(e,t,r){"use strict";var a=e("../array/from"),o=e("./assign"),s=e("./valid-value");t.exports=function(t){var e=Object(s(t)),r=arguments[1],n=Object(arguments[2]);if(e!==t&&!r)return e;var i={};return r?a(r,function(e){(n.ensure||e in t)&&(i[e]=t[e])}):o(i,t),i}},{"../array/from":27,"./assign":39,"./valid-value":57}],43:[function(e,t,r){"use strict";var n,i,a,o,s=Object.create;e("./set-prototype-of/is-implemented")()||(n=e("./set-prototype-of/shim")),t.exports=!n||1!==n.level?s:(o={configurable:!(a={}),enumerable:!(i={}),writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){a[e]="__proto__"!==e?o:{configurable:!0,enumerable:!1,writable:!0,value:void 0}}),Object.defineProperties(i,a),Object.defineProperty(n,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:i}),function(e,t){return s(null===e?i:e,t)})},{"./set-prototype-of/is-implemented":53,"./set-prototype-of/shim":54}],44:[function(e,t,r){"use strict";t.exports=e("./_iterate")("forEach")},{"./_iterate":38}],45:[function(e,t,r){"use strict";var n=e("./is-value"),i={function:!0,object:!0};t.exports=function(e){return n(e)&&i[typeof e]||!1}},{"./is-value":46}],46:[function(e,t,r){"use strict";var n=e("../function/noop")();t.exports=function(e){return e!==n&&null!==e}},{"../function/noop":32}],47:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.keys:e("./shim")},{"./is-implemented":48,"./shim":49}],48:[function(e,t,r){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},{}],49:[function(e,t,r){"use strict";var n=e("../is-value"),i=Object.keys;t.exports=function(e){return i(n(e)?Object(e):e)}},{"../is-value":46}],50:[function(e,t,r){"use strict";var n=e("./valid-callable"),s=e("./for-each"),f=Function.prototype.call;t.exports=function(e,i){var a={},o=arguments[2];return n(i),s(e,function(e,t,r,n){a[t]=f.call(i,o,e,t,r,n)}),a}},{"./for-each":44,"./valid-callable":55}],51:[function(e,t,r){"use strict";var n=e("./is-value"),i=Array.prototype.forEach,a=Object.create;t.exports=function(e){var t=a(null);return i.call(arguments,function(e){n(e)&&function(e,t){for(var r in e)t[r]=e[r]}(Object(e),t)}),t}},{"./is-value":46}],52:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.setPrototypeOf:e("./shim")},{"./is-implemented":53,"./shim":54}],53:[function(e,t,r){"use strict";var n=Object.create,i=Object.getPrototypeOf,a={};t.exports=function(){var e=Object.setPrototypeOf;return"function"==typeof e&&i(e((arguments[0]||n)(null),a))===a}},{}],54:[function(e,t,r){"use strict";var n,i,a=e("../is-object"),o=e("../valid-value"),s=Object.prototype.isPrototypeOf,f=Object.defineProperty,u={configurable:!0,enumerable:!1,writable:!0,value:void 0},c=function(e,t){if(o(e),null===t||a(t))return e;throw new TypeError("Prototype must be null or an object")};t.exports=(n=function(){var e,t=Object.create(null),r={},n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(n){try{(e=n.set).call(t,r)}catch(e){}if(Object.getPrototypeOf(t)===r)return{set:e,level:2}}return t.__proto__=r,Object.getPrototypeOf(t)===r?{level:2}:((t={}).__proto__=r,Object.getPrototypeOf(t)===r&&{level:1})}())?(t=2===n.level?n.set?(i=n.set,function(e,t){return i.call(c(e,t),t),e}):function(e,t){return c(e,t).__proto__=t,e}:function e(t,r){var n;return c(t,r),(n=s.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,null===r&&(r=e.nullPolyfill),t.__proto__=r,n&&f(e.nullPolyfill,"__proto__",u),t},Object.defineProperty(t,"level",{configurable:!1,enumerable:!1,writable:!1,value:n.level})):null,e("../create")},{"../create":43,"../is-object":45,"../valid-value":57}],55:[function(e,t,r){"use strict";t.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},{}],56:[function(e,t,r){"use strict";var n=e("./is-object");t.exports=function(e){if(!n(e))throw new TypeError(e+" is not an Object");return e}},{"./is-object":45}],57:[function(e,t,r){"use strict";var n=e("./is-value");t.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},{"./is-value":46}],58:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?String.prototype.contains:e("./shim")},{"./is-implemented":59,"./shim":60}],59:[function(e,t,r){"use strict";var n="razdwatrzy";t.exports=function(){return"function"==typeof n.contains&&(!0===n.contains("dwa")&&!1===n.contains("foo"))}},{}],60:[function(e,t,r){"use strict";var n=String.prototype.indexOf;t.exports=function(e){return-1<n.call(this,e,arguments[1])}},{}],61:[function(e,t,r){"use strict";var n=Object.prototype.toString,i=n.call("");t.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||n.call(e)===i)||!1}},{}],62:[function(e,t,r){"use strict";var n=Object.create(null),i=Math.random;t.exports=function(){for(var e;e=i().toString(36).slice(2),n[e];);return e}},{}],63:[function(e,t,r){"use strict";var n=e("es5-ext/object/set-prototype-of"),i=e("es5-ext/string/#/contains"),a=e("d"),o=e("es6-symbol"),s=e("./"),f=Object.defineProperty,u=t.exports=function(e,t){if(!(this instanceof u))throw new TypeError("Constructor requires 'new'");s.call(this,e),t=t?i.call(t,"key+value")?"key+value":i.call(t,"key")?"key":"value":"value",f(this,"__kind__",a("",t))};n&&n(u,s),delete u.prototype.constructor,u.prototype=Object.create(s.prototype,{_resolve:a(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),f(u.prototype,o.toStringTag,a("c","Array Iterator"))},{"./":66,d:22,"es5-ext/object/set-prototype-of":52,"es5-ext/string/#/contains":58,"es6-symbol":70}],64:[function(e,t,r){"use strict";var l=e("es5-ext/function/is-arguments"),p=e("es5-ext/object/valid-callable"),h=e("es5-ext/string/is-string"),d=e("./get"),m=Array.isArray,g=Function.prototype.call,v=Array.prototype.some;t.exports=function(e,t){var r,n,i,a,o,s,f,u,c=arguments[2];if(m(e)||l(e)?r="array":h(e)?r="string":e=d(e),p(t),i=function(){a=!0},"array"!==r)if("string"!==r)for(n=e.next();!n.done;){if(g.call(t,c,n.value,i),a)return;n=e.next()}else for(s=e.length,o=0;o<s&&(f=e[o],o+1<s&&55296<=(u=f.charCodeAt(0))&&u<=56319&&(f+=e[++o]),g.call(t,c,f,i),!a);++o);else v.call(e,function(e){return g.call(t,c,e,i),a})}},{"./get":65,"es5-ext/function/is-arguments":30,"es5-ext/object/valid-callable":55,"es5-ext/string/is-string":61}],65:[function(e,t,r){"use strict";var n=e("es5-ext/function/is-arguments"),i=e("es5-ext/string/is-string"),a=e("./array"),o=e("./string"),s=e("./valid-iterable"),f=e("es6-symbol").iterator;t.exports=function(e){return"function"==typeof s(e)[f]?e[f]():new(!n(e)&&i(e)?o:a)(e)}},{"./array":63,"./string":68,"./valid-iterable":69,"es5-ext/function/is-arguments":30,"es5-ext/string/is-string":61,"es6-symbol":70}],66:[function(e,t,r){"use strict";var n,i=e("es5-ext/array/#/clear"),a=e("es5-ext/object/assign"),o=e("es5-ext/object/valid-callable"),s=e("es5-ext/object/valid-value"),f=e("d"),u=e("d/auto-bind"),c=e("es6-symbol"),l=Object.defineProperty,p=Object.defineProperties;t.exports=n=function(e,t){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");p(this,{__list__:f("w",s(e)),__context__:f("w",t),__nextIndex__:f("w",0)}),t&&(o(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete n.prototype.constructor,p(n.prototype,a({_next:f(function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:f(function(){return this._createResult(this._next())}),_createResult:f(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:f(function(e){return this.__list__[e]}),_unBind:f(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:f(function(){return"[object "+(this[c.toStringTag]||"Object")+"]"})},u({_onAdd:f(function(r){r>=this.__nextIndex__||(++this.__nextIndex__,this.__redo__?(this.__redo__.forEach(function(e,t){r<=e&&(this.__redo__[t]=++e)},this),this.__redo__.push(r)):l(this,"__redo__",f("c",[r])))}),_onDelete:f(function(r){var e;r>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(e=this.__redo__.indexOf(r))&&this.__redo__.splice(e,1),this.__redo__.forEach(function(e,t){r<e&&(this.__redo__[t]=--e)},this)))}),_onClear:f(function(){this.__redo__&&i.call(this.__redo__),this.__nextIndex__=0})}))),l(n.prototype,c.iterator,f(function(){return this}))},{d:22,"d/auto-bind":21,"es5-ext/array/#/clear":26,"es5-ext/object/assign":39,"es5-ext/object/valid-callable":55,"es5-ext/object/valid-value":57,"es6-symbol":70}],67:[function(e,t,r){"use strict";var n=e("es5-ext/function/is-arguments"),i=e("es5-ext/object/is-value"),a=e("es5-ext/string/is-string"),o=e("es6-symbol").iterator,s=Array.isArray;t.exports=function(e){return!!i(e)&&(!!s(e)||(!!a(e)||(!!n(e)||"function"==typeof e[o])))}},{"es5-ext/function/is-arguments":30,"es5-ext/object/is-value":46,"es5-ext/string/is-string":61,"es6-symbol":70}],68:[function(e,t,r){"use strict";var n=e("es5-ext/object/set-prototype-of"),i=e("d"),a=e("es6-symbol"),o=e("./"),s=Object.defineProperty,f=t.exports=function(e){if(!(this instanceof f))throw new TypeError("Constructor requires 'new'");e=String(e),o.call(this,e),s(this,"__length__",i("",e.length))};n&&n(f,o),delete f.prototype.constructor,f.prototype=Object.create(o.prototype,{_next:i(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:i(function(e){var t=this.__list__[e];return this.__nextIndex__!==this.__length__&&55296<=(e=t.charCodeAt(0))&&e<=56319?t+this.__list__[this.__nextIndex__++]:t})}),s(f.prototype,a.toStringTag,i("c","String Iterator"))},{"./":66,d:22,"es5-ext/object/set-prototype-of":52,"es6-symbol":70}],69:[function(e,t,r){"use strict";var n=e("./is-iterable");t.exports=function(e){if(!n(e))throw new TypeError(e+" is not iterable");return e}},{"./is-iterable":67}],70:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?e("ext/global-this").Symbol:e("./polyfill")},{"./is-implemented":71,"./polyfill":76,"ext/global-this":83}],71:[function(e,t,r){"use strict";var n=e("ext/global-this"),i={object:!0,symbol:!0};t.exports=function(){var e,t=n.Symbol;if("function"!=typeof t)return!1;e=t("test symbol");try{String(e)}catch(e){return!1}return!!i[typeof t.iterator]&&(!!i[typeof t.toPrimitive]&&!!i[typeof t.toStringTag])}},{"ext/global-this":83}],72:[function(e,t,r){"use strict";t.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&("Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag]))}},{}],73:[function(e,t,r){"use strict";var i=e("d"),e=Object.create,a=Object.defineProperty,o=Object.prototype,s=e(null);t.exports=function(e){for(var t,r,n=0;s[e+(n||"")];)++n;return s[e+=n||""]=!0,a(o,t="@@"+e,i.gs(null,function(e){r||(r=!0,a(this,t,i(e)),r=!1)})),t}},{d:22}],74:[function(e,t,r){"use strict";var n=e("d"),i=e("ext/global-this").Symbol;t.exports=function(e){return Object.defineProperties(e,{hasInstance:n("",i&&i.hasInstance||e("hasInstance")),isConcatSpreadable:n("",i&&i.isConcatSpreadable||e("isConcatSpreadable")),iterator:n("",i&&i.iterator||e("iterator")),match:n("",i&&i.match||e("match")),replace:n("",i&&i.replace||e("replace")),search:n("",i&&i.search||e("search")),species:n("",i&&i.species||e("species")),split:n("",i&&i.split||e("split")),toPrimitive:n("",i&&i.toPrimitive||e("toPrimitive")),toStringTag:n("",i&&i.toStringTag||e("toStringTag")),unscopables:n("",i&&i.unscopables||e("unscopables"))})}},{d:22,"ext/global-this":83}],75:[function(e,t,r){"use strict";var n=e("d"),i=e("../../../validate-symbol"),a=Object.create(null);t.exports=function(t){return Object.defineProperties(t,{for:n(function(e){return a[e]||(a[e]=t(String(e)))}),keyFor:n(function(e){for(var t in i(e),a)if(a[t]===e)return t})})}},{"../../../validate-symbol":77,d:22}],76:[function(e,t,r){"use strict";var n,i,a,o=e("d"),s=e("./validate-symbol"),f=e("ext/global-this").Symbol,u=e("./lib/private/generate-name"),c=e("./lib/private/setup/standard-symbols"),l=e("./lib/private/setup/symbol-registry"),p=Object.create,h=Object.defineProperties,e=Object.defineProperty;if("function"==typeof f)try{String(f()),a=!0}catch(e){}else f=null;i=function(e){if(this instanceof i)throw new TypeError("Symbol is not a constructor");return n(e)},t.exports=n=function e(t){var r;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return a?f(t):(r=p(i.prototype),t=void 0===t?"":String(t),h(r,{__description__:o("",t),__name__:o("",u(t))}))},c(n),l(n),h(i.prototype,{constructor:o(n),toString:o("",function(){return this.__name__})}),h(n.prototype,{toString:o(function(){return"Symbol ("+s(this).__description__+")"}),valueOf:o(function(){return s(this)})}),e(n.prototype,n.toPrimitive,o("",function(){var e=s(this);return"symbol"==typeof e?e:e.toString()})),e(n.prototype,n.toStringTag,o("c","Symbol")),e(i.prototype,n.toStringTag,o("c",n.prototype[n.toStringTag])),e(i.prototype,n.toPrimitive,o("c",n.prototype[n.toPrimitive]))},{"./lib/private/generate-name":73,"./lib/private/setup/standard-symbols":74,"./lib/private/setup/symbol-registry":75,"./validate-symbol":77,d:22,"ext/global-this":83}],77:[function(e,t,r){"use strict";var n=e("./is-symbol");t.exports=function(e){if(!n(e))throw new TypeError(e+" is not a symbol");return e}},{"./is-symbol":72}],78:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?WeakMap:e("./polyfill")},{"./is-implemented":79,"./polyfill":81}],79:[function(e,t,r){"use strict";t.exports=function(){var e,t;if("function"!=typeof WeakMap)return!1;try{e=new WeakMap([[t={},"one"],[{},"two"],[{},"three"]])}catch(e){return!1}return"[object WeakMap]"===String(e)&&("function"==typeof e.set&&(e.set({},1)===e&&("function"==typeof e.delete&&("function"==typeof e.has&&"one"===e.get(t)))))}},{}],80:[function(e,t,r){"use strict";t.exports="function"==typeof WeakMap&&"[object WeakMap]"===Object.prototype.toString.call(new WeakMap)},{}],81:[function(e,t,r){"use strict";var n,i=e("es5-ext/object/is-value"),a=e("es5-ext/object/set-prototype-of"),o=e("es5-ext/object/valid-object"),s=e("es5-ext/object/valid-value"),f=e("es5-ext/string/random-uniq"),u=e("d"),c=e("es6-iterator/get"),l=e("es6-iterator/for-of"),p=e("es6-symbol").toStringTag,h=e("./is-native-implemented"),d=Array.isArray,m=Object.defineProperty,g=Object.prototype.hasOwnProperty,v=Object.getPrototypeOf;t.exports=n=function(){var t,e=arguments[0];if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");return t=h&&a&&WeakMap!==n?a(new WeakMap,v(this)):this,i(e)&&(d(e)||(e=c(e))),m(t,"__weakMapData__",u("c","$weakMap$"+f())),e&&l(e,function(e){s(e),t.set(e[0],e[1])}),t},h&&(a&&a(n,WeakMap),n.prototype=Object.create(WeakMap.prototype,{constructor:u(n)})),Object.defineProperties(n.prototype,{delete:u(function(e){return!!g.call(o(e),this.__weakMapData__)&&(delete e[this.__weakMapData__],!0)}),get:u(function(e){if(g.call(o(e),this.__weakMapData__))return e[this.__weakMapData__]}),has:u(function(e){return g.call(o(e),this.__weakMapData__)}),set:u(function(e,t){return m(o(e),this.__weakMapData__,u("c",t)),this}),toString:u(function(){return"[object WeakMap]"})}),m(n.prototype,p,u("c","WeakMap"))},{"./is-native-implemented":80,d:22,"es5-ext/object/is-value":46,"es5-ext/object/set-prototype-of":52,"es5-ext/object/valid-object":56,"es5-ext/object/valid-value":57,"es5-ext/string/random-uniq":62,"es6-iterator/for-of":64,"es6-iterator/get":65,"es6-symbol":70}],82:[function(e,t,r){function n(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")}t.exports=function(){if(this)return this;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return n()}try{return __global__?__global__:n()}finally{delete Object.prototype.__global__}}()},{}],83:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?globalThis:e("./implementation")},{"./implementation":82,"./is-implemented":84}],84:[function(e,t,r){"use strict";t.exports=function(){return"object"==typeof globalThis&&(!!globalThis&&globalThis.Array===Array)}},{}],85:[function(e,t,r){var c=e("dtype");t.exports=function(e,t,r){if(!e)throw new TypeError("must specify data as first parameter");if(r=0|+(r||0),Array.isArray(e)&&e[0]&&"number"==typeof e[0][0]){var n,i,a,o,s=e[0].length,f=e.length*s;t&&"string"!=typeof t||(t=new(c(t||"float32"))(f+r));var u=t.length-r;if(f!=u)throw new Error("source length "+f+" ("+s+"x"+e.length+") does not match destination length "+u);for(n=0,a=r;n<e.length;n++)for(i=0;i<s;i++)t[a++]=null===e[n][i]?NaN:e[n][i]}else if(t&&"string"!=typeof t)t.set(e,r);else{u=c(t||"float32");if(Array.isArray(e)||"array"===t)for(t=new u(e.length+r),n=0,a=r,o=t.length;a<o;a++,n++)t[a]=null===e[n]?NaN:e[n];else 0===r?t=new u(e):(t=new u(e.length+r)).set(e,r)}return t}},{dtype:24}],86:[function(e,t,r){"use strict";var p=e("css-font/stringify"),h=[32,126];t.exports=function(e){var t=(e=e||{}).shape?e.shape:e.canvas?[e.canvas.width,e.canvas.height]:[512,512],r=e.canvas||document.createElement("canvas"),n=e.font,i="number"==typeof e.step?[e.step,e.step]:e.step||[32,32],a=e.chars||h;n&&"string"!=typeof n&&(n=p(n));if(Array.isArray(a)){if(2===a.length&&"number"==typeof a[0]&&"number"==typeof a[1]){for(var o=[],s=a[0],f=0;s<=a[1];s++)o[f++]=String.fromCharCode(s);a=o}}else a=String(a).split("");t=t.slice(),r.width=t[0],r.height=t[1];var u=r.getContext("2d");u.fillStyle="#000",u.fillRect(0,0,r.width,r.height),u.font=n,u.textAlign="center",u.textBaseline="middle",u.fillStyle="#fff";for(var c=i[0]/2,l=i[1]/2,s=0;s<a.length;s++)u.fillText(a[s],c,l),(c+=i[0])>t[0]-i[0]/2&&(c=i[0]/2,l+=i[1]);return r}},{"css-font/stringify":18}],87:[function(e,t,r){"use strict";function l(e,t){t=t||{},"string"!=typeof e&&!Array.isArray(e)||(t.family=e);var r=Array.isArray(t.family)?t.family.join(", "):t.family;if(!r)throw Error("`family` must be defined");var n=t.size||t.fontSize||t.em||48,i=t.weight||t.fontWeight||"",e=[t.style||t.fontStyle||"",i,n].join(" ")+"px "+r,a=t.origin||"top";if(l.cache[r]&&n<=l.cache[r].em)return p(l.cache[r],a);var o=t.canvas||l.canvas,s=o.getContext("2d"),f={upper:void 0!==t.upper?t.upper:"H",lower:void 0!==t.lower?t.lower:"x",descent:void 0!==t.descent?t.descent:"p",ascent:void 0!==t.ascent?t.ascent:"h",tittle:void 0!==t.tittle?t.tittle:"i",overshoot:void 0!==t.overshoot?t.overshoot:"O"},i=Math.ceil(1.5*n);o.height=i,o.width=.5*i,s.font=e;var u={top:0};s.clearRect(0,0,i,i),s.textBaseline="top",s.fillStyle="black",s.fillText("H",0,0);t=h(s.getImageData(0,0,i,i));s.clearRect(0,0,i,i),s.textBaseline="bottom",s.fillText("H",0,i);o=h(s.getImageData(0,0,i,i));u.lineHeight=u.bottom=i-o+t,s.clearRect(0,0,i,i),s.textBaseline="alphabetic",s.fillText("H",0,i);e=i-h(s.getImageData(0,0,i,i))-1+t;u.baseline=u.alphabetic=e,s.clearRect(0,0,i,i),s.textBaseline="middle",s.fillText("H",0,.5*i);o=h(s.getImageData(0,0,i,i));u.median=u.middle=i-o-1+t-.5*i,s.clearRect(0,0,i,i),s.textBaseline="hanging",s.fillText("H",0,.5*i);o=h(s.getImageData(0,0,i,i));u.hanging=i-o-1+t-.5*i,s.clearRect(0,0,i,i),s.textBaseline="ideographic",s.fillText("H",0,i);var c,o=h(s.getImageData(0,0,i,i));for(c in u.ideographic=i-o-1+t,f.upper&&(s.clearRect(0,0,i,i),s.textBaseline="top",s.fillText(f.upper,0,0),u.upper=h(s.getImageData(0,0,i,i)),u.capHeight=u.baseline-u.upper),f.lower&&(s.clearRect(0,0,i,i),s.textBaseline="top",s.fillText(f.lower,0,0),u.lower=h(s.getImageData(0,0,i,i)),u.xHeight=u.baseline-u.lower),f.tittle&&(s.clearRect(0,0,i,i),s.textBaseline="top",s.fillText(f.tittle,0,0),u.tittle=h(s.getImageData(0,0,i,i))),f.ascent&&(s.clearRect(0,0,i,i),s.textBaseline="top",s.fillText(f.ascent,0,0),u.ascent=h(s.getImageData(0,0,i,i))),f.descent&&(s.clearRect(0,0,i,i),s.textBaseline="top",s.fillText(f.descent,0,0),u.descent=d(s.getImageData(0,0,i,i))),f.overshoot&&(s.clearRect(0,0,i,i),s.textBaseline="top",s.fillText(f.overshoot,0,0),i=d(s.getImageData(0,0,i,i)),u.overshoot=i-e),u)u[c]/=n;return u.em=n,p(l.cache[r]=u,a)}function p(e,t){var r,n={};for(r in"string"==typeof t&&(t=e[t]),e)"em"!==r&&(n[r]=e[r]-t);return n}function h(e){for(var t=e.height,r=e.data,n=3;n<r.length;n+=4)if(0!==r[n])return Math.floor(.25*(n-3)/t)}function d(e){for(var t=e.height,r=e.data,n=r.length-1;0<n;n-=4)if(0!==r[n])return Math.floor(.25*(n-3)/t)}(t.exports=l).canvas=document.createElement("canvas"),l.cache={}},{}],88:[function(e,t,r){e("webrtc-adapter");t.exports=function(e,r){var t,n="PermissionDeniedError",i="ConstraintNotSatisfiedError";return 2===arguments.length||(r=e,e={video:!0,audio:!0}),"undefined"!=typeof navigator&&navigator.getUserMedia?e.audio||e.video?void navigator.mediaDevices.getUserMedia(e).then(function(e){r(null,e)}).catch(function(e){var t;"string"==typeof e?(t=new Error("MediaStreamError")).name=e===n||"PERMISSION_DENIED"===e?n:i:(t=e).name||(t[n]?e.name=n:e.name=i),r(t)}):((t=new Error("MediaStreamError")).name="NoMediaRequestedError",setTimeout(function(){r(t)},0)):((t=new Error("MediaStreamError")).name="NotSupportedError",setTimeout(function(){r(t)},0))}},{"webrtc-adapter":195}],89:[function(e,t,r){t.exports=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],f=t[6],u=t[7],c=t[8],l=t[9],p=t[10],h=t[11],d=t[12],m=t[13],g=t[14],t=t[15];return e[0]=s*(p*t-h*g)-l*(f*t-u*g)+m*(f*h-u*p),e[1]=-(n*(p*t-h*g)-l*(i*t-a*g)+m*(i*h-a*p)),e[2]=n*(f*t-u*g)-s*(i*t-a*g)+m*(i*u-a*f),e[3]=-(n*(f*h-u*p)-s*(i*h-a*p)+l*(i*u-a*f)),e[4]=-(o*(p*t-h*g)-c*(f*t-u*g)+d*(f*h-u*p)),e[5]=r*(p*t-h*g)-c*(i*t-a*g)+d*(i*h-a*p),e[6]=-(r*(f*t-u*g)-o*(i*t-a*g)+d*(i*u-a*f)),e[7]=r*(f*h-u*p)-o*(i*h-a*p)+c*(i*u-a*f),e[8]=o*(l*t-h*m)-c*(s*t-u*m)+d*(s*h-u*l),e[9]=-(r*(l*t-h*m)-c*(n*t-a*m)+d*(n*h-a*l)),e[10]=r*(s*t-u*m)-o*(n*t-a*m)+d*(n*u-a*s),e[11]=-(r*(s*h-u*l)-o*(n*h-a*l)+c*(n*u-a*s)),e[12]=-(o*(l*g-p*m)-c*(s*g-f*m)+d*(s*p-f*l)),e[13]=r*(l*g-p*m)-c*(n*g-i*m)+d*(n*p-i*l),e[14]=-(r*(s*g-f*m)-o*(n*g-i*m)+d*(n*f-i*s)),e[15]=r*(s*p-f*l)-o*(n*p-i*l)+c*(n*f-i*s),e}},{}],90:[function(e,t,r){t.exports=function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}},{}],91:[function(e,t,r){t.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}},{}],92:[function(e,t,r){t.exports=function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],93:[function(e,t,r){t.exports=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],f=e[7],u=e[8],c=e[9],l=e[10],p=e[11],h=e[12],d=e[13],m=e[14],e=e[15];return(t*o-r*a)*(l*e-p*m)-(t*s-n*a)*(c*e-p*d)+(t*f-i*a)*(c*m-l*d)+(r*s-n*o)*(u*e-p*h)-(r*f-i*o)*(u*m-l*h)+(n*f-i*s)*(u*d-c*h)}},{}],94:[function(e,t,r){t.exports=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,f=i+i,u=r*o,c=n*o,t=n*s,r=i*o,n=i*s,i=i*f,o=a*o,s=a*s,f=a*f;return e[0]=1-t-i,e[1]=c+f,e[2]=r-s,e[3]=0,e[4]=c-f,e[5]=1-u-i,e[6]=n+o,e[7]=0,e[8]=r+s,e[9]=n-o,e[10]=1-u-t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],95:[function(e,t,r){t.exports=function(e,t,r){var n=r[0],i=r[1],a=r[2],o=Math.sqrt(n*n+i*i+a*a);if(Math.abs(o)<1e-6)return null;return n*=o=1/o,i*=o,a*=o,r=Math.sin(t),o=Math.cos(t),t=1-o,e[0]=n*n*t+o,e[1]=i*n*t+a*r,e[2]=a*n*t-i*r,e[3]=0,e[4]=n*i*t-a*r,e[5]=i*i*t+o,e[6]=a*i*t+n*r,e[7]=0,e[8]=n*a*t+i*r,e[9]=i*a*t-n*r,e[10]=a*a*t+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],96:[function(e,t,r){t.exports=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=n+n,f=i+i,u=a+a,c=n*s,l=n*f,t=n*u,n=i*f,i=i*u,a=a*u,s=o*s,f=o*f,u=o*u;return e[0]=1-(n+a),e[1]=l+u,e[2]=t-f,e[3]=0,e[4]=l-u,e[5]=1-(c+a),e[6]=i+s,e[7]=0,e[8]=t+f,e[9]=i-s,e[10]=1-(c+n),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}},{}],97:[function(e,t,r){t.exports=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],98:[function(e,t,r){t.exports=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}},{}],99:[function(e,t,r){t.exports=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],100:[function(e,t,r){t.exports=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],101:[function(e,t,r){t.exports=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],102:[function(e,t,r){t.exports=function(e,t,r,n,i,a,o){var s=1/(r-t),f=1/(i-n),u=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*f,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+n)*f,e[10]=(o+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*u,e[15]=0,e}},{}],103:[function(e,t,r){t.exports=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],104:[function(e,t,r){t.exports={create:e("./create"),clone:e("./clone"),copy:e("./copy"),identity:e("./identity"),transpose:e("./transpose"),invert:e("./invert"),adjoint:e("./adjoint"),determinant:e("./determinant"),multiply:e("./multiply"),translate:e("./translate"),scale:e("./scale"),rotate:e("./rotate"),rotateX:e("./rotateX"),rotateY:e("./rotateY"),rotateZ:e("./rotateZ"),fromRotation:e("./fromRotation"),fromRotationTranslation:e("./fromRotationTranslation"),fromScaling:e("./fromScaling"),fromTranslation:e("./fromTranslation"),fromXRotation:e("./fromXRotation"),fromYRotation:e("./fromYRotation"),fromZRotation:e("./fromZRotation"),fromQuat:e("./fromQuat"),frustum:e("./frustum"),perspective:e("./perspective"),perspectiveFromFieldOfView:e("./perspectiveFromFieldOfView"),ortho:e("./ortho"),lookAt:e("./lookAt"),str:e("./str")}},{"./adjoint":89,"./clone":90,"./copy":91,"./create":92,"./determinant":93,"./fromQuat":94,"./fromRotation":95,"./fromRotationTranslation":96,"./fromScaling":97,"./fromTranslation":98,"./fromXRotation":99,"./fromYRotation":100,"./fromZRotation":101,"./frustum":102,"./identity":103,"./invert":105,"./lookAt":106,"./multiply":107,"./ortho":108,"./perspective":109,"./perspectiveFromFieldOfView":110,"./rotate":111,"./rotateX":112,"./rotateY":113,"./rotateZ":114,"./scale":115,"./str":116,"./translate":117,"./transpose":118}],105:[function(e,t,r){t.exports=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],f=t[6],u=t[7],c=t[8],l=t[9],p=t[10],h=t[11],d=t[12],m=t[13],g=t[14],v=t[15],y=r*s-n*o,b=r*f-i*o,w=r*u-a*o,x=n*f-i*s,A=n*u-a*s,_=i*u-a*f,k=c*m-l*d,E=c*g-p*d,T=c*v-h*d,C=l*g-p*m,O=l*v-h*m,S=p*v-h*g,t=y*S-b*O+w*C+x*T-A*E+_*k;return t?(t=1/t,e[0]=(s*S-f*O+u*C)*t,e[1]=(i*O-n*S-a*C)*t,e[2]=(m*_-g*A+v*x)*t,e[3]=(p*A-l*_-h*x)*t,e[4]=(f*T-o*S-u*E)*t,e[5]=(r*S-i*T+a*E)*t,e[6]=(g*w-d*_-v*b)*t,e[7]=(c*_-p*w+h*b)*t,e[8]=(o*O-s*T+u*k)*t,e[9]=(n*T-r*O-a*k)*t,e[10]=(d*A-m*w+v*y)*t,e[11]=(l*w-c*A-h*y)*t,e[12]=(s*E-o*C-f*k)*t,e[13]=(r*C-n*E+i*k)*t,e[14]=(m*b-d*x-g*y)*t,e[15]=(c*x-l*b+p*y)*t,e):null}},{}],106:[function(e,t,r){var d=e("./identity");t.exports=function(e,t,r,n){var i,a=t[0],o=t[1],s=t[2],f=n[0],u=n[1],c=n[2],l=r[0],p=r[1],h=r[2];if(Math.abs(a-l)<1e-6&&Math.abs(o-p)<1e-6&&Math.abs(s-h)<1e-6)return d(e);i=a-l,t=o-p,n=s-h,r=1/Math.sqrt(i*i+t*t+n*n),l=u*(n*=r)-c*(t*=r),p=c*(i*=r)-f*n,h=f*t-u*i,(r=Math.sqrt(l*l+p*p+h*h))?(l*=r=1/r,p*=r,h*=r):h=p=l=0;c=t*h-n*p,f=n*l-i*h,u=i*p-t*l,(r=Math.sqrt(c*c+f*f+u*u))?(c*=r=1/r,f*=r,u*=r):u=f=c=0;return e[0]=l,e[1]=c,e[2]=i,e[3]=0,e[4]=p,e[5]=f,e[6]=t,e[7]=0,e[8]=h,e[9]=u,e[10]=n,e[11]=0,e[12]=-(l*a+p*o+h*s),e[13]=-(c*a+f*o+u*s),e[14]=-(i*a+t*o+n*s),e[15]=1,e}},{"./identity":103}],107:[function(e,t,r){t.exports=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],f=t[5],u=t[6],c=t[7],l=t[8],p=t[9],h=t[10],d=t[11],m=t[12],g=t[13],v=t[14],y=t[15],b=r[0],w=r[1],x=r[2],t=r[3];return e[0]=b*n+w*s+x*l+t*m,e[1]=b*i+w*f+x*p+t*g,e[2]=b*a+w*u+x*h+t*v,e[3]=b*o+w*c+x*d+t*y,b=r[4],w=r[5],x=r[6],t=r[7],e[4]=b*n+w*s+x*l+t*m,e[5]=b*i+w*f+x*p+t*g,e[6]=b*a+w*u+x*h+t*v,e[7]=b*o+w*c+x*d+t*y,b=r[8],w=r[9],x=r[10],t=r[11],e[8]=b*n+w*s+x*l+t*m,e[9]=b*i+w*f+x*p+t*g,e[10]=b*a+w*u+x*h+t*v,e[11]=b*o+w*c+x*d+t*y,b=r[12],w=r[13],x=r[14],t=r[15],e[12]=b*n+w*s+x*l+t*m,e[13]=b*i+w*f+x*p+t*g,e[14]=b*a+w*u+x*h+t*v,e[15]=b*o+w*c+x*d+t*y,e}},{}],108:[function(e,t,r){t.exports=function(e,t,r,n,i,a,o){var s=1/(t-r),f=1/(n-i),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*f,e[14]=(o+a)*u,e[15]=1,e}},{}],109:[function(e,t,r){t.exports=function(e,t,r,n,i){var a=1/Math.tan(t/2),t=1/(n-i);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+n)*t,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*n*t,e[15]=0,e}},{}],110:[function(e,t,r){t.exports=function(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),f=2/(o+s),t=2/(i+a);return e[0]=f,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=-(o-s)*f*.5,e[9]=(i-a)*t*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}},{}],111:[function(e,t,r){t.exports=function(e,t,r,n){var i,a,o,s,f,u,c,l,p,h,d,m,g,v,y,b,w,x,A,_=n[0],k=n[1],E=n[2],T=Math.sqrt(_*_+k*k+E*E);if(Math.abs(T)<1e-6)return null;_*=T=1/T,k*=T,E*=T,x=Math.sin(r),A=Math.cos(r),i=1-A,a=t[0],o=t[1],s=t[2],f=t[3],u=t[4],c=t[5],l=t[6],p=t[7],h=t[8],d=t[9],m=t[10],g=t[11],v=_*_*i+A,y=k*_*i+E*x,b=E*_*i-k*x,w=_*k*i-E*x,n=k*k*i+A,T=E*k*i+_*x,r=_*E*i+k*x,x=k*E*i-_*x,A=E*E*i+A,e[0]=a*v+u*y+h*b,e[1]=o*v+c*y+d*b,e[2]=s*v+l*y+m*b,e[3]=f*v+p*y+g*b,e[4]=a*w+u*n+h*T,e[5]=o*w+c*n+d*T,e[6]=s*w+l*n+m*T,e[7]=f*w+p*n+g*T,e[8]=a*r+u*x+h*A,e[9]=o*r+c*x+d*A,e[10]=s*r+l*x+m*A,e[11]=f*r+p*x+g*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e}},{}],112:[function(e,t,r){t.exports=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],f=t[7],u=t[8],c=t[9],l=t[10],r=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[4]=a*i+u*n,e[5]=o*i+c*n,e[6]=s*i+l*n,e[7]=f*i+r*n,e[8]=u*i-a*n,e[9]=c*i-o*n,e[10]=l*i-s*n,e[11]=r*i-f*n,e}},{}],113:[function(e,t,r){t.exports=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],f=t[3],u=t[8],c=t[9],l=t[10],r=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=a*i-u*n,e[1]=o*i-c*n,e[2]=s*i-l*n,e[3]=f*i-r*n,e[8]=a*n+u*i,e[9]=o*n+c*i,e[10]=s*n+l*i,e[11]=f*n+r*i,e}},{}],114:[function(e,t,r){t.exports=function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],f=t[3],u=t[4],c=t[5],l=t[6],r=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=a*i+u*n,e[1]=o*i+c*n,e[2]=s*i+l*n,e[3]=f*i+r*n,e[4]=u*i-a*n,e[5]=c*i-o*n,e[6]=l*i-s*n,e[7]=r*i-f*n,e}},{}],115:[function(e,t,r){t.exports=function(e,t,r){var n=r[0],i=r[1],r=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}},{}],116:[function(e,t,r){t.exports=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}},{}],117:[function(e,t,r){t.exports=function(e,t,r){var n,i,a,o,s,f,u,c,l,p,h,d=r[0],m=r[1],g=r[2];t===e?(e[12]=t[0]*d+t[4]*m+t[8]*g+t[12],e[13]=t[1]*d+t[5]*m+t[9]*g+t[13],e[14]=t[2]*d+t[6]*m+t[10]*g+t[14],e[15]=t[3]*d+t[7]*m+t[11]*g+t[15]):(n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],f=t[5],u=t[6],c=t[7],l=t[8],p=t[9],h=t[10],r=t[11],e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=f,e[6]=u,e[7]=c,e[8]=l,e[9]=p,e[10]=h,e[11]=r,e[12]=n*d+s*m+l*g+t[12],e[13]=i*d+f*m+p*g+t[13],e[14]=a*d+u*m+h*g+t[14],e[15]=o*d+c*m+r*g+t[15]);return e}},{}],118:[function(e,t,r){t.exports=function(e,t){{var r,n,i,a,o,s;e===t?(r=t[1],n=t[2],i=t[3],a=t[6],o=t[7],s=t[11],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s):(e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15])}return e}},{}],119:[function(e,t,r){"use strict";var R=e("css-font"),B=e("pick-by-alias"),n=e("regl"),i=e("gl-util/context"),a=e("es6-weak-map"),F=e("color-normalize"),z=e("font-atlas"),L=e("typedarray-pool"),U=e("parse-rect"),o=e("is-plain-obj"),V=e("parse-unit"),N=e("to-px"),q=e("detect-kerning"),W=e("object-assign"),H=e("font-measure"),G=e("flatten-vertex-data"),Q=e("bit-twiddle").nextPow2,s=new a,Y=!1;document.body&&((a=document.body.appendChild(document.createElement("div"))).style.font="italic small-caps bold condensed 16px/2 cursive",getComputedStyle(a).fontStretch&&(Y=!0),document.body.removeChild(a));function X(e){var t;"function"==typeof(t=e)&&t._gl&&t.prop&&t.texture&&t.buffer?(e={regl:e},this.gl=e.regl._gl):this.gl=i(e),this.shader=s.get(this.gl),this.shader?this.regl=this.shader.regl:this.regl=e.regl||n({gl:this.gl}),this.charBuffer=this.regl.buffer({type:"uint8",usage:"stream"}),this.sizeBuffer=this.regl.buffer({type:"float",usage:"stream"}),this.shader||(this.shader=this.createShader(),s.set(this.gl,this.shader)),this.batch=[],this.fontSize=[],this.font=[],this.fontAtlas=[],this.draw=this.shader.draw.bind(this),this.render=function(){this.regl._refresh(),this.draw(this.batch)},this.canvas=this.gl.canvas,this.update(o(e)?e:{})}X.prototype.createShader=function(){var e=this.regl,t=e({blend:{enable:!0,color:[0,0,0,1],func:{srcRGB:"src alpha",dstRGB:"one minus src alpha",srcAlpha:"one minus dst alpha",dstAlpha:"one"}},stencil:{enable:!1},depth:{enable:!1},count:e.prop("count"),offset:e.prop("offset"),attributes:{charOffset:{offset:4,stride:8,buffer:e.this("sizeBuffer")},width:{offset:0,stride:8,buffer:e.this("sizeBuffer")},char:e.this("charBuffer"),position:e.this("position")},uniforms:{atlasSize:function(e,t){return[t.atlas.width,t.atlas.height]},atlasDim:function(e,t){return[t.atlas.cols,t.atlas.rows]},atlas:function(e,t){return t.atlas.texture},charStep:function(e,t){return t.atlas.step},em:function(e,t){return t.atlas.em},color:e.prop("color"),opacity:e.prop("opacity"),viewport:e.this("viewportArray"),scale:e.this("scale"),align:e.prop("align"),baseline:e.prop("baseline"),translate:e.this("translate"),positionOffset:e.prop("positionOffset")},primitive:"points",viewport:e.this("viewport"),vert:"\n\t\t\tprecision highp float;\n\t\t\tattribute float width, charOffset, char;\n\t\t\tattribute vec2 position;\n\t\t\tuniform float fontSize, charStep, em, align, baseline;\n\t\t\tuniform vec4 viewport;\n\t\t\tuniform vec4 color;\n\t\t\tuniform vec2 atlasSize, atlasDim, scale, translate, positionOffset;\n\t\t\tvarying vec2 charCoord, charId;\n\t\t\tvarying float charWidth;\n\t\t\tvarying vec4 fontColor;\n\t\t\tvoid main () {\n\t\t\t\t"+(X.normalViewport?"":"vec2 positionOffset = vec2(positionOffset.x,- positionOffset.y);")+"\n\n\t\t\t\tvec2 offset = floor(em * (vec2(align + charOffset, baseline)\n\t\t\t\t\t+ positionOffset))\n\t\t\t\t\t/ (viewport.zw * scale.xy);\n\n\t\t\t\tvec2 position = (position + translate) * scale;\n\t\t\t\tposition += offset * scale;\n\n\t\t\t\t"+(X.normalViewport?"position.y = 1. - position.y;":"")+"\n\n\t\t\t\tcharCoord = position * viewport.zw + viewport.xy;\n\n\t\t\t\tgl_Position = vec4(position * 2. - 1., 0, 1);\n\n\t\t\t\tgl_PointSize = charStep;\n\n\t\t\t\tcharId.x = mod(char, atlasDim.x);\n\t\t\t\tcharId.y = floor(char / atlasDim.x);\n\n\t\t\t\tcharWidth = width * em;\n\n\t\t\t\tfontColor = color / 255.;\n\t\t\t}",frag:"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D atlas;\n\t\t\tuniform float fontSize, charStep, opacity;\n\t\t\tuniform vec2 atlasSize;\n\t\t\tuniform vec4 viewport;\n\t\t\tvarying vec4 fontColor;\n\t\t\tvarying vec2 charCoord, charId;\n\t\t\tvarying float charWidth;\n\n\t\t\tfloat lightness(vec4 color) {\n\t\t\t\treturn color.r * 0.299 + color.g * 0.587 + color.b * 0.114;\n\t\t\t}\n\n\t\t\tvoid main () {\n\t\t\t\tvec2 uv = gl_FragCoord.xy - charCoord + charStep * .5;\n\t\t\t\tfloat halfCharStep = floor(charStep * .5 + .5);\n\n\t\t\t\t// invert y and shift by 1px (FF expecially needs that)\n\t\t\t\tuv.y = charStep - uv.y;\n\n\t\t\t\t// ignore points outside of character bounding box\n\t\t\t\tfloat halfCharWidth = ceil(charWidth * .5);\n\t\t\t\tif (floor(uv.x) > halfCharStep + halfCharWidth ||\n\t\t\t\t\tfloor(uv.x) < halfCharStep - halfCharWidth) return;\n\n\t\t\t\tuv += charId * charStep;\n\t\t\t\tuv = uv / atlasSize;\n\n\t\t\t\tvec4 color = fontColor;\n\t\t\t\tvec4 mask = texture2D(atlas, uv);\n\n\t\t\t\tfloat maskY = lightness(mask);\n\t\t\t\t// float colorY = lightness(color);\n\t\t\t\tcolor.a *= maskY;\n\t\t\t\tcolor.a *= opacity;\n\n\t\t\t\t// color.a += .1;\n\n\t\t\t\t// antialiasing, see yiq color space y-channel formula\n\t\t\t\t// color.rgb += (1. - color.rgb) * (1. - mask.rgb);\n\n\t\t\t\tgl_FragColor = color;\n\t\t\t}"});return{regl:e,draw:t,atlas:{}}},X.prototype.update=function(n){var s=this;if("string"==typeof n)n={text:n};else if(!n)return;null!=(n=B(n,{position:"position positions coord coords coordinates",font:"font fontFace fontface typeface cssFont css-font family fontFamily",fontSize:"fontSize fontsize size font-size",text:"text texts chars characters value values symbols",align:"align alignment textAlign textbaseline",baseline:"baseline textBaseline textbaseline",direction:"dir direction textDirection",color:"color colour fill fill-color fillColor textColor textcolor",kerning:"kerning kern",range:"range dataBox",viewport:"vp viewport viewBox viewbox viewPort",opacity:"opacity alpha transparency visible visibility opaque",offset:"offset positionOffset padding shift indent indentation"},!0)).opacity&&(Array.isArray(n.opacity)?this.opacity=n.opacity.map(function(e){return parseFloat(e)}):this.opacity=parseFloat(n.opacity)),null!=n.viewport&&(this.viewport=U(n.viewport),X.normalViewport&&(this.viewport.y=this.canvas.height-this.viewport.y-this.viewport.height),this.viewportArray=[this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height]),null==this.viewport&&(this.viewport={x:0,y:0,width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight},this.viewportArray=[this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height]),null!=n.kerning&&(this.kerning=n.kerning),null!=n.offset&&("number"==typeof n.offset&&(n.offset=[n.offset,0]),this.positionOffset=G(n.offset)),n.direction&&(this.direction=n.direction),n.range&&(this.range=n.range,this.scale=[1/(n.range[2]-n.range[0]),1/(n.range[3]-n.range[1])],this.translate=[-n.range[0],-n.range[1]]),n.scale&&(this.scale=n.scale),n.translate&&(this.translate=n.translate),this.scale||(this.scale=[1/this.viewport.width,1/this.viewport.height]),this.translate||(this.translate=[0,0]),this.font.length||n.font||(n.font=X.baseFontSize+"px sans-serif");var f,a=!1,o=!1;if(n.font&&(Array.isArray(n.font)?n.font:[n.font]).forEach(function(t,e){if("string"==typeof t)try{t=R.parse(t)}catch(e){t=R.parse(X.baseFontSize+"px "+t)}else t=R.parse(R.stringify(t));var r=R.stringify({size:X.baseFontSize,family:t.family,stretch:Y?t.stretch:void 0,variant:t.variant,weight:t.weight,style:t.style}),n=V(t.size),i=Math.round(n[0]*N(n[1]));i!==s.fontSize[e]&&(o=!0,s.fontSize[e]=i),s.font[e]&&r==s.font[e].baseString||(a=!0,s.font[e]=X.fonts[r],s.font[e]||(n=t.family.join(", "),i=[t.style],t.style!=t.variant&&i.push(t.variant),t.variant!=t.weight&&i.push(t.weight),Y&&t.weight!=t.stretch&&i.push(t.stretch),s.font[e]={baseString:r,family:n,weight:t.weight,stretch:t.stretch,style:t.style,variant:t.variant,width:{},kerning:{},metrics:H(n,{origin:"top",fontSize:X.baseFontSize,fontStyle:i.join(" ")})},X.fonts[r]=s.font[e]))}),(a||o)&&this.font.forEach(function(e,t){var r=R.stringify({size:s.fontSize[t],family:e.family,stretch:Y?e.stretch:void 0,variant:e.variant,weight:e.weight,style:e.style});s.fontAtlas[t]=s.shader.atlas[r],s.fontAtlas[t]||(e=e.metrics,s.shader.atlas[r]=s.fontAtlas[t]={fontString:r,step:2*Math.ceil(s.fontSize[t]*e.bottom*.5),em:s.fontSize[t],cols:0,rows:0,height:0,width:0,chars:[],ids:{},texture:s.regl.texture()}),null==n.text&&(n.text=s.text)}),"string"==typeof n.text&&n.position&&2<n.position.length){for(var e=Array(.5*n.position.length),t=0;t<e.length;t++)e[t]=n.text;n.text=e}if(null!=n.text||a){if(this.textOffsets=[0],Array.isArray(n.text)){this.count=n.text[0].length,this.counts=[this.count];for(var r=1;r<n.text.length;r++)this.textOffsets[r]=this.textOffsets[r-1]+n.text[r-1].length,this.count+=n.text[r].length,this.counts.push(n.text[r].length);this.text=n.text.join("")}else this.text=n.text,this.count=this.text.length,this.counts=[this.count];f=[],this.font.forEach(function(e,t){X.atlasContext.font=e.baseString;for(var r=s.fontAtlas[t],n=0;n<s.text.length;n++){var i=s.text.charAt(n);if(null==r.ids[i]&&(r.ids[i]=r.chars.length,r.chars.push(i),f.push(i)),null==e.width[i]&&(e.width[i]=X.atlasContext.measureText(i).width/X.baseFontSize,s.kerning)){var a,o=[];for(a in e.width)o.push(a+i,i+a);W(e.kerning,q(e.family,{pairs:o}))}}})}if(n.position)if(2<n.position.length){for(var i=!n.position[0].length,u=L.mallocFloat(2*this.count),c=0,l=0;c<this.counts.length;c++){var p=this.counts[c];if(i)for(var h=0;h<p;h++)u[l++]=n.position[2*c],u[l++]=n.position[2*c+1];else for(var d=0;d<p;d++)u[l++]=n.position[c][0],u[l++]=n.position[c][1]}this.position.call?this.position({type:"float",data:u}):this.position=this.regl.buffer({type:"float",data:u}),L.freeFloat(u)}else this.position.destroy&&this.position.destroy(),this.position={constant:n.position};if(n.text||a){var m=L.mallocUint8(this.count),g=L.mallocFloat(2*this.count);this.textWidth=[];for(var v=0,y=0;v<this.counts.length;v++){for(var b=this.counts[v],w=this.font[v]||this.font[0],x=this.fontAtlas[v]||this.fontAtlas[0],A=0;A<b;A++){var _,k,E=this.text.charAt(y),T=this.text.charAt(y-1);m[y]=x.ids[E],g[2*y]=w.width[E],A?(_=g[2*y-2],k=g[2*y],k=g[2*y-1]+.5*_+.5*k,!this.kerning||(E=w.kerning[T+E])&&(k+=.001*E),g[2*y+1]=k):g[2*y+1]=.5*g[2*y],y++}this.textWidth.push(g.length?.5*g[2*y-2]+g[2*y-1]:0)}n.align||(n.align=this.align),this.charBuffer({data:m,type:"uint8",usage:"stream"}),this.sizeBuffer({data:g,type:"float",usage:"stream"}),L.freeUint8(m),L.freeFloat(g),f.length&&this.font.forEach(function(e,t){var r=s.fontAtlas[t],n=r.step,i=Math.floor(X.maxAtlasSize/n),a=Math.min(i,r.chars.length),o=Math.ceil(r.chars.length/a),t=Q(a*n),i=Q(o*n);r.width=t,r.height=i,r.rows=o,r.cols=a,r.em&&r.texture({data:z({canvas:X.atlasCanvas,font:r.fontString,chars:r.chars,shape:[t,i],step:[n,n]})})})}if(n.align&&(this.align=n.align,this.alignOffset=this.textWidth.map(function(e,t){t=Array.isArray(s.align)?1<s.align.length?s.align[t]:s.align[0]:s.align;if("number"==typeof t)return t;switch(t){case"right":case"end":return-e;case"center":case"centre":case"middle":return.5*-e}return 0})),null==this.baseline&&null==n.baseline&&(n.baseline=0),null!=n.baseline&&(this.baseline=n.baseline,Array.isArray(this.baseline)||(this.baseline=[this.baseline]),this.baselineOffset=this.baseline.map(function(e,t){var r=(s.font[t]||s.font[0]).metrics,t=0;return t+=.5*r.bottom,t+="number"==typeof e?e-r.baseline:-r[e],X.normalViewport||(t*=-1),t})),null!=n.color)if(n.color||(n.color="transparent"),"string"!=typeof n.color&&isNaN(n.color)){if("number"==typeof n.color[0]&&n.color.length>this.counts.length)for(var C=n.color.length,O=L.mallocUint8(C),S=(n.color.subarray||n.color.slice).bind(n.color),j=0;j<C;j+=4)O.set(F(S(j,j+4),"uint8"),j);else{var D=n.color.length;O=L.mallocUint8(4*D);for(var P=0;P<D;P++)O.set(F(n.color[P]||0,"uint8"),4*P)}this.color=O}else this.color=F(n.color,"uint8");if(n.position||n.text||n.color||n.baseline||n.align||n.font||n.offset||n.opacity)if(4<this.color.length||1<this.baselineOffset.length||this.align&&1<this.align.length||1<this.fontAtlas.length||2<this.positionOffset.length){var M=Math.max(.5*this.position.length||0,.25*this.color.length||0,this.baselineOffset.length||0,this.alignOffset.length||0,this.font.length||0,this.opacity.length||0,.5*this.positionOffset.length||0);this.batch=Array(M);for(var I=0;I<this.batch.length;I++)this.batch[I]={count:1<this.counts.length?this.counts[I]:this.counts[0],offset:1<this.textOffsets.length?this.textOffsets[I]:this.textOffsets[0],color:this.color?this.color.length<=4?this.color:this.color.subarray(4*I,4*I+4):[0,0,0,255],opacity:Array.isArray(this.opacity)?this.opacity[I]:this.opacity,baseline:null!=this.baselineOffset[I]?this.baselineOffset[I]:this.baselineOffset[0],align:this.align?null!=this.alignOffset[I]?this.alignOffset[I]:this.alignOffset[0]:0,atlas:this.fontAtlas[I]||this.fontAtlas[0],positionOffset:2<this.positionOffset.length?this.positionOffset.subarray(2*I,2*I+2):this.positionOffset}}else this.count?this.batch=[{count:this.count,offset:0,color:this.color||[0,0,0,255],opacity:Array.isArray(this.opacity)?this.opacity[0]:this.opacity,baseline:this.baselineOffset[0],align:this.alignOffset?this.alignOffset[0]:0,atlas:this.fontAtlas[0],positionOffset:this.positionOffset}]:this.batch=[]},X.prototype.destroy=function(){},X.prototype.kerning=!0,X.prototype.position={constant:new Float32Array(2)},X.prototype.translate=null,X.prototype.scale=null,X.prototype.font=null,X.prototype.text="",X.prototype.positionOffset=[0,0],X.prototype.opacity=1,X.prototype.color=new Uint8Array([0,0,0,255]),X.prototype.alignOffset=[0,0],X.normalViewport=!1,X.maxAtlasSize=1024,X.atlasCanvas=document.createElement("canvas"),X.atlasContext=X.atlasCanvas.getContext("2d",{alpha:!1}),X.baseFontSize=64,X.fonts={},t.exports=X},{"bit-twiddle":3,"color-normalize":6,"css-font":15,"detect-kerning":23,"es6-weak-map":78,"flatten-vertex-data":85,"font-atlas":86,"font-measure":87,"gl-util/context":121,"is-plain-obj":169,"object-assign":172,"parse-rect":174,"parse-unit":175,"pick-by-alias":176,regl:120,"to-px":181,"typedarray-pool":193}],120:[function(e,t,r){var n,i;n=this,i=function(){function i(e,t){this.id=n++,this.type=e,this.data=t}function r(e){return"["+function e(t){if(0===t.length)return[];var r=t.charAt(0),n=t.charAt(t.length-1);if(1<t.length&&r===n&&('"'===r||"'"===r))return['"'+t.substr(1,t.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t))return e(t.substr(0,r.index)).concat(e(r[1])).concat(e(t.substr(r.index+r[0].length)));if(1===(r=t.split(".")).length)return['"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(t=[],n=0;n<r.length;++n)t=t.concat(e(r[n]));return t}(e).join("][")+"]"}function w(e){return"string"==typeof e?e.split():e}function x(e){return"string"==typeof e?document.querySelector(e):e}function ne(e){var t,r,n,i,a=e||{};e={};var o,s,f,u,c,l,p=[],h=[],d="undefined"==typeof window?1:window.devicePixelRatio,m=!1,g=function(e){},v=function(){};if("string"==typeof a?t=document.querySelector(a):"object"==typeof a&&("string"==typeof a.nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?t=a:"function"==typeof a.drawArrays||"function"==typeof a.drawElements?n=(i=a).canvas:("gl"in a?i=a.gl:"canvas"in a?n=x(a.canvas):"container"in a&&(r=x(a.container)),"attributes"in a&&(e=a.attributes),"extensions"in a&&(p=w(a.extensions)),"optionalExtensions"in a&&(h=w(a.optionalExtensions)),"onDone"in a&&(g=a.onDone),"profile"in a&&(m=!!a.profile),"pixelRatio"in a&&(d=+a.pixelRatio))),t&&("canvas"===t.nodeName.toLowerCase()?n=t:r=t),!i){if(!n){if(f=r||document.body,u=d,l=document.createElement("canvas"),Ee(l.style,{border:0,margin:0,padding:0,top:0,left:0}),f.appendChild(l),f===document.body&&(l.style.position="absolute",Ee(f.style,{margin:0,padding:0})),f!==document.body&&"function"==typeof ResizeObserver?(c=new ResizeObserver(function(){setTimeout(b)})).observe(f):window.addEventListener("resize",b,!1),b(),!(t={canvas:l,onDestroy:function(){c?c.disconnect():window.removeEventListener("resize",b),f.removeChild(l)}}))return null;n=t.canvas,v=t.onDestroy}void 0===e.premultipliedAlpha&&(e.premultipliedAlpha=!0),o=n,s=e,i=y("webgl")||y("experimental-webgl")||y("webgl-experimental")}function y(e){try{return o.getContext(e,s)}catch(e){return null}}function b(){var e=window.innerWidth,t=window.innerHeight;f!==document.body&&(e=(t=f.getBoundingClientRect()).right-t.left,t=t.bottom-t.top),l.width=u*e,l.height=u*t,Ee(l.style,{width:e+"px",height:t+"px"})}return i?{gl:i,canvas:n,container:r,extensions:p,optionalExtensions:h,pixelRatio:d,profile:m,onDone:g,onDestroy:v}:(v(),g("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function re(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}function a(e){var t,r=(65535<e)<<4;return r|=t=(255<(e>>>=r))<<3,(r|=t=(15<(e>>>=t))<<2)|(t=(3<(e>>>=t))<<1)|e>>>t>>1}function e(){function n(e){e:{for(var t=16;t<=268435456;t*=16)if(e<=t){e=t;break e}e=0}return 0<(t=r[a(e)>>2]).length?t.pop():new ArrayBuffer(e)}function t(e){r[a(e.byteLength)>>2].push(e)}var r=re(8,function(){return[]});return{alloc:n,free:t,allocType:function(e,t){var r=null;switch(e){case 5120:r=new Int8Array(n(t),0,t);break;case 5121:r=new Uint8Array(n(t),0,t);break;case 5122:r=new Int16Array(n(2*t),0,t);break;case 5123:r=new Uint16Array(n(2*t),0,t);break;case 5124:r=new Int32Array(n(4*t),0,t);break;case 5125:r=new Uint32Array(n(4*t),0,t);break;case 5126:r=new Float32Array(n(4*t),0,t);break;default:return null}return r.length!==t?r.subarray(0,t):r},freeType:function(e){t(e.buffer)}}}function ie(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||De(e.data))}function l(e,t,r,n,i,a){for(var o=0;o<t;++o)for(var s=e[o],f=0;f<r;++f)for(var u=s[f],c=0;c<n;++c)i[a++]=u[c]}function ae(e){return 0|Ie[Object.prototype.toString.call(e)]}function oe(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function se(e,t,r,n,i,a,o){for(var s=0,f=0;f<r;++f)for(var u=0;u<n;++u)e[s++]=t[i*f+a*u+o]}function fe(e){for(var t,r,n,i=Se.allocType(5123,e.length),a=0;a<e.length;++a)isNaN(e[a])?i[a]=65535:1/0===e[a]?i[a]=31744:-1/0===e[a]?i[a]=64512:(o[0]=e[a],t=(n=s[0])>>>31<<15,r=(n<<1>>>24)-127,n=n>>13&1023,i[a]=r<-24?t:r<-14?t+(1024+n>>-14-r):15<r?31744+t:t+(15+r<<10)+n);return i}function ue(e){return Array.isArray(e)||De(e)}function t(e){return"[object "+e+"]"}function ce(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function le(e){return!(!Array.isArray(e)||0===e.length||!ue(e[0]))}function pe(e){return Object.prototype.toString.call(e)}function he(e){if(e){var t=pe(e);return 0<=f.indexOf(t)||(ce(e)||le(e)||ie(e))}}function de(e,t){36193===e.type?(e.data=fe(t),Se.freeType(t)):e.data=t}function me(e,t,r,n,i,a){if(e=void 0!==c[e]?c[e]:qe[e]*u[t],a&&(e*=6),i){for(n=0;1<=r;)n+=e*r*r,r/=2;return n}return e*r*n}function p(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function ge(i,a,e,t,c){function r(){this.id=++n,this.attributes=[];var e=a.oes_vertex_array_object;this.vao=e?e.createVertexArrayOES():null,(f[this.id]=this).buffers=[]}var o=e.maxAttributes,s=Array(o);for(e=0;e<o;++e)s[e]=new p;var n=0,f={},u={Record:p,scope:{},state:s,currentVAO:null,targetVAO:null,restore:a.oes_vertex_array_object?function(){a.oes_vertex_array_object&&je(f).forEach(function(e){e.refresh()})}:function(){},createVAO:function(e){function f(e){var t={},r=u.attributes;r.length=e.length;for(var n=0;n<e.length;++n){var i,a=e[n],o=r[n]=new p,s=a.data||a;Array.isArray(s)||De(s)||ie(s)?(u.buffers[n]&&(i=u.buffers[n],De(s)&&i._buffer.byteLength>=s.byteLength?i.subdata(s):(i.destroy(),u.buffers[n]=null)),u.buffers[n]||(i=u.buffers[n]=c.create(a,34962,!1,!0)),o.buffer=c.getBuffer(i),o.size=0|o.buffer.dimension,o.normalized=!1,o.type=o.buffer.dtype,o.offset=0,o.stride=0,o.divisor=0,o.state=1,t[n]=1):c.getBuffer(a)?(o.buffer=c.getBuffer(a),o.size=0|o.buffer.dimension,o.normalized=!1,o.type=o.buffer.dtype,o.offset=0,o.stride=0,o.divisor=0,o.state=1):c.getBuffer(a.buffer)?(o.buffer=c.getBuffer(a.buffer),o.size=0|(+a.size||o.buffer.dimension),o.normalized=!!a.normalized||!1,o.type="type"in a?Re[a.type]:o.buffer.dtype,o.offset=0|(a.offset||0),o.stride=0|(a.stride||0),o.divisor=0|(a.divisor||0),o.state=1):"x"in a&&(o.x=+a.x||0,o.y=+a.y||0,o.z=+a.z||0,o.w=+a.w||0,o.state=2)}for(e=0;e<u.buffers.length;++e)!t[e]&&u.buffers[e]&&(u.buffers[e].destroy(),u.buffers[e]=null);return u.refresh(),f}var u=new r;return t.vaoCount+=1,f.destroy=function(){for(var e=0;e<u.buffers.length;++e)u.buffers[e]&&u.buffers[e].destroy();u.buffers.length=0,u.destroy()},f._vao=u,f._reglType="vao",f(e)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var t=0;t<s.length;++t){var r=s[t];r.buffer===e&&(i.disableVertexAttribArray(t),r.buffer=null)}},setVAO:a.oes_vertex_array_object?function(e){var t;e!==u.currentVAO&&(t=a.oes_vertex_array_object,e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),u.currentVAO=e)}:function(e){if(e!==u.currentVAO){if(e)e.bindAttrs();else for(var t=a.angle_instanced_arrays,r=0;r<s.length;++r){var n=s[r];n.buffer?(i.enableVertexAttribArray(r),i.vertexAttribPointer(r,n.size,n.type,n.normalized,n.stride,n.offfset),t&&n.divisor&&t.vertexAttribDivisorANGLE(r,n.divisor)):(i.disableVertexAttribArray(r),i.vertexAttrib4f(r,n.x,n.y,n.z,n.w))}u.currentVAO=e}},clear:a.oes_vertex_array_object?function(){je(f).forEach(function(e){e.destroy()})}:function(){}};return r.prototype.bindAttrs=function(){for(var e=a.angle_instanced_arrays,t=this.attributes,r=0;r<t.length;++r){var n=t[r];n.buffer?(i.enableVertexAttribArray(r),i.bindBuffer(34962,n.buffer.buffer),i.vertexAttribPointer(r,n.size,n.type,n.normalized,n.stride,n.offset),e&&n.divisor&&e.vertexAttribDivisorANGLE(r,n.divisor)):(i.disableVertexAttribArray(r),i.vertexAttrib4f(r,n.x,n.y,n.z,n.w))}for(e=t.length;e<o;++e)i.disableVertexAttribArray(e)},r.prototype.refresh=function(){var e=a.oes_vertex_array_object;e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),u.currentVAO=this)},r.prototype.destroy=function(){var e;this.vao&&(e=a.oes_vertex_array_object,this===u.currentVAO&&(u.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null),f[this.id]&&(delete f[this.id],--t.vaoCount)},u}function ve(s,f,u,c){function n(e){var t=null===f.next?5121:f.next.colorAttachments[0].texture._texture.type,r=0,n=0,i=c.framebufferWidth,a=c.framebufferHeight,o=null;return De(e)?o=e:e&&(r=0|e.x,n=0|e.y,i=0|(e.width||c.framebufferWidth-r),a=0|(e.height||c.framebufferHeight-n),o=e.data||null),u(),e=i*a*4,o||(5121===t?o=new Uint8Array(e):5126===t&&(o=o||new Float32Array(e))),s.pixelStorei(3333,4),s.readPixels(r,n,i,a,6408,t,o),o}return function(e){return e&&"framebuffer"in e?(t=e,f.setFBO({framebuffer:t.framebuffer},function(){r=n(t)}),r):n(e);var t,r}}function R(e){return Array.prototype.slice.call(e)}function B(e){return R(e).join("")}function ye(e){return Array.isArray(e)||De(e)||ie(e)}function F(e){return e.sort(function(e,t){return"viewport"===e||"viewport"!==t&&e<t?-1:1})}function be(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function we(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function xe(e){return new be(!1,!1,!1,e)}function Ae(e,t){var r=e.type;if(0===r)return new be(!0,1<=(r=e.data.length),2<=r,t);if(4===r)return new be((r=e.data).thisDep,r.contextDep,r.propDep,t);if(5===r)return new be(!1,!1,!1,t);if(6!==r)return new be(3===r,2===r,1===r,t);for(var n=r=!1,i=!1,a=0;a<e.data.length;++a){var o=e.data[a];1===o.type?i=!0:2===o.type?n=!0:3===o.type?r=!0:0===o.type?(r=!0,1<=(o=o.data)&&(n=!0),2<=o&&(i=!0)):4===o.type&&(r=r||o.data.thisDep,n=n||o.data.contextDep,i=i||o.data.propDep)}return new be(r,n,i,t)}function _e(e,H,G,a,Q,Y,t,X,r,J,K,n,i,m,o){function Z(e){return e.replace(".","_")}function s(e,t,r){var n=Z(e);te.push(e),S[n]=O[n]=!!r,j[n]=t}function f(e,t,r){var n=Z(e);te.push(e),Array.isArray(r)?(O[n]=r.slice(),S[n]=r.slice()):O[n]=S[n]=r,D[n]=t}function h(){var n,r,i,a,o,s=(n=0,r=[],i=[],a=u(),o={},{global:a,link:function(e){for(var t=0;t<i.length;++t)if(i[t]===e)return r[t];return t="g"+n++,r.push(t),i.push(e),t},block:u,proc:function(e,t){function r(){var e="a"+n.length;return n.push(e),e}var n=[];t=t||0;for(var i=0;i<t;++i)r();var a=(i=c()).toString;return o[e]=Ee(i,{arg:r,toString:function(){return B(["function(",n.join(),"){",a(),"}"])}})},scope:c,cond:function(){var t=B(arguments),e=c(),r=c(),n=e.toString,i=r.toString;return Ee(e,{then:function(){return e.apply(e,R(arguments)),this},else:function(){return r.apply(r,R(arguments)),this},toString:function(){var e=(e=i())&&"else{"+e+"}";return B(["if(",t,"){",n(),"}",e])}})},compile:function(){var t=['"use strict";',a,"return {"];Object.keys(o).forEach(function(e){t.push('"',e,'":',o[e].toString(),",")}),t.push("}");var e=B(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,r.concat(e)).apply(null,i)}}),f=s.link,t=s.global;function u(){var t=[],r=[];return Ee(function(){t.push.apply(t,R(arguments))},{def:function(){var e="v"+n++;return r.push(e),0<arguments.length&&(t.push(e,"="),t.push.apply(t,R(arguments)),t.push(";")),e},toString:function(){return B([0<r.length?"var "+r.join(",")+";":"",B(t)])}})}function c(){function n(e,t){r(e,t,"=",i.def(e,t),";")}var i=u(),r=u(),e=i.toString,t=r.toString;return Ee(function(){i.apply(i,R(arguments))},{def:i.def,entry:i,exit:r,save:n,set:function(e,t,r){n(e,t),i(e,t,"=",r,";")},toString:function(){return e()+t()}})}s.id=I++,s.batchId="0";var l=f(P),p=s.shared={props:"a0"};Object.keys(P).forEach(function(e){p[e]=t.def(l,".",e)});var h=s.next={},d=s.current={};Object.keys(D).forEach(function(e){Array.isArray(O[e])&&(h[e]=t.def(p.next,".",e),d[e]=t.def(p.current,".",e))});var m=s.constants={};Object.keys(M).forEach(function(e){m[e]=t.def(JSON.stringify(M[e]))}),s.invoke=function(t,e){switch(e.type){case 0:var r=["this",p.context,p.props,s.batchId];return t.def(f(e.data),".call(",r.slice(0,Math.max(e.data.length+1,4)),")");case 1:return t.def(p.props,e.data);case 2:return t.def(p.context,e.data);case 3:return t.def("this",e.data);case 4:return e.data.append(s,t),e.data.ref;case 5:return e.data.toString();case 6:return e.data.map(function(e){return s.invoke(t,e)})}},s.attribCache={};var g={};return s.scopeAttrib=function(e){if((e=H.id(e))in g)return g[e];var t=(t=J.scope[e])||(J.scope[e]=new $);return g[e]=f(t)},s}function u(e,t,r,n){function i(e){var t=k[e];t&&(T[e]=t)}var a,o,s,f,u,c,l,p,h,d,m,g,v,y,b,w,x,A=function(e,t){if("string"==typeof(r=e.static).frag&&"string"==typeof r.vert){if(0<Object.keys(t.dynamic).length)return null;var r=t.static,n=Object.keys(r);if(0<n.length&&"number"==typeof r[n[0]]){for(var i=[],a=0;a<n.length;++a)i.push([0|r[n[a]],n[a]]);return i}}return null}(e,t),_=function(e){var t=e.static,e=e.dynamic;if("framebuffer"in t){var n=t.framebuffer;return n?(n=X.getFramebuffer(n),xe(function(e,t){var r=e.link(n),e=e.shared;return t.set(e.framebuffer,".next",r),e=e.context,t.set(e,".framebufferWidth",r+".width"),t.set(e,".framebufferHeight",r+".height"),r})):xe(function(e,t){e=e.shared;return t.set(e.framebuffer,".next","null"),e=e.context,t.set(e,".framebufferWidth",e+".drawingBufferWidth"),t.set(e,".framebufferHeight",e+".drawingBufferHeight"),"null"})}if("framebuffer"in e){var i=e.framebuffer;return Ae(i,function(e,t){var r=e.invoke(t,i),n=e.shared,e=n.framebuffer,r=t.def(e,".getFramebuffer(",r,")");return t.set(e,".next",r),n=n.context,t.set(n,".framebufferWidth",r+"?"+r+".width:"+n+".drawingBufferWidth"),t.set(n,".framebufferHeight",r+"?"+r+".height:"+n+".drawingBufferHeight"),r})}return null}(e),k=(y=_,w=(W=e).static,x=W.dynamic,(W=S("viewport"))&&(W=new be((b=W).thisDep,W.contextDep,W.propDep,function(e,t){var r=b.append(e,t),e=e.shared.context;return t.set(e,".viewportWidth",r[2]),t.set(e,".viewportHeight",r[3]),r})),{viewport:W,scissor_box:S("scissor.box")}),E=(d=(h=e).static,m=h.dynamic,g=function(){if("elements"in d){var n=ye(n=d.elements)?Y.getElements(Y.create(n,!0)):n&&Y.getElements(n),e=xe(function(e,t){if(n){var r=e.link(n);return e.ELEMENTS=r}return e.ELEMENTS=null});return e.value=n,e}if("elements"in m){var o=m.elements;return Ae(o,function(e,t){var r=(n=e.shared).isBufferArgs,n=n.elements,i=e.invoke(t,o),a=t.def("null"),r=t.def(r,"(",i,")"),i=e.cond(r).then(a,"=",n,".createStream(",i,");").else(a,"=",n,".getElements(",i,");");return t.entry(i),t.exit(e.cond(r).then(n,".destroyStream(",a,");")),e.ELEMENTS=a})}return null}(),v=O("offset",!0),{elements:g,primitive:function(){if("primitive"in d){var r=d.primitive;return xe(function(e,t){return Ue[r]})}if("primitive"in m){var n=m.primitive;return Ae(n,function(e,t){var r=e.constants.primTypes,e=e.invoke(t,n);return t.def(r,"[",e,"]")})}return g?we(g)?g.value?xe(function(e,t){return t.def(e.ELEMENTS,".primType")}):xe(function(){return 4}):new be(g.thisDep,g.contextDep,g.propDep,function(e,t){e=e.ELEMENTS;return t.def(e,"?",e,".primType:",4)}):null}(),count:function(){if("count"in d){var e=0|d.count;return xe(function(){return e})}if("count"in m){var r=m.count;return Ae(r,function(e,t){return e.invoke(t,r)})}return g?we(g)?g?v?new be(v.thisDep,v.contextDep,v.propDep,function(e,t){return t.def(e.ELEMENTS,".vertCount-",e.OFFSET)}):xe(function(e,t){return t.def(e.ELEMENTS,".vertCount")}):xe(function(){return-1}):new be(g.thisDep||v.thisDep,g.contextDep||v.contextDep,g.propDep||v.propDep,function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")}):null}(),instances:O("instances",!1),offset:v}),T=(c=(W=e).static,l=W.dynamic,p={},te.forEach(function(a){function e(e,r){var t,n;a in c?(t=e(c[a]),p[i]=xe(function(){return t})):a in l&&(n=l[a],p[i]=Ae(n,function(e,t){return r(e,t,e.invoke(t,n))}))}var i=Z(a);switch(a){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return e(function(e){return e},function(e,t,r){return r});case"depth.func":return e(function(e){return tt[e]},function(e,t,r){return t.def(e.constants.compareFuncs,"[",r,"]")});case"depth.range":return e(function(e){return e},function(e,t,r){return[t.def("+",r,"[0]"),t=t.def("+",r,"[1]")]});case"blend.func":return e(function(e){return[et["srcRGB"in e?e.srcRGB:e.src],et["dstRGB"in e?e.dstRGB:e.dst],et["srcAlpha"in e?e.srcAlpha:e.src],et["dstAlpha"in e?e.dstAlpha:e.dst]]},function(e,r,n){function t(e,t){return r.def('"',e,t,'" in ',n,"?",n,".",e,t,":",n,".",e)}e=e.constants.blendFuncs;var i=t("src","RGB"),a=t("dst","RGB"),i=r.def(e,"[",i,"]"),o=r.def(e,"[",t("src","Alpha"),"]");return[i,a=r.def(e,"[",a,"]"),o,e=r.def(e,"[",t("dst","Alpha"),"]")]});case"blend.equation":return e(function(e){return"string"==typeof e?[ee[e],ee[e]]:"object"==typeof e?[ee[e.rgb],ee[e.alpha]]:void 0},function(e,t,r){var n=e.constants.blendEquations,i=t.def(),a=t.def();return(e=e.cond("typeof ",r,'==="string"')).then(i,"=",a,"=",n,"[",r,"];"),e.else(i,"=",n,"[",r,".rgb];",a,"=",n,"[",r,".alpha];"),t(e),[i,a]});case"blend.color":return e(function(t){return re(4,function(e){return+t[e]})},function(e,t,r){return re(4,function(e){return t.def("+",r,"[",e,"]")})});case"stencil.mask":return e(function(e){return 0|e},function(e,t,r){return t.def(r,"|0")});case"stencil.func":return e(function(e){return[tt[e.cmp||"keep"],e.ref||0,"mask"in e?e.mask:-1]},function(e,t,r){return[e=t.def('"cmp" in ',r,"?",e.constants.compareFuncs,"[",r,".cmp]",":",7680),t.def(r,".ref|0"),t=t.def('"mask" in ',r,"?",r,".mask|0:-1")]});case"stencil.opFront":case"stencil.opBack":return e(function(e){return["stencil.opBack"===a?1029:1028,rt[e.fail||"keep"],rt[e.zfail||"keep"],rt[e.zpass||"keep"]]},function(e,t,r){function n(e){return t.def('"',e,'" in ',r,"?",i,"[",r,".",e,"]:",7680)}var i=e.constants.stencilOps;return["stencil.opBack"===a?1029:1028,n("fail"),n("zfail"),n("zpass")]});case"polygonOffset.offset":return e(function(e){return[0|e.factor,0|e.units]},function(e,t,r){return[t.def(r,".factor|0"),t=t.def(r,".units|0")]});case"cull.face":return e(function(e){var t=0;return"front"===e?t=1028:"back"===e&&(t=1029),t},function(e,t,r){return t.def(r,'==="front"?',1028,":",1029)});case"lineWidth":return e(function(e){return e},function(e,t,r){return r});case"frontFace":return e(function(e){return nt[e]},function(e,t,r){return t.def(r+'==="cw"?2304:2305')});case"colorMask":return e(function(e){return e.map(function(e){return!!e})},function(e,t,r){return re(4,function(e){return"!!"+r+"["+e+"]"})});case"sample.coverage":return e(function(e){return["value"in e?e.value:1,!!e.invert]},function(e,t,r){return[t.def('"value" in ',r,"?+",r,".value:1"),t=t.def("!!",r,".invert")]})}}),p),h=(h=A,a=(W=e).static,o=W.dynamic,s=C("frag"),f=C("vert"),u=null,W=we(s)&&we(f)?(u=K.program(f.id,s.id,null,h),xe(function(e,t){return e.link(u)})):new be(s&&s.thisDep||f&&f.thisDep,s&&s.contextDep||f&&f.contextDep,s&&s.propDep||f&&f.propDep,function(e,t){var r=e.shared.shader,n=s?s.append(e,t):t.def(r,".","frag"),e=f?f.append(e,t):t.def(r,".","vert");return t.def(r+".program("+e+","+n+")")}),{frag:s,vert:f,progVar:W,program:u});function C(e){if(e in a){var t=H.id(a[e]);return(e=xe(function(){return t})).id=t,e}if(e in o){var n=o[e];return Ae(n,function(e,t){var r=e.invoke(t,n);return t.def(e.shared.strings,".id(",r,")")})}return null}function O(e,r){if(e in d){var n=0|d[e];return xe(function(e,t){return r&&(e.OFFSET=n),n})}if(e in m){var i=m[e];return Ae(i,function(e,t){t=e.invoke(t,i);return r&&(e.OFFSET=t),t})}return r&&g?xe(function(e,t){return e.OFFSET="0",0}):null}function S(e){if(e in w){var i=w[e];e=!0;var a,o,s=0|i.x,f=0|i.y;return"width"in i?a=0|i.width:e=!1,"height"in i?o=0|i.height:e=!1,new be(!e&&y&&y.thisDep,!e&&y&&y.contextDep,!e&&y&&y.propDep,function(e,t){var r=e.shared.context,n=a;"width"in i||(n=t.def(r,".","framebufferWidth","-",s));e=o;return"height"in i||(e=t.def(r,".","framebufferHeight","-",f)),[s,f,n,e]})}if(e in x){var u=x[e];return e=Ae(u,function(e,t){var r=e.invoke(t,u),n=e.shared.context,i=t.def(r,".x|0"),e=t.def(r,".y|0");return[i,e,t.def('"width" in ',r,"?",r,".width|0:","(",n,".","framebufferWidth","-",i,")"),r=t.def('"height" in ',r,"?",r,".height|0:","(",n,".","framebufferHeight","-",e,")")]}),y&&(e.thisDep=e.thisDep||y.thisDep,e.contextDep=e.contextDep||y.contextDep,e.propDep=e.propDep||y.propDep),e}return y?new be(y.thisDep,y.contextDep,y.propDep,function(e,t){e=e.shared.context;return[0,0,t.def(e,".","framebufferWidth"),t.def(e,".","framebufferHeight")]}):null}i("viewport"),i(Z("scissor.box"));var j,D,P,M,I,R,B,F,z,L,U,V,N,q,W=0<Object.keys(T).length;return(_={framebuffer:_,draw:E,shader:h,state:T,dirty:W,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}}).profile=(W=(E=e).static,E=E.dynamic,"profile"in W?(j=!!W.profile,(D=xe(function(e,t){return j})).enable=j):"profile"in E&&(D=Ae(P=E.profile,function(e,t){return e.invoke(t,P)})),D),_.uniforms=(M=(r=r).static,I=r.dynamic,R={},Object.keys(M).forEach(function(e){var t,r,n=M[e];"number"==typeof n||"boolean"==typeof n?t=xe(function(){return n}):"function"==typeof n?"texture2d"===(r=n._reglType)||"textureCube"===r?t=xe(function(e){return e.link(n)}):"framebuffer"!==r&&"framebufferCube"!==r||(t=xe(function(e){return e.link(n.color[0])})):ue(n)&&(t=xe(function(e){return e.global.def("[",re(n.length,function(e){return n[e]}),"]")})),t.value=n,R[e]=t}),Object.keys(I).forEach(function(e){var r=I[e];R[e]=Ae(r,function(e,t){return e.invoke(t,r)})}),R),_.drawVAO=_.scopeVAO=function(e){var t=e.static,e=e.dynamic;if("vao"in t){var r=t.vao;return null!==r&&null===J.getVAO(r)&&(r=J.createVAO(r)),xe(function(e){return e.link(J.getVAO(r))})}if("vao"in e){var n=e.vao;return Ae(n,function(e,t){var r=e.invoke(t,n);return t.def(e.shared.vao+".getVAO("+r+")")})}return null}(e),!_.drawVAO&&h.program&&!A&&G.angle_instanced_arrays&&(B=!0,e=h.program.attributes.map(function(e){return e=t.static[e],B=B&&!!e,e}),B&&0<e.length&&(F=J.getVAO(J.createVAO(e)),_.drawVAO=new be(null,null,null,function(e,t){return e.link(F)}),_.useVAO=!0)),A?_.useVAO=!0:_.attributes=(z=(A=t).static,L=A.dynamic,U={},Object.keys(z).forEach(function(e){var r,t,n,i,a,o,s,f=z[e],u=H.id(e),c=new $;ye(f)?(c.state=1,c.buffer=Q.getBuffer(Q.create(f,34962,!1,!0)),c.type=0):(t=Q.getBuffer(f))?(c.state=1,c.buffer=t,c.type=0):"constant"in f?(r=f.constant,c.buffer="null",c.state=2,"number"==typeof r?c.x=r:$e.forEach(function(e,t){t<r.length&&(c[e]=r[t])})):(t=ye(f.buffer)?Q.getBuffer(Q.create(f.buffer,34962,!1,!0)):Q.getBuffer(f.buffer),n=0|f.offset,i=0|f.stride,a=0|f.size,o=!!f.normalized,s=0,"type"in f&&(s=Re[f.type]),f=0|f.divisor,c.buffer=t,c.state=1,c.size=a,c.normalized=o,c.type=s||t.dtype,c.offset=n,c.stride=i,c.divisor=f),U[e]=xe(function(e,t){var r=e.attribCache;if(u in r)return r[u];var n={isStream:!1};return Object.keys(c).forEach(function(e){n[e]=c[e]}),c.buffer&&(n.buffer=e.link(c.buffer),n.type=n.type||n.buffer+".dtype"),r[u]=n})}),Object.keys(L).forEach(function(e){var c=L[e];U[e]=Ae(c,function(e,t){function r(e){t(s[e],"=",n,".",e,"|0;")}var n=e.invoke(t,c),i=e.shared,a=e.constants,o=i.isBufferArgs,i=i.buffer,s={isStream:t.def(!1)},f=new $;f.state=1,Object.keys(f).forEach(function(e){s[e]=t.def(""+f[e])});var u=s.buffer,e=s.type;return t("if(",o,"(",n,")){",s.isStream,"=true;",u,"=",i,".createStream(",34962,",",n,");",e,"=",u,".dtype;","}else{",u,"=",i,".getBuffer(",n,");","if(",u,"){",e,"=",u,".dtype;",'}else if("constant" in ',n,"){",s.state,"=",2,";","if(typeof "+n+'.constant === "number"){',s[$e[0]],"=",n,".constant;",$e.slice(1).map(function(e){return s[e]}).join("="),"=0;","}else{",$e.map(function(e,t){return s[e]+"="+n+".constant.length>"+t+"?"+n+".constant["+t+"]:0;"}).join(""),"}}else{","if(",o,"(",n,".buffer)){",u,"=",i,".createStream(",34962,",",n,".buffer);","}else{",u,"=",i,".getBuffer(",n,".buffer);","}",e,'="type" in ',n,"?",a.glTypes,"[",n,".type]:",u,".dtype;",s.normalized,"=!!",n,".normalized;"),r("size"),r("offset"),r("stride"),r("divisor"),t("}}"),t.exit("if(",s.isStream,"){",i,".destroyStream(",u,");","}"),s})}),U),_.context=(V=(n=n).static,N=n.dynamic,q={},Object.keys(V).forEach(function(e){var r=V[e];q[e]=xe(function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)})}),Object.keys(N).forEach(function(e){var r=N[e];q[e]=Ae(r,function(e,t){return e.invoke(t,r)})}),q),_}function l(r,n,i){var a=r.shared.context,o=r.scope();Object.keys(i).forEach(function(e){n.save(a,"."+e);var t=i[e].append(r,n);Array.isArray(t)?o(a,".",e,"=[",t.join(),"];"):o(a,".",e,"=",t,";")}),n(o)}function d(e,t,r,n){var i,a=(s=e.shared).gl,o=s.framebuffer;C&&(i=t.def(s.extensions,".webgl_draw_buffers"));var s=(f=e.constants).drawBuffer,f=f.backBuffer;e=r?r.append(e,t):t.def(o,".next"),n||t("if(",e,"!==",o,".cur){"),t("if(",e,"){",a,".bindFramebuffer(",36160,",",e,".framebuffer);"),C&&t(i,".drawBuffersWEBGL(",s,"[",e,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),C&&t(i,".drawBuffersWEBGL(",f,");"),t("}",o,".cur=",e,";"),n||t("}")}function c(i,e,a){var t=i.shared,o=t.gl,s=i.current,f=i.next,u=t.current,c=t.next,l=i.cond(u,".dirty");te.forEach(function(e){var t,r,n;(e=Z(e))in a.state||(e in f?(t=f[e],r=s[e],n=re(O[e].length,function(e){return l.def(t,"[",e,"]")}),l(i.cond(n.map(function(e,t){return e+"!=="+r+"["+t+"]"}).join("||")).then(o,".",D[e],"(",n,");",n.map(function(e,t){return r+"["+t+"]="+e}).join(";"),";"))):(t=l.def(c,".",e),n=i.cond(t,"!==",u,".",e),l(n),e in j?n(i.cond(t).then(o,".enable(",j[e],");").else(o,".disable(",j[e],");"),u,".",e,"=",t,";"):n(o,".",D[e],"(",t,");",u,".",e,"=",t,";")))}),0===Object.keys(a.state).length&&l(u,".dirty=false;"),e(l)}function p(a,o,s,f){var e=a.shared,u=a.current,c=e.current,l=e.gl;F(Object.keys(s)).forEach(function(e){var t,r,n,i=s[e];f&&!f(i)||(t=i.append(a,o),j[e]?(r=j[e],we(i)?o(l,t?".enable(":".disable(",r,");"):o(a.cond(t).then(l,".enable(",r,");").else(l,".disable(",r,");")),o(c,".",e,"=",t,";")):ue(t)?(n=u[e],o(l,".",D[e],"(",t,");",t.map(function(e,t){return n+"["+t+"]="+e}).join(";"),";")):o(l,".",D[e],"(",t,");",c,".",e,"=",t,";"))})}function g(e,t){T&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function v(e,r,t,n,i){function a(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function o(e){e(u=r.def(),"=",a(),";"),"string"==typeof i?e(p,".count+=",i,";"):e(p,".count++;"),m&&(n?e(c=r.def(),"=",d,".getNumPendingQueries();"):e(d,".beginQuery(",p,");"))}function s(e){e(p,".cpuTime+=",a(),"-",u,";"),m&&(n?e(d,".pushScopeStats(",c,",",d,".getNumPendingQueries(),",p,");"):e(d,".endQuery();"))}function f(e){var t=r.def(h,".profile");r(h,".profile=",e,";"),r.exit(h,".profile=",t,";")}var u,c,l=e.shared,p=e.stats,h=l.current,d=l.timer;if(t=t.profile){if(we(t))return void(t.enable?(o(r),s(r.exit),f("true")):f("false"));f(t=t.append(e,r))}else t=r.def(h,".profile");o(l=e.block()),r("if(",t,"){",l,"}"),s(e=e.block()),r.exit("if(",t,"){",e,"}")}function y(l,p,a,e,o){var h=l.shared;e.forEach(function(e){var t=e.name,r=a.attributes[t];if(r){if(!o(r))return;i=r.append(l,p)}else{if(!o(L))return;var n=l.scopeAttrib(t),i={};Object.keys(new $).forEach(function(e){i[e]=p.def(n,".",e)})}!function(e,r,n){function t(){p("if(!",s,".buffer){",a,".enableVertexAttribArray(",o,");}");var e=n.type,t=n.size?p.def(n.size,"||",r):r;p("if(",s,".type!==",e,"||",s,".size!==",t,"||",c.map(function(e){return s+"."+e+"!=="+n[e]}).join("||"),"){",a,".bindBuffer(",34962,",",f,".buffer);",a,".vertexAttribPointer(",[o,t,e,n.normalized,n.stride,n.offset],");",s,".type=",e,";",s,".size=",t,";",c.map(function(e){return s+"."+e+"="+n[e]+";"}).join(""),"}"),T&&(e=n.divisor,p("if(",s,".divisor!==",e,"){",l.instancing,".vertexAttribDivisorANGLE(",[o,e],");",s,".divisor=",e,";}"))}function i(){p("if(",s,".buffer){",a,".disableVertexAttribArray(",o,");",s,".buffer=null;","}if(",$e.map(function(e,t){return s+"."+e+"!=="+u[t]}).join("||"),"){",a,".vertexAttrib4f(",o,",",u,");",$e.map(function(e,t){return s+"."+e+"="+u[t]+";"}).join(""),"}")}var a=h.gl,o=p.def(e,".location"),s=p.def(h.attributes,"[",o,"]");e=n.state;var f=n.buffer,u=[n.x,n.y,n.z,n.w],c=["buffer","normalized","offset","stride"];1===e?t():2===e?i():(p("if(",e,"===",1,"){"),t(),p("}else{"),i(),p("}"))}(l.link(e),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(e.info.type),i)})}function b(e,t,r,n,i){for(var a,o=e.shared,s=o.gl,f=0;f<n.length;++f){var u,c,l=(d=n[f]).name,p=d.info.type,h=r.uniforms[l],d=e.link(d)+".location";if(h){if(!i(h))continue;if(we(h)){if(l=h.value,35678===p||35680===p)t(s,".uniform1i(",d,",",(p=e.link(l._texture||l.color[0]._texture))+".bind());"),t.exit(p,".unbind();");else if(35674===p||35675===p||35676===p)h=2,35675===p?h=3:35676===p&&(h=4),t(s,".uniformMatrix",h,"fv(",d,",false,",l=e.global.def("new Float32Array(["+Array.prototype.slice.call(l)+"])"),");");else{switch(p){case 5126:a="1f";break;case 35664:a="2f";break;case 35665:a="3f";break;case 35666:a="4f";break;case 35670:case 5124:a="1i";break;case 35671:case 35667:a="2i";break;case 35672:case 35668:a="3i";break;case 35673:a="4i";break;case 35669:a="4i"}t(s,".uniform",a,"(",d,",",ue(l)?Array.prototype.slice.call(l):l,");")}continue}u=h.append(e,t)}else{if(!i(L))continue;u=t.def(o.uniforms,"[",H.id(l),"]")}switch(35678===p?t("if(",u,"&&",u,'._reglType==="framebuffer"){',u,"=",u,".color[0];","}"):35680===p&&t("if(",u,"&&",u,'._reglType==="framebufferCube"){',u,"=",u,".color[0];","}"),l=1,p){case 35678:case 35680:p=t.def(u,"._texture"),t(s,".uniform1i(",d,",",p,".bind());"),t.exit(p,".unbind();");continue;case 5124:case 35670:a="1i";break;case 35667:case 35671:a="2i",l=2;break;case 35668:case 35672:a="3i",l=3;break;case 35669:case 35673:a="4i",l=4;break;case 5126:a="1f";break;case 35664:a="2f",l=2;break;case 35665:a="3f",l=3;break;case 35666:a="4f",l=4;break;case 35674:a="Matrix2fv";break;case 35675:a="Matrix3fv";break;case 35676:a="Matrix4fv"}t(s,".uniform",a,"(",d,","),"M"===a.charAt(0)?(d=Math.pow(p-35674+2,2),c=e.global.def("new Float32Array(",d,")"),Array.isArray(u)?t("false,(",re(d,function(e){return c+"["+e+"]="+u[e]}),",",c,")"):t("false,(Array.isArray(",u,")||",u," instanceof Float32Array)?",u,":(",re(d,function(e){return c+"["+e+"]="+u+"["+e+"]"}),",",c,")")):t(1<l?re(l,function(e){return Array.isArray(u)?u[e]:u+"["+e+"]"}):u),t(");")}}function w(r,n,i,a){function e(e){var t=h[e];return t?t.contextDep&&a.contextDynamic||t.propDep?t.append(r,i):t.append(r,n):n.def(p,".",e)}function t(){function e(){i(u,".drawElementsInstancedANGLE(",[m,v,y,g+"<<(("+y+"-5121)>>1)",f],");")}function t(){i(u,".drawArraysInstancedANGLE(",[m,g,v,f],");")}d?b?e():(i("if(",d,"){"),e(),i("}else{"),t(),i("}")):t()}function o(){function e(){i(l+".drawElements("+[m,v,y,g+"<<(("+y+"-5121)>>1)"]+");")}function t(){i(l+".drawArrays("+[m,g,v]+");")}d?b?e():(i("if(",d,"){"),e(),i("}else{"),t(),i("}")):t()}var s,f,u,c=r.shared,l=c.gl,p=c.draw,h=a.draw,d=(s=h.elements,c=n,(s=s?((s.contextDep&&a.contextDynamic||s.propDep)&&(c=i),s.append(r,c)):c.def(p,".","elements"))&&c("if("+s+")"+l+".bindBuffer(34963,"+s+".buffer.buffer);"),s),m=e("primitive"),g=e("offset"),v=(c=h.count,s=n,c=c?((c.contextDep&&a.contextDynamic||c.propDep)&&(s=i),c.append(r,s)):s.def(p,".","count"));if("number"==typeof v){if(0===v)return}else i("if(",v,"){"),i.exit("}");T&&(f=e("instances"),u=r.instancing);var y=d+".type",b=h.elements&&we(h.elements);T&&("number"!=typeof f||0<=f)?"string"==typeof f?(i("if(",f,">0){"),t(),i("}else if(",f,"<0){"),o(),i("}")):t():o()}function x(e,t,r,n,i){return i=(t=h()).proc("body",i),T&&(t.instancing=i.def(t.shared.extensions,".angle_instanced_arrays")),e(t,i,r,n),t.compile().body}function A(e,t,r,n){g(e,t),r.useVAO?r.drawVAO?t(e.shared.vao,".setVAO(",r.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),y(e,t,r,n.attributes,function(){return 1})),b(e,t,r,n.uniforms,function(){return 1}),w(e,t,t,r)}function _(e,t,r,n){function i(){return!0}e.batchId="a1",g(e,t),y(e,t,r,n.attributes,i),b(e,t,r,n.uniforms,i),w(e,t,t,r)}function k(t,e,r,n){function i(e){return e.contextDep&&o||e.propDep}function a(e){return!i(e)}g(t,e);var o=r.contextDep,s=e.def(),f=e.def();t.shared.props=f,t.batchId=s;var u=t.scope(),c=t.scope();e(u.entry,"for(",s,"=0;",s,"<","a1",";++",s,"){",f,"=","a0","[",s,"];",c,"}",u.exit),r.needsContext&&l(t,c,r.context),r.needsFramebuffer&&d(t,c,r.framebuffer),p(t,c,r.state,i),r.profile&&i(r.profile)&&v(t,c,r,!1,!0),n?(r.useVAO?r.drawVAO?i(r.drawVAO)?c(t.shared.vao,".setVAO(",r.drawVAO.append(t,c),");"):u(t.shared.vao,".setVAO(",r.drawVAO.append(t,u),");"):u(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(u(t.shared.vao,".setVAO(null);"),y(t,u,r,n.attributes,a),y(t,c,r,n.attributes,i)),b(t,u,r,n.uniforms,a),b(t,c,r,n.uniforms,i),w(t,u,c,r)):(e=t.global.def("{}"),n=r.shader.progVar.append(t,c),f=c.def(n,".id"),u=c.def(e,"[",f,"]"),c(t.shared.gl,".useProgram(",n,".program);","if(!",u,"){",u,"=",e,"[",f,"]=",t.link(function(e){return x(_,t,r,e,2)}),"(",n,");}",u,".call(this,a0[",s,"],",s,");"))}function E(r,e,t){var n,i,a,o,s,f,u=e.static[t];u&&function(e){if("object"==typeof e&&!ue(e))for(var t=Object.keys(e),r=0;r<t.length;++r)if(Te.isDynamic(e[t[r]]))return 1}(u)&&(n=r.global,i=Object.keys(u),s=o=a=!1,f=r.global.def("{}"),i.forEach(function(e){var t=u[e];if(Te.isDynamic(t))"function"==typeof t&&(t=u[e]=Te.unbox(t)),e=Ae(t,null),a=a||e.thisDep,s=s||e.propDep,o=o||e.contextDep;else{switch(n(f,".",e,"="),typeof t){case"number":n(t);break;case"string":n('"',t,'"');break;case"object":Array.isArray(t)&&n("[",t.join(),"]");break;default:n(r.link(t))}n(";")}}),e.dynamic[t]=new Te.DynamicVariable(4,{thisDep:a,contextDep:o,propDep:s,ref:f,append:function(r,n){i.forEach(function(e){var t=u[e];Te.isDynamic(t)&&(t=r.invoke(n,t),n(f,".",e,"=",t,";"))})}}),delete e.static[t])}var $=J.Record,ee={add:32774,subtract:32778,"reverse subtract":32779};G.ext_blend_minmax&&(ee.min=32775,ee.max=32776);var T=G.angle_instanced_arrays,C=G.webgl_draw_buffers,O={dirty:!0,profile:o.profile},S={},te=[],j={},D={};s("dither",3024),s("blend.enable",3042),f("blend.color","blendColor",[0,0,0,0]),f("blend.equation","blendEquationSeparate",[32774,32774]),f("blend.func","blendFuncSeparate",[1,0,1,0]),s("depth.enable",2929,!0),f("depth.func","depthFunc",513),f("depth.range","depthRange",[0,1]),f("depth.mask","depthMask",!0),f("colorMask","colorMask",[!0,!0,!0,!0]),s("cull.enable",2884),f("cull.face","cullFace",1029),f("frontFace","frontFace",2305),f("lineWidth","lineWidth",1),s("polygonOffset.enable",32823),f("polygonOffset.offset","polygonOffset",[0,0]),s("sample.alpha",32926),s("sample.enable",32928),f("sample.coverage","sampleCoverage",[1,!1]),s("stencil.enable",2960),f("stencil.mask","stencilMask",-1),f("stencil.func","stencilFunc",[519,0,-1]),f("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),f("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),s("scissor.enable",3089),f("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),f("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var P={gl:e,context:i,strings:H,next:S,current:O,draw:n,elements:Y,buffer:Q,shader:K,attributes:J.state,vao:J,uniforms:r,framebuffer:X,extensions:G,timer:m,isBufferArgs:ye},M={primTypes:Ue,compareFuncs:tt,blendFuncs:et,blendEquations:ee,stencilOps:rt,glTypes:Re,orientationType:nt};C&&(M.backBuffer=[1029],M.drawBuffer=re(a.maxDrawbuffers,function(e){return 0===e?[0]:re(e,function(e){return 36064+e})}));var I=0;return{next:S,current:O,procs:function(){var o=h(),s=o.proc("poll"),f=o.proc("refresh"),u=o.block();s(u),f(u);var e,t=o.shared,c=t.gl,l=t.next,p=t.current;u(p,".dirty=false;"),d(o,s),d(o,f,null,!0),T&&(e=o.link(T)),G.oes_vertex_array_object&&f(o.link(G.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var r=0;r<a.maxAttributes;++r){var n=f.def(t.attributes,"[",r,"]"),i=o.cond(n,".buffer");i.then(c,".enableVertexAttribArray(",r,");",c,".bindBuffer(",34962,",",n,".buffer.buffer);",c,".vertexAttribPointer(",r,",",n,".size,",n,".type,",n,".normalized,",n,".stride,",n,".offset);").else(c,".disableVertexAttribArray(",r,");",c,".vertexAttrib4f(",r,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;"),f(i),T&&f(e,".vertexAttribDivisorANGLE(",r,",",n,".divisor);")}return f(o.shared.vao,".currentVAO=null;",o.shared.vao,".setVAO(",o.shared.vao,".targetVAO);"),Object.keys(j).forEach(function(e){var t=j[e],r=u.def(l,".",e),n=o.block();n("if(",r,"){",c,".enable(",t,")}else{",c,".disable(",t,")}",p,".",e,"=",r,";"),f(n),s("if(",r,"!==",p,".",e,"){",n,"}")}),Object.keys(D).forEach(function(e){var t,r,n=D[e],i=O[e],a=o.block();a(c,".",n,"("),ue(i)?(n=i.length,t=o.global.def(l,".",e),r=o.global.def(p,".",e),a(re(n,function(e){return t+"["+e+"]"}),");",re(n,function(e){return r+"["+e+"]="+t+"["+e+"];"}).join("")),s("if(",re(n,function(e){return t+"["+e+"]!=="+r+"["+e+"]"}).join("||"),"){",a,"}")):(t=u.def(l,".",e),r=u.def(p,".",e),a(t,");",p,".",e,"=",t,";"),s("if(",t,"!==",r,"){",a,"}")),f(a)}),o.compile()}(),compile:function(t,r,e,n,i){var a=h();a.stats=a.link(i),Object.keys(r.static).forEach(function(e){E(a,r,e)}),z.forEach(function(e){E(a,t,e)});var o=u(t,r,e,n);return function(t,r){var e=t.proc("draw",1);g(t,e),l(t,e,r.context),d(t,e,r.framebuffer),c(t,e,r),p(t,e,r.state),v(t,e,r,!1,!0);var n,i,a,o=r.shader.progVar.append(t,e);e(t.shared.gl,".useProgram(",o,".program);"),r.shader.program?A(t,e,r,r.shader.program):(e(t.shared.vao,".setVAO(null);"),n=t.global.def("{}"),i=e.def(o,".id"),a=e.def(n,"[",i,"]"),e(t.cond(a).then(a,".call(this,a0);").else(a,"=",n,"[",i,"]=",t.link(function(e){return x(A,t,r,e,1)}),"(",o,");",a,".call(this,a0);"))),0<Object.keys(r.state).length&&e(t.shared.current,".dirty=true;")}(a,o),function(n,i){function e(e){var t=i.shader[e];t&&a.set(o.shader,"."+e,t.append(n,a))}var a=n.proc("scope",3);n.batchId="a2";var o=n.shared,t=o.current;l(n,a,i.context),i.framebuffer&&i.framebuffer.append(n,a),F(Object.keys(i.state)).forEach(function(r){var e=i.state[r].append(n,a);ue(e)?e.forEach(function(e,t){a.set(n.next[r],"["+t+"]",e)}):a.set(o.next,"."+r,e)}),v(n,a,i,!0,!0),["elements","offset","count","instances","primitive"].forEach(function(e){var t=i.draw[e];t&&a.set(o.draw,"."+e,""+t.append(n,a))}),Object.keys(i.uniforms).forEach(function(e){var t=i.uniforms[e].append(n,a);Array.isArray(t)&&(t="["+t.join()+"]"),a.set(o.uniforms,"["+H.id(e)+"]",t)}),Object.keys(i.attributes).forEach(function(e){var t=i.attributes[e].append(n,a),r=n.scopeAttrib(e);Object.keys(new $).forEach(function(e){a.set(r,"."+e,t[e])})}),i.scopeVAO&&a.set(o.vao,".targetVAO",i.scopeVAO.append(n,a)),e("vert"),e("frag"),0<Object.keys(i.state).length&&(a(t,".dirty=true;"),a.exit(t,".dirty=true;")),a("a1(",n.shared.context,",a0,",n.batchId,");")}(a,o),function(t,r){function n(e){return e.contextDep&&i||e.propDep}var e=t.proc("batch",2);t.batchId="0",g(t,e);var i=!1,a=!0;Object.keys(r.context).forEach(function(e){i=i||r.context[e].propDep}),i||(l(t,e,r.context),a=!1);var o,s=r.framebuffer,f=!1;s?(s.propDep?i=f=!0:s.contextDep&&i&&(f=!0),f||d(t,e,s)):d(t,e,null),r.state.viewport&&r.state.viewport.propDep&&(i=!0),c(t,e,r),p(t,e,r.state,function(e){return!n(e)}),r.profile&&n(r.profile)||v(t,e,r,!1,"a1"),r.contextDep=i,r.needsContext=a,r.needsFramebuffer=f,(a=r.shader.progVar).contextDep&&i||a.propDep?k(t,e,r,null):(a=a.append(t,e),e(t.shared.gl,".useProgram(",a,".program);"),r.shader.program?k(t,e,r,r.shader.program):(e(t.shared.vao,".setVAO(null);"),s=t.global.def("{}"),f=e.def(a,".id"),o=e.def(s,"[",f,"]"),e(t.cond(o).then(o,".call(this,a0,a1);").else(o,"=",s,"[",f,"]=",t.link(function(e){return x(k,t,r,e,2)}),"(",a,");",o,".call(this,a0,a1);")))),0<Object.keys(r.state).length&&e(t.shared.current,".dirty=true;")}(a,o),Ee(a.compile(),{destroy:function(){o.shader.program.destroy()}})}}}function ke(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}var Ee=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e},n=0,Te={DynamicVariable:i,define:function(e,t){return new i(e,r(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof i},unbox:function r(e,n){return"function"==typeof e?new i(0,e):"number"==typeof e||"boolean"==typeof e?new i(5,e):Array.isArray(e)?new i(6,e.map(function(e,t){return r(e,n+"["+t+"]")})):e instanceof i?e:void 0},accessor:r},Ce={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},Oe="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},Se=e();Se.zero=e();function je(t){return Object.keys(t).map(function(e){return t[e]})}var De=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},Pe=function(e){for(var t=[];e.length;e=e[0])t.push(e.length);return t},Me=function(e,t,r,n){var i=1;if(t.length)for(var a=0;a<t.length;++a)i*=t[a];else i=0;switch(r=n||Se.allocType(r,i),t.length){case 0:break;case 1:for(n=t[0],t=0;t<n;++t)r[t]=e[t];break;case 2:for(n=t[0],t=t[1],a=i=0;a<n;++a)for(var o=e[a],s=0;s<t;++s)r[i++]=o[s];break;case 3:l(e,t[0],t[1],t[2],r,0);break;default:!function e(t,r,n,i,a){for(var o=1,s=n+1;s<r.length;++s)o*=r[s];var f=r[n];if(4==r.length-n){var u=r[n+1],c=r[n+2];for(r=r[n+3],s=0;s<f;++s)l(t[s],u,c,r,i,a),a+=o}else for(s=0;s<f;++s)e(t[s],r,n+1,i,a),a+=o}(e,t,0,r,0)}return r},Ie={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Re={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Be={dynamic:35048,stream:35040,static:35044},Fe=Me,ze=Pe,Le=[];Le[5120]=1,Le[5122]=2,Le[5124]=4,Le[5121]=1,Le[5123]=2,Le[5125]=4;var Ue={points:0,point:0,lines:1,line:1,triangles:Le[5126]=4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},o=new Float32Array(1),s=new Uint32Array(o.buffer),Ve=[9984,9986,9985,9987],Ne=[0,6409,6410,6407,6408],qe={};qe[6409]=qe[6406]=qe[6402]=1,qe[34041]=qe[6410]=2,qe[6407]=qe[35904]=3,qe[6408]=qe[35906]=4;var We=t("HTMLCanvasElement"),He=t("OffscreenCanvas"),Ge=t("CanvasRenderingContext2D"),Qe=t("ImageBitmap"),Ye=t("HTMLImageElement"),Xe=t("HTMLVideoElement"),f=Object.keys(Ie).concat([We,He,Ge,Qe,Ye,Xe]),u=[];u[5121]=1,u[5126]=4,u[36193]=2,u[5123]=2,u[5125]=4;var c=[];c[32854]=2,c[32855]=2,c[36194]=2,c[34041]=4,c[33776]=.5,c[33777]=.5,c[33778]=1,c[33779]=1,c[35986]=.5,c[35987]=1,c[34798]=1,c[35840]=.5,c[35841]=.25,c[35842]=.5,c[35843]=.25,c[36196]=.5;var Je=[];Je[32854]=2,Je[32855]=2,Je[36194]=2,Je[33189]=2,Je[36168]=1,Je[34041]=4,Je[35907]=4,Je[34836]=16,Je[34842]=8,Je[34843]=6;var Ke=[];Ke[6408]=4,Ke[6407]=3;var Ze=[];Ze[5121]=1,Ze[5126]=4,Ze[36193]=2;var $e=["x","y","z","w"],z="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),et={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},tt={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},rt={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},nt={cw:2304,ccw:2305},L=new be(!1,!1,!1,function(){});return function(e){function r(){if(0===G.length)j&&j.update(),J=null;else{J=Ce.next(r),c();for(var e=G.length-1;0<=e;--e){var t=G[e];t&&t(I,null,0)}h.flush(),j&&j.update()}}function n(){!J&&0<G.length&&(J=Ce.next(r))}function i(){J&&(Ce.cancel(r),J=null)}function t(e){e.preventDefault(),i(),Q.forEach(function(e){e()})}function a(e){h.getError(),m.restore(),L.restore(),B.restore(),U.restore(),V.restore(),N.restore(),F.restore(),j&&j.restore(),q.procs.refresh(),n(),Y.forEach(function(e){e()})}function o(e){function t(n,i){var a={},o={};return Object.keys(n).forEach(function(e){var t=n[e];if(Te.isDynamic(t))o[e]=Te.unbox(t,e);else{if(i&&Array.isArray(t))for(var r=0;r<t.length;++r)if(Te.isDynamic(t[r]))return void(o[e]=Te.unbox(t,e));a[e]=t}}),{dynamic:o,static:a}}var n,r=t(e.context||{},!0),i=t(e.uniforms||{},!0),a=t(e.attributes||{},!1);function o(t){var r;t in n&&(r=n[t],delete n[t],Object.keys(r).forEach(function(e){n[t+"."+e]=r[e]}))}e=t((delete(n=Ee({},s=e)).uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),o("blend"),o("depth"),o("cull"),o("stencil"),o("polygonOffset"),o("scissor"),o("sample"),"vao"in s&&(n.vao=s.vao),n),!1);var s={gpuTime:0,cpuTime:0,count:0},f=q.compile(e,a,i,r,s),u=f.draw,c=f.batch,l=f.scope,p=[];return Ee(function(e,t){var r;if("function"==typeof e)return l.call(this,null,e,0);if("function"!=typeof t)return"number"!=typeof e?Array.isArray(e)?e.length?c.call(this,e,e.length):void 0:u.call(this,e):0<e?c.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e):void 0;if("number"==typeof e)for(r=0;r<e;++r)l.call(this,null,t,r);else{if(!Array.isArray(e))return l.call(this,e,t,0);for(r=0;r<e.length;++r)l.call(this,e[r],t,r)}},{stats:s,destroy:function(){f.destroy()}})}function s(e,t){var r=0;q.procs.poll();var n=t.color;n&&(h.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),r|=16384),"depth"in t&&(h.clearDepth(+t.depth),r|=256),"stencil"in t&&(h.clearStencil(0|t.stencil),r|=1024),h.clear(r)}function f(t){return G.push(t),n(),{cancel:function(){var e=ke(G,t);G[e]=function e(){var t=ke(G,e);G[t]=G[G.length-1],--G.length,G.length<=0&&i()}}}}function u(){var e=W.viewport,t=W.scissor_box;e[0]=e[1]=t[0]=t[1]=0,I.viewportWidth=I.framebufferWidth=I.drawingBufferWidth=e[2]=t[2]=h.drawingBufferWidth,I.viewportHeight=I.framebufferHeight=I.drawingBufferHeight=e[3]=t[3]=h.drawingBufferHeight}function c(){I.tick+=1,I.time=p(),u(),q.procs.poll()}function l(){U.refresh(),u(),q.procs.refresh(),j&&j.update()}function p(){return(Oe()-D)/1e3}if(!(e=ne(e)))return null;var h=e.gl,d=h.getContextAttributes();h.isContextLost();var m=function(r,e){function t(e){var t;e=e.toLowerCase();try{t=n[e]=r.getExtension(e)}catch(e){}return!!t}for(var n={},i=0;i<e.extensions.length;++i){var a=e.extensions[i];if(!t(a))return e.onDestroy(),e.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(t),{extensions:n,restore:function(){Object.keys(n).forEach(function(e){if(n[e]&&!t(e))throw Error("(regl): error restoring extension "+e)})}}}(h,e);if(!m)return null;var g,v,y,b,w,x,A,_,k,E,T,C=(E={"":0},T=[""],{id:function(e){var t=E[e];return t||(t=E[e]=T.length,T.push(e),t)},str:function(e){return T[e]}}),O={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},S=m.extensions,j=function(a){function i(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function r(e,t,r){var n=f.pop()||new i;n.startQueryIndex=e,n.endQueryIndex=t,n.sum=0,n.stats=r,u.push(n)}if(!a.ext_disjoint_timer_query)return null;var o=[],s=[],f=[],u=[],c=[],l=[];return{beginQuery:function(e){var t=o.pop()||a.ext_disjoint_timer_query.createQueryEXT();a.ext_disjoint_timer_query.beginQueryEXT(35007,t),s.push(t),r(s.length-1,s.length,e)},endQuery:function(){a.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:r,update:function(){var e=s.length;if(0!==e){l.length=Math.max(l.length,e+1),c.length=Math.max(c.length,e+1),c[0]=0;for(var t=l[0]=0,r=e=0;r<s.length;++r){var n=s[r];a.ext_disjoint_timer_query.getQueryObjectEXT(n,34919)?(t+=a.ext_disjoint_timer_query.getQueryObjectEXT(n,34918),o.push(n)):s[e++]=n,c[r+1]=t,l[r+1]=e}for(s.length=e,r=e=0;r<u.length;++r){var i=(t=u[r]).startQueryIndex,n=t.endQueryIndex;t.sum+=c[n]-c[i],i=l[i],(n=l[n])===i?(t.stats.gpuTime+=t.sum/1e6,f.push(t)):(t.startQueryIndex=i,t.endQueryIndex=n,u[e++]=t)}u.length=e}},getNumPendingQueries:function(){return s.length},clear:function(){o.push.apply(o,s);for(var e=0;e<o.length;e++)a.ext_disjoint_timer_query.deleteQueryEXT(o[e]);s.length=0,o.length=0},restore:function(){s.length=0,o.length=0}}}(S),D=Oe(),P=h.drawingBufferWidth,M=h.drawingBufferHeight,I={tick:0,time:0,viewportWidth:P,viewportHeight:M,framebufferWidth:P,framebufferHeight:M,drawingBufferWidth:P,drawingBufferHeight:M,pixelRatio:e.pixelRatio},R=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(34047));var n=1,i=1;t.webgl_draw_buffers&&(n=e.getParameter(34852),i=e.getParameter(36063));var a,o,s=!!t.oes_texture_float;return s&&(s=e.createTexture(),e.bindTexture(3553,s),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null),a=e.createFramebuffer(),e.bindFramebuffer(36160,a),e.framebufferTexture2D(36160,36064,3553,s,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160)?s=!1:(e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384),o=Se.allocType(5126,4),e.readPixels(0,0,1,1,6408,5126,o),s=!e.getError()&&(e.deleteFramebuffer(a),e.deleteTexture(s),1===o[0]),Se.freeType(o))),o=!0,"undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(o=e.createTexture(),a=Se.allocType(5121,36),e.activeTexture(33984),e.bindTexture(34067,o),e.texImage2D(34069,0,6408,3,3,0,6408,5121,a),Se.freeType(a),e.bindTexture(34067,null),e.deleteTexture(o),o=!e.getError()),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:s,npotTextureCube:o}}(h,S),B=function(c,n,s,t){function i(e){this.id=r++,this.buffer=c.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,s.profile&&(this.stats={size:0})}function p(e,t,r){e.byteLength=t.byteLength,c.bufferData(e.type,t,r)}function l(e,t,r,n,i,a){var o,s,f,u,c;if(e.usage=r,Array.isArray(t)){if(e.dtype=n||5126,0<t.length)if(Array.isArray(t[0])){i=ze(t);for(var l=n=1;l<i.length;++l)n*=i[l];e.dimension=n,p(e,t=Fe(t,i,e.dtype),r),a?e.persistentData=t:Se.freeType(t)}else"number"==typeof t[0]?(e.dimension=i,oe(i=Se.allocType(e.dtype,t.length),t),p(e,i,r),a?e.persistentData=i:Se.freeType(i)):De(t[0])&&(e.dimension=t[0].length,e.dtype=n||ae(t[0])||5126,p(e,t=Fe(t,[t.length,t[0].length],e.dtype),r),a?e.persistentData=t:Se.freeType(t))}else De(t)?(e.dtype=n||ae(t),e.dimension=i,p(e,t,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)))):ie(t)?(i=t.shape,o=t.stride,l=t.offset,c=u=f=s=0,1===i.length?(s=i[0],f=1,u=o[0],c=0):2===i.length&&(s=i[0],f=i[1],u=o[0],c=o[1]),e.dtype=n||ae(t.data)||5126,e.dimension=f,se(i=Se.allocType(e.dtype,s*f),t.data,s,f,u,c,l),p(e,i,r),a?e.persistentData=i:Se.freeType(i)):t instanceof ArrayBuffer&&(e.dtype=5121,e.dimension=i,p(e,t,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(t))))}function a(e){n.bufferCount--,t(e),c.deleteBuffer(e.buffer),e.buffer=null,delete h[e.id]}var r=0,h={};i.prototype.bind=function(){c.bindBuffer(this.type,this.buffer)},i.prototype.destroy=function(){a(this)};var o=[];return s.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(h).forEach(function(e){t+=h[e].stats.size}),t}),{create:function(e,t,r,o){function f(e){var t=35044,r=null,n=0,i=0,a=1;return Array.isArray(e)||De(e)||ie(e)||e instanceof ArrayBuffer?r=e:"number"==typeof e?n=0|e:e&&("data"in e&&(r=e.data),"usage"in e&&(t=Be[e.usage]),"type"in e&&(i=Re[e.type]),"dimension"in e&&(a=0|e.dimension),"length"in e&&(n=0|e.length)),u.bind(),r?l(u,r,t,i,a,o):(n&&c.bufferData(u.type,n,t),u.dtype=i||5121,u.usage=t,u.dimension=a,u.byteLength=n),s.profile&&(u.stats.size=u.byteLength*Le[u.dtype]),f}n.bufferCount++;var u=new i(t);return h[u.id]=u,r||f(e),f._reglType="buffer",f._buffer=u,f.subdata=function(e,t){var r,n,i,a,o,s=0|(t||0);return u.bind(),De(e)||e instanceof ArrayBuffer?c.bufferSubData(u.type,s,e):Array.isArray(e)?0<e.length&&("number"==typeof e[0]?(oe(n=Se.allocType(u.dtype,e.length),e),c.bufferSubData(u.type,s,n),Se.freeType(n)):(Array.isArray(e[0])||De(e[0]))&&(r=ze(e),n=Fe(e,r,u.dtype),c.bufferSubData(u.type,s,n),Se.freeType(n))):ie(e)&&(r=e.shape,i=e.stride,t=o=a=n=0,1===r.length?(n=r[0],a=1,o=i[0],t=0):2===r.length&&(n=r[0],a=r[1],o=i[0],t=i[1]),r=Array.isArray(e.data)?u.dtype:ae(e.data),se(r=Se.allocType(r,n*a),e.data,n,a,o,t,e.offset),c.bufferSubData(u.type,s,r),Se.freeType(r)),f},s.profile&&(f.stats=u.stats),f.destroy=function(){a(u)},f},createStream:function(e,t){var r=o.pop();return(r=r||new i(e)).bind(),l(r,t,35040,0,1,!1),r},destroyStream:function(e){o.push(e)},clear:function(){je(h).forEach(a),o.forEach(a)},getBuffer:function(e){return e&&e._buffer instanceof i?e._buffer:null},restore:function(){je(h).forEach(function(e){e.buffer=c.createBuffer(),c.bindBuffer(e.type,e.buffer),c.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:l}}(h,O,e,function(e){return F.destroyBuffer(e)}),F=ge(h,S,R,O,B),z=function(f,u,c,r){function n(e){this.id=a++,(t[this.id]=this).buffer=e,this.primType=4,this.type=this.vertCount=0}function l(e,t,r,n,i,a,o){var s;if(e.buffer.bind(),t?((s=o)||De(t)&&(!ie(t)||De(t.data))||(s=u.oes_element_index_uint?5125:5123),c._initBuffer(e.buffer,t,r,s,3)):(f.bufferData(34963,a,r),e.buffer.dtype=s||5121,e.buffer.usage=r,e.buffer.dimension=3,e.buffer.byteLength=a),!(s=o)){switch(e.buffer.dtype){case 5121:case 5120:s=5121;break;case 5123:case 5122:s=5123;break;case 5125:case 5124:s=5125}e.buffer.dtype=s}e.type=s,(t=i)<0&&(t=e.buffer.byteLength,5123===s?t>>=1:5125===s&&(t>>=2)),e.vertCount=t,(t=n)<0&&(t=4,1===(n=e.buffer.dimension)&&(t=0),2===n&&(t=1),3===n&&(t=4)),e.primType=t}function i(e){r.elementsCount--,delete t[e.id],e.buffer.destroy(),e.buffer=null}var t={},a=0,p={uint8:5121,uint16:5123};u.oes_element_index_uint&&(p.uint32=5125),n.prototype.bind=function(){this.buffer.bind()};var o=[];return{create:function(e,t){function s(e){var t,r,n,i,a,o;return e?"number"==typeof e?(f(e),u.primType=4,u.vertCount=0|e,u.type=5121):(t=null,r=35044,i=n=-1,o=a=0,Array.isArray(e)||De(e)||ie(e)?t=e:("data"in e&&(t=e.data),"usage"in e&&(r=Be[e.usage]),"primitive"in e&&(n=Ue[e.primitive]),"count"in e&&(i=0|e.count),"type"in e&&(o=p[e.type]),"length"in e?a=0|e.length:(a=i,5123===o||5122===o?a*=2:5125!==o&&5124!==o||(a*=4))),l(u,t,r,n,i,a,o)):(f(),u.primType=4,u.vertCount=0,u.type=5121),s}var f=c.create(null,34963,!0),u=new n(f._buffer);return r.elementsCount++,s(e),s._reglType="elements",s._elements=u,s.subdata=function(e,t){return f.subdata(e,t),s},s.destroy=function(){i(u)},s},createStream:function(e){var t=o.pop();return l(t=t||new n(c.create(null,34963,!0,!1)._buffer),e,35040,-1,-1,0,0),t},destroyStream:function(e){o.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof n?e._elements:null},clear:function(){je(t).forEach(i)}}}(h,S,B,O),L=(g=h,v=C,y=O,w={},x={},A={},_=[],k=0,(b=e).profile&&(y.getMaxUniformsCount=function(){var t=0;return _.forEach(function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)}),t},y.getMaxAttributesCount=function(){var t=0;return _.forEach(function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)}),t}),{clear:function(){var e=g.deleteShader.bind(g);je(w).forEach(e),w={},je(x).forEach(e),x={},_.forEach(function(e){g.deleteProgram(e.program)}),_.length=0,A={},y.shaderCount=0},program:function(e,t,r,n){var i=A[t],a=(i=i||(A[t]={}))[e];if(a&&(a.refCount++,!n))return a;var o=new ee(t,e);return y.shaderCount++,te(o,0,n),a||(i[e]=o),_.push(o),Ee(o,{destroy:function(){var e;o.refCount--,o.refCount<=0&&(g.deleteProgram(o.program),e=_.indexOf(o),_.splice(e,1),y.shaderCount--),i[o.vertId].refCount<=0&&(g.deleteShader(x[o.vertId]),delete x[o.vertId],delete A[o.fragId][o.vertId]),Object.keys(A[o.fragId]).length||(g.deleteShader(w[o.fragId]),delete w[o.fragId],delete A[o.fragId])}})},restore:function(){w={},x={};for(var e=0;e<_.length;++e)te(_[e],0,_[e].attributes.map(function(e){return[e.location,e.name]}))},shader:$,frag:-1,vert:-1}),U=function(d,n,e,m,g,o,l){function r(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function p(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function v(e,t){var r,n,i,a;"object"==typeof t&&t&&("premultiplyAlpha"in t&&(e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(e.flipY=t.flipY),"alignment"in t&&(e.unpackAlignment=t.alignment),"colorSpace"in t&&(e.colorSpace=M[t.colorSpace]),"type"in t&&(e.type=I[t.type]),r=e.width,n=e.height,i=e.channels,a=!1,"shape"in t?(r=t.shape[0],n=t.shape[1],3===t.shape.length&&(i=t.shape[2],a=!0)):("radius"in t&&(r=n=t.radius),"width"in t&&(r=t.width),"height"in t&&(n=t.height),"channels"in t&&(i=t.channels,a=!0)),e.width=0|r,e.height=0|n,e.channels=0|i,r=!1,"format"in t&&(r=t.format,n=e.internalformat=R[r],e.format=W[n],r in I&&!("type"in t)&&(e.type=I[r]),r in B&&(e.compressed=!0),r=!0),!a&&r?e.channels=qe[e.format]:a&&!r&&e.channels!==Ne[e.format]&&(e.format=e.internalformat=Ne[e.channels]))}function y(e){d.pixelStorei(37440,e.flipY),d.pixelStorei(37441,e.premultiplyAlpha),d.pixelStorei(37443,e.colorSpace),d.pixelStorei(3317,e.unpackAlignment)}function t(){r.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function h(e,t){var r=null;if(he(t)?r=t:t&&(v(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),he(t.data)&&(r=t.data)),t.copy){var n=g.viewportWidth,i=g.viewportHeight;e.width=e.width||n-e.xOffset,e.height=e.height||i-e.yOffset,e.needsCopy=!0}else if(r){if(De(r))e.channels=e.channels||4,e.data=r,"type"in t||5121!==e.type||(e.type=0|Ie[Object.prototype.toString.call(r)]);else if(ce(r)){switch(e.channels=e.channels||4,i=(n=r).length,e.type){case 5121:case 5123:case 5125:case 5126:(i=Se.allocType(e.type,i)).set(n),e.data=i;break;case 36193:e.data=fe(n)}e.alignment=1,e.needsFree=!0}else if(ie(r)){n=r.data,Array.isArray(n)||5121!==e.type||(e.type=0|Ie[Object.prototype.toString.call(n)]);var a,i=r.shape,o=r.stride,s=3===i.length?(a=i[2],o[2]):a=1,f=i[0],u=i[1];i=o[0],o=o[1],e.alignment=1,e.width=f,e.height=u,e.channels=a,e.format=e.internalformat=Ne[a],e.needsFree=!0,f=s,r=r.offset,a=e.width,s=e.height,u=e.channels;for(var c=Se.allocType(36193===e.type?5126:e.type,a*s*u),l=0,p=0;p<s;++p)for(var h=0;h<a;++h)for(var d=0;d<u;++d)c[l++]=n[i*h+o*p+f*d+r];de(e,c)}else if(pe(r)===We||pe(r)===He||pe(r)===Ge)pe(r)===We||pe(r)===He?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(pe(r)===Qe)e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(pe(r)===Ye)e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(pe(r)===Xe)e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(le(r)){for(n=e.width||r[0].length,i=e.height||r.length,o=e.channels,o=ue(r[0][0])?o||r[0][0].length:o||1,f=Pe(r),a=1,s=0;s<f.length;++s)a*=f[s];a=Se.allocType(36193===e.type?5126:e.type,a),Me(r,f,"",a),de(e,a),e.alignment=1,e.width=n,e.height=i,e.channels=o,e.format=e.internalformat=Ne[o],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4}function b(e,t,r,n,i){var a=e.element,o=e.data,s=e.internalformat,f=e.format,u=e.type,c=e.width,l=e.height;y(e),a?d.texSubImage2D(t,i,r,n,f,u,a):e.compressed?d.compressedTexSubImage2D(t,i,r,n,s,c,l,o):e.needsCopy?(m(),d.copyTexSubImage2D(t,i,r,n,e.xOffset,e.yOffset,c,l)):d.texSubImage2D(t,i,r,n,c,l,f,u,o)}function w(){return H.pop()||new t}function x(e){e.needsFree&&Se.freeType(e.data),t.call(e),H.push(e)}function i(){r.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function A(e,t,r){var n=e.images[0]=w();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function _(e,t){var r=null;if(he(t))p(r=e.images[0]=w(),e),h(r,t),e.mipmask=1;else if(v(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,i=0;i<n.length;++i)p(r=e.images[i]=w(),e),r.width>>=i,r.height>>=i,h(r,n[i]),e.mipmask|=1<<i;else p(r=e.images[0]=w(),e),h(r,t),e.mipmask=1;p(e,e.images[0])}function k(e,t){for(var r=e.images,n=0;n<r.length&&r[n];++n){var i=r[n],a=t,o=n,s=i.element,f=i.data,u=i.internalformat,c=i.format,l=i.type,p=i.width,h=i.height;y(i),s?d.texImage2D(a,o,c,c,l,s):i.compressed?d.compressedTexImage2D(a,o,u,p,h,0,f):i.needsCopy?(m(),d.copyTexImage2D(a,o,c,i.xOffset,i.yOffset,p,h,0)):d.texImage2D(a,o,c,p,h,0,c,l,f||null)}}function E(){var e=G.pop()||new i;r.call(e);for(var t=e.mipmask=0;t<16;++t)e.images[t]=null;return e}function T(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&x(t[r]),t[r]=null;G.push(e)}function C(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function O(e,t){"min"in t&&(e.minFilter=c[t.min],0<=Ve.indexOf(e.minFilter)&&!("faces"in t)&&(e.genMipmaps=!0)),"mag"in t&&(e.magFilter=u[t.mag]);var r,n=e.wrapS,i=e.wrapT;if("wrap"in t?"string"==typeof(r=t.wrap)?n=i=f[r]:Array.isArray(r)&&(n=f[r[0]],i=f[r[1]]):("wrapS"in t&&(n=f[t.wrapS]),"wrapT"in t&&(i=f[t.wrapT])),e.wrapS=n,e.wrapT=i,"anisotropic"in t&&(e.anisotropic=t.anisotropic),"mipmap"in t){switch(n=!1,typeof t.mipmap){case"string":e.mipmapHint=s[t.mipmap],n=e.genMipmaps=!0;break;case"boolean":n=e.genMipmaps=t.mipmap;break;case"object":n=!(e.genMipmaps=!1)}!n||"min"in t||(e.minFilter=9984)}}function S(e,t){d.texParameteri(t,10241,e.minFilter),d.texParameteri(t,10240,e.magFilter),d.texParameteri(t,10242,e.wrapS),d.texParameteri(t,10243,e.wrapT),n.ext_texture_filter_anisotropic&&d.texParameteri(t,34046,e.anisotropic),e.genMipmaps&&(d.hint(33170,e.mipmapHint),d.generateMipmap(t))}function j(e){r.call(this),this.mipmask=0,this.internalformat=6408,this.id=Q++,this.refCount=1,this.target=e,this.texture=d.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new C,l.profile&&(this.stats={size:0})}function D(e){d.activeTexture(33984),d.bindTexture(e.target,e.texture)}function P(){var e=J[0];e?d.bindTexture(e.target,e.texture):d.bindTexture(3553,null)}function a(e){var t=e.texture,r=e.unit,n=e.target;0<=r&&(d.activeTexture(33984+r),d.bindTexture(n,null),J[r]=null),d.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete Y[e.id],o.textureCount--}var s={"don't care":4352,"dont care":4352,nice:4354,fast:4353},f={repeat:10497,clamp:33071,mirror:33648},u={nearest:9728,linear:9729},c=Ee({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},u),M={none:0,browser:37444},I={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},R={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},B={};n.ext_srgb&&(R.srgb=35904,R.srgba=35906),n.oes_texture_float&&(I.float32=I.float=5126),n.oes_texture_half_float&&(I.float16=I["half float"]=36193),n.webgl_depth_texture&&(Ee(R,{depth:6402,"depth stencil":34041}),Ee(I,{uint16:5123,uint32:5125,"depth stencil":34042})),n.webgl_compressed_texture_s3tc&&Ee(B,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),n.webgl_compressed_texture_atc&&Ee(B,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),n.webgl_compressed_texture_pvrtc&&Ee(B,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),n.webgl_compressed_texture_etc1&&(B["rgb etc1"]=36196);var F=Array.prototype.slice.call(d.getParameter(34467));Object.keys(B).forEach(function(e){var t=B[e];0<=F.indexOf(t)&&(R[e]=t)});var z=Object.keys(R);e.textureFormats=z;var L=[];Object.keys(R).forEach(function(e){L[R[e]]=e});var U=[];Object.keys(I).forEach(function(e){U[I[e]]=e});var V=[];Object.keys(u).forEach(function(e){V[u[e]]=e});var N=[];Object.keys(c).forEach(function(e){N[c[e]]=e});var q=[];Object.keys(f).forEach(function(e){q[f[e]]=e});var W=z.reduce(function(e,t){var r=R[t];return 6409===r||6406===r||6409===r||6410===r||6402===r||34041===r||n.ext_srgb&&(35904===r||35906===r)?e[r]=r:32855===r||0<=t.indexOf("rgba")?e[r]=6408:e[r]=6407,e},{}),H=[],G=[],Q=0,Y={},X=e.maxTextureUnits,J=Array(X).map(function(){return null});return Ee(j.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<X;++t){var r=J[t];if(r){if(0<r.bindCount)continue;r.unit=-1}J[t]=this,e=t;break}l.profile&&o.maxTextureUnits<e+1&&(o.maxTextureUnits=e+1),this.unit=e,d.activeTexture(33984+e),d.bindTexture(this.target,this.texture)}return e},unbind:function(){--this.bindCount},decRef:function(){--this.refCount<=0&&a(this)}}),l.profile&&(o.getTotalTextureSize=function(){var t=0;return Object.keys(Y).forEach(function(e){t+=Y[e].stats.size}),t}),{create2D:function(e,t){function s(e,t){var r=f.texInfo;C.call(r);var n=E();return"number"==typeof e?A(n,0|e,"number"==typeof t?0|t:0|e):e?(O(r,e),_(n,e)):A(n,1,1),r.genMipmaps&&(n.mipmask=(n.width<<1)-1),f.mipmask=n.mipmask,p(f,n),f.internalformat=n.internalformat,s.width=n.width,s.height=n.height,D(f),k(n,3553),S(r,3553),P(),T(n),l.profile&&(f.stats.size=me(f.internalformat,f.type,n.width,n.height,r.genMipmaps,!1)),s.format=L[f.internalformat],s.type=U[f.type],s.mag=V[r.magFilter],s.min=N[r.minFilter],s.wrapS=q[r.wrapS],s.wrapT=q[r.wrapT],s}var f=new j(3553);return Y[f.id]=f,o.textureCount++,s(e,t),s.subimage=function(e,t,r,n){t|=0,r|=0,n|=0;var i=w();return p(i,f),i.width=0,i.height=0,h(i,e),i.width=i.width||(f.width>>n)-t,i.height=i.height||(f.height>>n)-r,D(f),b(i,3553,t,r,n),P(),x(i),s},s.resize=function(e,t){var r=0|e,n=0|t||r;if(r===f.width&&n===f.height)return s;s.width=f.width=r,s.height=f.height=n,D(f);for(var i=0;f.mipmask>>i;++i){var a=r>>i,o=n>>i;if(!a||!o)break;d.texImage2D(3553,i,f.format,a,o,0,f.format,f.type,null)}return P(),l.profile&&(f.stats.size=me(f.internalformat,f.type,r,n,!1,!1)),s},s._reglType="texture2d",s._texture=f,l.profile&&(s.stats=f.stats),s.destroy=function(){f.decRef()},s},createCube:function(e,t,r,n,i,a){function f(e,t,r,n,i,a){var o,s=u.texInfo;for(C.call(s),o=0;o<6;++o)c[o]=E();if("number"!=typeof e&&e){if("object"==typeof e)if(t)_(c[0],e),_(c[1],t),_(c[2],r),_(c[3],n),_(c[4],i),_(c[5],a);else if(O(s,e),v(u,e),"faces"in e)for(e=e.faces,o=0;o<6;++o)p(c[o],u),_(c[o],e[o]);else for(o=0;o<6;++o)_(c[o],e)}else for(e=0|e||1,o=0;o<6;++o)A(c[o],e,e);for(p(u,c[0]),u.mipmask=s.genMipmaps?(c[0].width<<1)-1:c[0].mipmask,u.internalformat=c[0].internalformat,f.width=c[0].width,f.height=c[0].height,D(u),o=0;o<6;++o)k(c[o],34069+o);for(S(s,34067),P(),l.profile&&(u.stats.size=me(u.internalformat,u.type,f.width,f.height,s.genMipmaps,!0)),f.format=L[u.internalformat],f.type=U[u.type],f.mag=V[s.magFilter],f.min=N[s.minFilter],f.wrapS=q[s.wrapS],f.wrapT=q[s.wrapT],o=0;o<6;++o)T(c[o]);return f}var u=new j(34067);Y[u.id]=u,o.cubeCount++;var c=Array(6);return f(e,t,r,n,i,a),f.subimage=function(e,t,r,n,i){r|=0,n|=0,i|=0;var a=w();return p(a,u),a.width=0,a.height=0,h(a,t),a.width=a.width||(u.width>>i)-r,a.height=a.height||(u.height>>i)-n,D(u),b(a,34069+e,r,n,i),P(),x(a),f},f.resize=function(e){if((e|=0)!==u.width){f.width=u.width=e,f.height=u.height=e,D(u);for(var t=0;t<6;++t)for(var r=0;u.mipmask>>r;++r)d.texImage2D(34069+t,r,u.format,e>>r,e>>r,0,u.format,u.type,null);return P(),l.profile&&(u.stats.size=me(u.internalformat,u.type,f.width,f.height,!1,!0)),f}},f._reglType="textureCube",f._texture=u,l.profile&&(f.stats=u.stats),f.destroy=function(){u.decRef()},f},clear:function(){for(var e=0;e<X;++e)d.activeTexture(33984+e),d.bindTexture(3553,null),J[e]=null;je(Y).forEach(a),o.cubeCount=0,o.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<X;++e){var t=J[e];t&&(t.bindCount=0,t.unit=-1,J[e]=null)}je(Y).forEach(function(e){e.texture=d.createTexture(),d.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(3553===e.target)d.texImage2D(3553,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)d.texImage2D(34069+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);S(e.texInfo,e.target)})},refresh:function(){for(var e=0;e<X;++e){var t=J[e];t&&(t.bindCount=0,t.unit=-1,J[e]=null),d.activeTexture(33984+e),d.bindTexture(3553,null),d.bindTexture(34067,null)}}}}(h,S,R,function(){q.procs.poll()},I,O,e),V=function(s,e,r,f){function n(e){this.id=i++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.height=this.width=0,f.profile&&(this.stats={size:0})}function t(e){var t=e.renderbuffer;s.bindRenderbuffer(36161,null),s.deleteRenderbuffer(t),e.renderbuffer=null,e.refCount=0,delete l[e.id],r.renderbufferCount--}var u={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(u.srgba=35907),e.ext_color_buffer_half_float&&(u.rgba16f=34842,u.rgb16f=34843),e.webgl_color_buffer_float&&(u.rgba32f=34836);var c=[];Object.keys(u).forEach(function(e){c[u[e]]=e});var i=0,l={};return n.prototype.decRef=function(){--this.refCount<=0&&t(this)},f.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(l).forEach(function(e){t+=l[e].stats.size}),t}),{create:function(e,t){function a(e,t){var r=0,n=0,i=32854;if("object"==typeof e&&e?("shape"in e?(r=0|(n=e.shape)[0],n=0|n[1]):("radius"in e&&(r=n=0|e.radius),"width"in e&&(r=0|e.width),"height"in e&&(n=0|e.height)),"format"in e&&(i=u[e.format])):"number"==typeof e?(r=0|e,n="number"==typeof t?0|t:r):e||(r=n=1),r!==o.width||n!==o.height||i!==o.format)return a.width=o.width=r,a.height=o.height=n,o.format=i,s.bindRenderbuffer(36161,o.renderbuffer),s.renderbufferStorage(36161,i,r,n),f.profile&&(o.stats.size=Je[o.format]*o.width*o.height),a.format=c[o.format],a}var o=new n(s.createRenderbuffer());return l[o.id]=o,r.renderbufferCount++,a(e,t),a.resize=function(e,t){e|=0,t=0|t||e;return e===o.width&&t===o.height||(a.width=o.width=e,a.height=o.height=t,s.bindRenderbuffer(36161,o.renderbuffer),s.renderbufferStorage(36161,o.format,e,t),f.profile&&(o.stats.size=Je[o.format]*o.width*o.height)),a},a._reglType="renderbuffer",a._renderbuffer=o,f.profile&&(a.stats=o.stats),a.destroy=function(){o.decRef()},a},clear:function(){je(l).forEach(t)},restore:function(){je(l).forEach(function(e){e.renderbuffer=s.createRenderbuffer(),s.bindRenderbuffer(36161,e.renderbuffer),s.renderbufferStorage(36161,e.format,e.width,e.height)}),s.bindRenderbuffer(36161,null)}}}(h,S,O,e),N=function(n,e,i,u,a,r){function o(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=e=0;t?(e=t.width,n=t.height):r&&(e=r.width,n=r.height),this.width=e,this.height=n}function t(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function b(e){e&&(e.texture?e.texture._texture.refCount+=1:e.renderbuffer._renderbuffer.refCount+=1)}function s(e,t){t&&(t.texture?n.framebufferTexture2D(36160,e,t.target,t.texture._texture.texture,0):n.framebufferRenderbuffer(36160,e,36161,t.renderbuffer._renderbuffer.renderbuffer))}function w(e){var t=3553,r=null,n=null,i=e;return"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),"texture2d"===(e=i._reglType)||"textureCube"===e?r=i:"renderbuffer"===e&&(n=i,t=36161),new o(t,r,n)}function x(e,t,r,n,i){return r?((e=u.create2D({width:e,height:t,format:n,type:i}))._texture.refCount=0,new o(3553,e,null)):((e=a.create({width:e,height:t,format:n}))._renderbuffer.refCount=0,new o(36161,null,e))}function A(e){return e&&(e.texture||e.renderbuffer)}function f(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r),e.width=t,e.height=r)}function c(){this.id=m++,(g[this.id]=this).framebuffer=n.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function _(e){e.colorAttachments.forEach(t),t(e.depthAttachment),t(e.stencilAttachment),t(e.depthStencilAttachment)}function l(e){n.deleteFramebuffer(e.framebuffer),e.framebuffer=null,r.framebufferCount--,delete g[e.id]}function k(e){n.bindFramebuffer(36160,e.framebuffer);for(var t=e.colorAttachments,r=0;r<t.length;++r)s(36064+r,t[r]);for(r=t.length;r<i.maxColorAttachments;++r)n.framebufferTexture2D(36160,36064+r,3553,null,0);n.framebufferTexture2D(36160,33306,3553,null,0),n.framebufferTexture2D(36160,36096,3553,null,0),n.framebufferTexture2D(36160,36128,3553,null,0),s(36096,e.depthAttachment),s(36128,e.stencilAttachment),s(33306,e.depthStencilAttachment),n.checkFramebufferStatus(36160),n.isContextLost(),n.bindFramebuffer(36160,h.next?h.next.framebuffer:null),h.cur=h.next,n.getError()}function p(e,t){function v(e,t){var r=0,n=0,i=!0,a=!0,o=null,s=!0,f="rgba",u="uint8",c=1,l=null,p=null,h=null,d=!1;"number"==typeof e?(r=0|e,n=0|t||r):e?("shape"in e?(r=(n=e.shape)[0],n=n[1]):("radius"in e&&(r=n=e.radius),"width"in e&&(r=e.width),"height"in e&&(n=e.height)),("color"in e||"colors"in e)&&(o=e.color||e.colors,Array.isArray(o)),o||("colorCount"in e&&(c=0|e.colorCount),"colorTexture"in e&&(s=!!e.colorTexture,f="rgba4"),"colorType"in e&&(u=e.colorType,!s)&&("half float"===u||"float16"===u?f="rgba16f":"float"!==u&&"float32"!==u||(f="rgba32f")),"colorFormat"in e&&(f=e.colorFormat,0<=E.indexOf(f)?s=!0:0<=T.indexOf(f)&&(s=!1))),("depthTexture"in e||"depthStencilTexture"in e)&&(d=!(!e.depthTexture&&!e.depthStencilTexture)),"depth"in e&&("boolean"==typeof e.depth?i=e.depth:(l=e.depth,a=!1)),"stencil"in e&&("boolean"==typeof e.stencil?a=e.stencil:(p=e.stencil,i=!1)),"depthStencil"in e&&("boolean"==typeof e.depthStencil?i=a=e.depthStencil:(h=e.depthStencil,a=i=!1))):r=n=1;var m=null,g=null,t=null,e=null;if(Array.isArray(o))m=o.map(w);else if(o)m=[w(o)];else for(m=Array(c),o=0;o<c;++o)m[o]=x(r,n,s,f,u);for(r=r||m[0].width,n=n||m[0].height,l?g=w(l):i&&!a&&(g=x(r,n,d,"depth","uint32")),p?t=w(p):a&&!i&&(t=x(r,n,!1,"stencil","uint8")),h?e=w(h):!l&&!p&&a&&i&&(e=x(r,n,d,"depth stencil","depth stencil")),i=null,o=0;o<m.length;++o)b(m[o]),m[o]&&m[o].texture&&(a=Ke[m[o].texture._texture.format]*Ze[m[o].texture._texture.type],null===i&&(i=a));return b(g),b(t),b(e),_(y),y.width=r,y.height=n,y.colorAttachments=m,y.depthAttachment=g,y.stencilAttachment=t,y.depthStencilAttachment=e,v.color=m.map(A),v.depth=A(g),v.stencil=A(t),v.depthStencil=A(e),v.width=y.width,v.height=y.height,k(y),v}var y=new c;return r.framebufferCount++,v(e,t),Ee(v,{resize:function(e,t){var r=Math.max(0|e,1),n=Math.max(0|t||r,1);if(r===y.width&&n===y.height)return v;for(var i=y.colorAttachments,a=0;a<i.length;++a)f(i[a],r,n);return f(y.depthAttachment,r,n),f(y.stencilAttachment,r,n),f(y.depthStencilAttachment,r,n),y.width=v.width=r,y.height=v.height=n,k(y),v},_reglType:"framebuffer",_framebuffer:y,destroy:function(){l(y),_(y)},use:function(e){h.setFBO({framebuffer:v},e)}})}var h={cur:null,next:null,dirty:!1,setFBO:null},E=["rgba"],T=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&T.push("srgba"),e.ext_color_buffer_half_float&&T.push("rgba16f","rgb16f"),e.webgl_color_buffer_float&&T.push("rgba32f");var d=["uint8"];e.oes_texture_half_float&&d.push("half float","float16"),e.oes_texture_float&&d.push("float","float32");var m=0,g={};return Ee(h,{getFramebuffer:function(e){return"function"==typeof e&&"framebuffer"===e._reglType&&(e=e._framebuffer)instanceof c?e:null},create:p,createCube:function(e){function s(e){var t={color:null},r=0,n=null,i="rgba",a="uint8",o=1;if("number"==typeof e?r=0|e:e?("shape"in e?r=e.shape[0]:("radius"in e&&(r=0|e.radius),"width"in e?r=0|e.width:"height"in e&&(r=0|e.height)),("color"in e||"colors"in e)&&(n=e.color||e.colors,Array.isArray(n)),n||("colorCount"in e&&(o=0|e.colorCount),"colorType"in e&&(a=e.colorType),"colorFormat"in e&&(i=e.colorFormat)),"depth"in e&&(t.depth=e.depth),"stencil"in e&&(t.stencil=e.stencil),"depthStencil"in e&&(t.depthStencil=e.depthStencil)):r=1,n)if(Array.isArray(n))for(e=[],i=0;i<n.length;++i)e[i]=n[i];else e=[n];else for(e=Array(o),n={radius:r,format:i,type:a},i=0;i<o;++i)e[i]=u.createCube(n);for(t.color=Array(e.length),i=0;i<e.length;++i)o=e[i],r=r||o.width,t.color[i]={target:34069,data:e[i]};for(i=0;i<6;++i){for(o=0;o<e.length;++o)t.color[o].target=34069+i;0<i&&(t.depth=f[0].depth,t.stencil=f[0].stencil,t.depthStencil=f[0].depthStencil),f[i]?f[i](t):f[i]=p(t)}return Ee(s,{width:r,height:r,color:e})}var f=Array(6);return s(e),Ee(s,{faces:f,resize:function(e){var t=0|e;if(t===s.width)return s;var r=s.color;for(e=0;e<r.length;++e)r[e].resize(t);for(e=0;e<6;++e)f[e].resize(t);return s.width=s.height=t,s},_reglType:"framebufferCube",destroy:function(){f.forEach(function(e){e.destroy()})}})},clear:function(){je(g).forEach(l)},restore:function(){h.cur=null,h.next=null,h.dirty=!0,je(g).forEach(function(e){e.framebuffer=n.createFramebuffer(),k(e)})}})}(h,S,R,U,V,O),q=_e(h,C,S,R,B,z,0,N,{},F,L,{elements:null,primitive:4,count:-1,offset:0,instances:-1},I,j,e),C=ve(h,N,q.procs.poll,I),W=q.next,H=h.canvas,G=[],Q=[],Y=[],X=[e.onDestroy],J=null;function K(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function Z(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function $(e,t,r){var n,i=(r=35632===e?w:x)[t];return i||(n=v.str(t),i=g.createShader(e),g.shaderSource(i,n),g.compileShader(i),r[t]=i),i}function ee(e,t){this.id=k++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,b.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function te(e,t,r){var n=$(35632,e.fragId),i=$(35633,e.vertId);if(t=e.program=g.createProgram(),g.attachShader(t,n),g.attachShader(t,i),r)for(n=0;n<r.length;++n)i=r[n],g.bindAttribLocation(t,i[0],i[1]);g.linkProgram(t),i=g.getProgramParameter(t,35718),b.profile&&(e.stats.uniformsCount=i);var a=e.uniforms;for(n=0;n<i;++n)if(r=g.getActiveUniform(t,n))if(1<r.size)for(var o=0;o<r.size;++o){var s=r.name.replace("[0]","["+o+"]");Z(a,new K(s,v.id(s),g.getUniformLocation(t,s),r))}else Z(a,new K(r.name,v.id(r.name),g.getUniformLocation(t,r.name),r));for(i=g.getProgramParameter(t,35721),b.profile&&(e.stats.attributesCount=i),e=e.attributes,n=0;n<i;++n)(r=g.getActiveAttrib(t,n))&&Z(e,new K(r.name,v.id(r.name),g.getAttribLocation(t,r.name),r))}H&&(H.addEventListener("webglcontextlost",t,!1),H.addEventListener("webglcontextrestored",a,!1));var re=N.setFBO=o({framebuffer:Te.define.call(null,1,"framebuffer")});return l(),d=Ee(o,{clear:function(e){if("framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;t<6;++t)re(Ee({framebuffer:e.framebuffer.faces[t]},e),s);else re(e,s);else s(0,e)},prop:Te.define.bind(null,1),context:Te.define.bind(null,2),this:Te.define.bind(null,3),draw:o({}),buffer:function(e){return B.create(e,34962,!1,!1)},elements:function(e){return z.create(e,!1)},texture:U.create2D,cube:U.createCube,renderbuffer:V.create,framebuffer:N.create,framebufferCube:N.createCube,vao:F.createVAO,attributes:d,frame:f,on:function(e,t){var r;switch(e){case"frame":return f(t);case"lost":r=Q;break;case"restore":r=Y;break;case"destroy":r=X}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t){r[e]=r[r.length-1],r.pop();break}}}},limits:R,hasExtension:function(e){return 0<=R.extensions.indexOf(e.toLowerCase())},read:C,destroy:function(){G.length=0,i(),H&&(H.removeEventListener("webglcontextlost",t),H.removeEventListener("webglcontextrestored",a)),L.clear(),N.clear(),V.clear(),U.clear(),z.clear(),B.clear(),F.clear(),j&&j.clear(),X.forEach(function(e){e()})},_gl:h,_refresh:l,poll:function(){c(),j&&j.update()},now:p,stats:O}),e.onDone(null,d),d}},"object"==typeof r&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):n.createREGL=i()},{}],121:[function(e,t,r){(function(s){(function(){"use strict";var n=e("pick-by-alias");function i(e){var t;e.container&&(e.container==document.body?(document.body.style.width||(e.canvas.width=e.width||e.pixelRatio*s.innerWidth),document.body.style.height||(e.canvas.height=e.height||e.pixelRatio*s.innerHeight)):(t=e.container.getBoundingClientRect(),e.canvas.width=e.width||t.right-t.left,e.canvas.height=e.height||t.bottom-t.top))}function a(e){return"function"==typeof e.getContext&&"width"in e&&"height"in e}function o(){var e=document.createElement("canvas");return e.style.position="absolute",e.style.top=0,e.style.left=0,e}t.exports=function(t){var e;if(t?"string"==typeof t&&(t={container:t}):t={},(t=a(t)||"string"==typeof(e=t).nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect?{container:t}:"function"==typeof(r=t).drawArrays||"function"==typeof r.drawElements?{gl:t}:n(t,{container:"container target element el canvas holder parent parentNode wrapper use ref root node",gl:"gl context webgl glContext",attrs:"attributes attrs contextAttributes",pixelRatio:"pixelRatio pxRatio px ratio pxratio pixelratio",width:"w width",height:"h height"},!0)).pixelRatio||(t.pixelRatio=s.pixelRatio||1),t.gl)return t.gl;if(t.canvas&&(t.container=t.canvas.parentNode),t.container){if("string"==typeof t.container){var r=document.querySelector(t.container);if(!r)throw Error("Element "+t.container+" is not found");t.container=r}a(t.container)?(t.canvas=t.container,t.container=t.canvas.parentNode):t.canvas||(t.canvas=o(),t.container.appendChild(t.canvas),i(t))}else if(!t.canvas){if("undefined"==typeof document)throw Error("Not DOM environment. Use headless-gl.");t.container=document.body||document.documentElement,t.canvas=o(),t.container.appendChild(t.canvas),i(t)}return t.gl||["webgl","experimental-webgl","webgl-experimental"].some(function(e){try{t.gl=t.canvas.getContext(e,t.attrs)}catch(e){}return t.gl}),t.gl}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"pick-by-alias":176}],122:[function(e,t,r){t.exports=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}},{}],123:[function(e,t,r){t.exports=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}},{}],124:[function(e,t,r){t.exports=function(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}},{}],125:[function(e,t,r){t.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e}},{}],126:[function(e,t,r){t.exports=function(){var e=new Float32Array(2);return e[0]=0,e[1]=0,e}},{}],127:[function(e,t,r){t.exports=function(e,t,r){r=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=r,e}},{}],128:[function(e,t,r){t.exports=e("./distance")},{"./distance":129}],129:[function(e,t,r){t.exports=function(e,t){var r=t[0]-e[0],e=t[1]-e[1];return Math.sqrt(r*r+e*e)}},{}],130:[function(e,t,r){t.exports=e("./divide")},{"./divide":131}],131:[function(e,t,r){t.exports=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}},{}],132:[function(e,t,r){t.exports=function(e,t){return e[0]*t[0]+e[1]*t[1]}},{}],133:[function(e,t,r){t.exports=1e-6},{}],134:[function(e,t,r){t.exports=function(e,t){var r=e[0],n=e[1],e=t[0],t=t[1];return Math.abs(r-e)<=i*Math.max(1,Math.abs(r),Math.abs(e))&&Math.abs(n-t)<=i*Math.max(1,Math.abs(n),Math.abs(t))};var i=e("./epsilon")},{"./epsilon":133}],135:[function(e,t,r){t.exports=function(e,t){return e[0]===t[0]&&e[1]===t[1]}},{}],136:[function(e,t,r){t.exports=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}},{}],137:[function(e,t,r){t.exports=function(e,t,r,n,i,a){var o,s;t=t||2;r=r||0;s=n?Math.min(n*t+r,e.length):e.length;for(o=r;o<s;o+=t)f[0]=e[o],f[1]=e[o+1],i(f,f,a),e[o]=f[0],e[o+1]=f[1];return e};var f=e("./create")()},{"./create":126}],138:[function(e,t,r){t.exports=function(e,t){var r=new Float32Array(2);return r[0]=e,r[1]=t,r}},{}],139:[function(e,t,r){t.exports={EPSILON:e("./epsilon"),create:e("./create"),clone:e("./clone"),fromValues:e("./fromValues"),copy:e("./copy"),set:e("./set"),equals:e("./equals"),exactEquals:e("./exactEquals"),add:e("./add"),subtract:e("./subtract"),sub:e("./sub"),multiply:e("./multiply"),mul:e("./mul"),divide:e("./divide"),div:e("./div"),inverse:e("./inverse"),min:e("./min"),max:e("./max"),rotate:e("./rotate"),floor:e("./floor"),ceil:e("./ceil"),round:e("./round"),scale:e("./scale"),scaleAndAdd:e("./scaleAndAdd"),distance:e("./distance"),dist:e("./dist"),squaredDistance:e("./squaredDistance"),sqrDist:e("./sqrDist"),length:e("./length"),len:e("./len"),squaredLength:e("./squaredLength"),sqrLen:e("./sqrLen"),negate:e("./negate"),normalize:e("./normalize"),dot:e("./dot"),cross:e("./cross"),lerp:e("./lerp"),random:e("./random"),transformMat2:e("./transformMat2"),transformMat2d:e("./transformMat2d"),transformMat3:e("./transformMat3"),transformMat4:e("./transformMat4"),forEach:e("./forEach"),limit:e("./limit")}},{"./add":122,"./ceil":123,"./clone":124,"./copy":125,"./create":126,"./cross":127,"./dist":128,"./distance":129,"./div":130,"./divide":131,"./dot":132,"./epsilon":133,"./equals":134,"./exactEquals":135,"./floor":136,"./forEach":137,"./fromValues":138,"./inverse":140,"./len":141,"./length":142,"./lerp":143,"./limit":144,"./max":145,"./min":146,"./mul":147,"./multiply":148,"./negate":149,"./normalize":150,"./random":151,"./rotate":152,"./round":153,"./scale":154,"./scaleAndAdd":155,"./set":156,"./sqrDist":157,"./sqrLen":158,"./squaredDistance":159,"./squaredLength":160,"./sub":161,"./subtract":162,"./transformMat2":163,"./transformMat2d":164,"./transformMat3":165,"./transformMat4":166}],140:[function(e,t,r){t.exports=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}},{}],141:[function(e,t,r){t.exports=e("./length")},{"./length":142}],142:[function(e,t,r){t.exports=function(e){var t=e[0],e=e[1];return Math.sqrt(t*t+e*e)}},{}],143:[function(e,t,r){t.exports=function(e,t,r,n){var i=t[0],t=t[1];return e[0]=i+n*(r[0]-i),e[1]=t+n*(r[1]-t),e}},{}],144:[function(e,t,r){t.exports=function(e,t,r){var n=t[0]*t[0]+t[1]*t[1];r*r<n?(n=Math.sqrt(n),e[0]=t[0]/n*r,e[1]=t[1]/n*r):(e[0]=t[0],e[1]=t[1]);return e}},{}],145:[function(e,t,r){t.exports=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}},{}],146:[function(e,t,r){t.exports=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}},{}],147:[function(e,t,r){t.exports=e("./multiply")},{"./multiply":148}],148:[function(e,t,r){t.exports=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}},{}],149:[function(e,t,r){t.exports=function(e,t){return e[0]=-t[0],e[1]=-t[1],e}},{}],150:[function(e,t,r){t.exports=function(e,t){var r=t[0],n=t[1],n=r*r+n*n;0<n&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n);return e}},{}],151:[function(e,t,r){t.exports=function(e,t){t=t||1;var r=2*Math.random()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}},{}],152:[function(e,t,r){t.exports=function(e,t,r){var n=Math.cos(r),i=Math.sin(r),r=t[0],t=t[1];return e[0]=r*n-t*i,e[1]=r*i+t*n,e}},{}],153:[function(e,t,r){t.exports=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}},{}],154:[function(e,t,r){t.exports=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}},{}],155:[function(e,t,r){t.exports=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}},{}],156:[function(e,t,r){t.exports=function(e,t,r){return e[0]=t,e[1]=r,e}},{}],157:[function(e,t,r){t.exports=e("./squaredDistance")},{"./squaredDistance":159}],158:[function(e,t,r){t.exports=e("./squaredLength")},{"./squaredLength":160}],159:[function(e,t,r){t.exports=function(e,t){var r=t[0]-e[0],e=t[1]-e[1];return r*r+e*e}},{}],160:[function(e,t,r){t.exports=function(e){var t=e[0],e=e[1];return t*t+e*e}},{}],161:[function(e,t,r){t.exports=e("./subtract")},{"./subtract":162}],162:[function(e,t,r){t.exports=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}},{}],163:[function(e,t,r){t.exports=function(e,t,r){var n=t[0],t=t[1];return e[0]=r[0]*n+r[2]*t,e[1]=r[1]*n+r[3]*t,e}},{}],164:[function(e,t,r){t.exports=function(e,t,r){var n=t[0],t=t[1];return e[0]=r[0]*n+r[2]*t+r[4],e[1]=r[1]*n+r[3]*t+r[5],e}},{}],165:[function(e,t,r){t.exports=function(e,t,r){var n=t[0],t=t[1];return e[0]=r[0]*n+r[3]*t+r[6],e[1]=r[1]*n+r[4]*t+r[7],e}},{}],166:[function(e,t,r){t.exports=function(e,t,r){var n=t[0],t=t[1];return e[0]=r[0]*n+r[4]*t+r[12],e[1]=r[1]*n+r[5]*t+r[13],e}},{}],167:[function(e,t,r){Math.PI;var i=Math.round,n=Math.min,a=Math.max,o=Math.ceil;function s(e,t,r,n){n[0]=i(255*e),n[1]=i(255*t),n[2]=i(255*r)}function f(e,t,r){return a(t,n(e,r))}t.exports=function(e,t,r,n){if(n=n||[0,0,0],e%=360,t=f(t,0,1),r=f(r,0,1),t){var i=(1-t)*r,a=r-i,t=e%60;switch(e/60|0){case 0:s(r,a*e/60+i,i,n);break;case 1:s(a*(60-t)/60+i,r,i,n);break;case 2:s(i,r,a*t/60+i,n);break;case 3:s(i,a*(60-t)/60+i,r,n);break;case 4:s(a*t/60+i,i,r,n);break;case 5:s(r,i,a*(60-t)/60+i,n)}}else n[0]=n[1]=n[2]=o(255*r);return n}},{}],168:[function(e,t,r){r.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,f=(1<<s)-1,u=f>>1,c=-7,l=r?i-1:0,p=r?-1:1,r=e[t+l];for(l+=p,a=r&(1<<-c)-1,r>>=-c,c+=s;0<c;a=256*a+e[t+l],l+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;0<c;o=256*o+e[t+l],l+=p,c-=8);if(0===a)a=1-u;else{if(a===f)return o?NaN:1/0*(r?-1:1);o+=Math.pow(2,n),a-=u}return(r?-1:1)*o*Math.pow(2,a-n)},r.write=function(e,t,r,n,i,a){var o,s,f=8*a-i-1,u=(1<<f)-1,c=u>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:a-1,h=n?1:-1,a=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-o))<1&&(o--,n*=2),2<=(t+=1<=o+c?l/n:l*Math.pow(2,1-c))*n&&(o++,n/=2),u<=o+c?(s=0,o=u):1<=o+c?(s=(t*n-1)*Math.pow(2,i),o+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,i),o=0));8<=i;e[r+p]=255&s,p+=h,s/=256,i-=8);for(o=o<<i|s,f+=i;0<f;e[r+p]=255&o,p+=h,o/=256,f-=8);e[r+p-h]|=128*a}},{}],169:[function(e,t,r){"use strict";var n=Object.prototype.toString;t.exports=function(e){return"[object Object]"===n.call(e)&&(null===(e=Object.getPrototypeOf(e))||e===Object.getPrototypeOf({}))}},{}],170:[function(e,t,r){"use strict";t.exports=function(t,i){i||(i=t,t=window);var a=0,o=0,s=0,f={shift:!1,alt:!1,control:!1,meta:!1},r=!1;function u(e){var t=!1;return"altKey"in e&&(t=t||e.altKey!==f.alt,f.alt=!!e.altKey),"shiftKey"in e&&(t=t||e.shiftKey!==f.shift,f.shift=!!e.shiftKey),"ctrlKey"in e&&(t=t||e.ctrlKey!==f.control,f.control=!!e.ctrlKey),"metaKey"in e&&(t=t||e.metaKey!==f.meta,f.meta=!!e.metaKey),t}function n(e,t){var r=v.x(t),n=v.y(t);"buttons"in t&&(e=0|t.buttons),e===a&&r===o&&n===s&&!u(t)||(a=0|e,o=r||0,s=n||0,i&&i(a,o,s,f))}function c(e){n(0,e)}function l(){(a||o||s||f.shift||f.alt||f.meta||f.control)&&(o=s=0,a=0,f.shift=f.alt=f.control=f.meta=!1,i&&i(0,0,0,f))}function p(e){u(e)&&i&&i(a,o,s,f)}function h(e){0===v.buttons(e)?n(0,e):n(a,e)}function d(e){n(a|v.buttons(e),e)}function m(e){n(a&~v.buttons(e),e)}function g(){r||(r=!0,t.addEventListener("mousemove",h),t.addEventListener("mousedown",d),t.addEventListener("mouseup",m),t.addEventListener("mouseleave",c),t.addEventListener("mouseenter",c),t.addEventListener("mouseout",c),t.addEventListener("mouseover",c),t.addEventListener("blur",l),t.addEventListener("keyup",p),t.addEventListener("keydown",p),t.addEventListener("keypress",p),t!==window&&(window.addEventListener("blur",l),window.addEventListener("keyup",p),window.addEventListener("keydown",p),window.addEventListener("keypress",p)))}g();var e={element:t};return Object.defineProperties(e,{enabled:{get:function(){return r},set:function(e){(e?g:function(){if(!r)return;r=!1,t.removeEventListener("mousemove",h),t.removeEventListener("mousedown",d),t.removeEventListener("mouseup",m),t.removeEventListener("mouseleave",c),t.removeEventListener("mouseenter",c),t.removeEventListener("mouseout",c),t.removeEventListener("mouseover",c),t.removeEventListener("blur",l),t.removeEventListener("keyup",p),t.removeEventListener("keydown",p),t.removeEventListener("keypress",p),t!==window&&(window.removeEventListener("blur",l),window.removeEventListener("keyup",p),window.removeEventListener("keydown",p),window.removeEventListener("keypress",p))})()},enumerable:!0},buttons:{get:function(){return a},enumerable:!0},x:{get:function(){return o},enumerable:!0},y:{get:function(){return s},enumerable:!0},mods:{get:function(){return f},enumerable:!0}}),e};var v=e("mouse-event")},{"mouse-event":171}],171:[function(e,t,r){"use strict";function n(e){return e.target||e.srcElement||window}r.buttons=function(e){if("object"==typeof e){if("buttons"in e)return e.buttons;if("which"in e){if(2===(t=e.which))return 4;if(3===t)return 2;if(0<t)return 1<<t-1}else if("button"in e){var t;if(1===(t=e.button))return 4;if(2===t)return 2;if(0<=t)return 1<<t}}return 0},r.element=n,r.x=function(e){if("object"!=typeof e)return 0;if("offsetX"in e)return e.offsetX;var t=n(e).getBoundingClientRect();return e.clientX-t.left},r.y=function(e){if("object"!=typeof e)return 0;if("offsetY"in e)return e.offsetY;var t=n(e).getBoundingClientRect();return e.clientY-t.top}},{}],172:[function(e,t,r){"use strict";var f=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},n)).join("")?void 0:1}catch(e){return}}()?Object.assign:function(e,t){for(var r,n,i=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),a=1;a<arguments.length;a++){for(var o in r=Object(arguments[a]))u.call(r,o)&&(i[o]=r[o]);if(f){n=f(r);for(var s=0;s<n.length;s++)c.call(r,n[s])&&(i[n[s]]=r[n[s]])}}return i}},{}],173:[function(e,t,r){"use strict";function n(e,t){if("string"!=typeof e)return[e];var s=[e],e=(t="string"==typeof t||Array.isArray(t)?{brackets:t}:t||{}).brackets?Array.isArray(t.brackets)?t.brackets:[t.brackets]:["{}","[]","()"],f=t.escape||"___",t=!!t.flat;e.forEach(function(n){var i=new RegExp(["\\",n[0],"[^\\",n[0],"\\",n[1],"]*\\",n[1]].join("")),a=[];function o(e,t,r){e=s.push(e.slice(n[0].length,-n[1].length))-1;return a.push(e),f+e+f}s.forEach(function(e,t){for(var r,n=0;e!=r;)if(e=(r=e).replace(i,o),1e4<n++)throw Error("References have circular dependency. Please, check them.");s[t]=e}),a=a.reverse(),s=s.map(function(t){return a.forEach(function(e){t=t.replace(new RegExp("(\\"+f+e+"\\"+f+")","g"),n[0]+"$1"+n[1])}),t})});var o=new RegExp("\\"+f+"([0-9]+)\\"+f);return t?s:function e(t,r){for(var n,i=[],a=0;n=o.exec(t);){if(1e4<a++)throw Error("Circular references in parenthesis");i.push(t.slice(0,n.index)),i.push(e(r[n[1]],r)),t=t.slice(n.index+n[0].length)}return i.push(t),i}(s[0],s)}function i(r,e){if(e&&e.flat){var t,e=e&&e.escape||"___",n=r[0];if(!n)return"";for(var i=new RegExp("\\"+e+"([0-9]+)\\"+e),a=0;n!=t;){if(1e4<a++)throw Error("Circular references in "+r);n=(t=n).replace(i,o)}return n}return r.reduce(function e(t,r){return Array.isArray(r)&&(r=r.reduce(e,"")),t+r},"");function o(e,t){if(null==r[t])throw Error("Reference "+t+"is undefined");return r[t]}}function a(e,t){return(Array.isArray(e)?i:n)(e,t)}a.parse=n,a.stringify=i,t.exports=a},{}],174:[function(e,t,r){"use strict";var n=e("pick-by-alias");t.exports=function(e){var t;1<arguments.length&&(e=arguments);"string"==typeof e?e=e.split(/\s/).map(parseFloat):"number"==typeof e&&(e=[e]);e.length&&"number"==typeof e[0]?t=1===e.length?{width:e[0],height:e[0],x:0,y:0}:2===e.length?{width:e[0],height:e[1],x:0,y:0}:{x:e[0],y:e[1],width:e[2]-e[0]||0,height:e[3]-e[1]||0}:e&&(e=n(e,{left:"x l left Left",top:"y t top Top",width:"w width W Width",height:"h height W Width",bottom:"b bottom Bottom",right:"r right Right"}),t={x:e.left||0,y:e.top||0},null==e.width?e.right?t.width=e.right-t.x:t.width=0:t.width=e.width,null==e.height?e.bottom?t.height=e.bottom-t.y:t.height=0:t.height=e.height);return t}},{"pick-by-alias":176}],175:[function(e,t,r){t.exports=function(e,t){t=t||[0,""],e=String(e);var r=parseFloat(e,10);return t[0]=r,t[1]=e.match(/[\d.\-\+]*\s*(.*)/)[1]||"",t}},{}],176:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i={};if("string"==typeof t&&(t=l(t)),Array.isArray(t)){for(var a={},o=0;o<t.length;o++)a[t[o]]=!0;t=a}for(n in t)t[n]=l(t[n]);var s={};for(n in t){var f=t[n];if(Array.isArray(f))for(o=0;o<f.length;o++){var u=f[o];if(r&&(s[u]=!0),u in e){if(i[n]=e[u],r)for(var c=o;c<f.length;c++)s[f[c]]=!0;break}}else n in e&&(t[n]&&(i[n]=e[n]),r&&(s[n]=!0))}if(r)for(n in e)s[n]||(i[n]=e[n]);return i};var n={};function l(e){return n[e]||("string"==typeof e&&(e=n[e]=e.split(/\s*,\s*|\s+/)),e)}},{}],177:[function(e,t,r){var n,i;n=this,i=function(){function i(e,t){this.id=n++,this.type=e,this.data=t}function r(e){return"["+function e(t){if(0===t.length)return[];var r=t.charAt(0),n=t.charAt(t.length-1);if(1<t.length&&r===n&&('"'===r||"'"===r))return['"'+t.substr(1,t.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t))return e(t.substr(0,r.index)).concat(e(r[1])).concat(e(t.substr(r.index+r[0].length)));if(1===(r=t.split(".")).length)return['"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(t=[],n=0;n<r.length;++n)t=t.concat(e(r[n]));return t}(e).join("][")+"]"}function w(e){return"string"==typeof e?e.split():e}function x(e){return"string"==typeof e?document.querySelector(e):e}function ne(e){var t,r,n,i,a=e||{};e={};var o,s,f,u,c,l,p=[],h=[],d="undefined"==typeof window?1:window.devicePixelRatio,m=!1,g=function(e){},v=function(){};if("string"==typeof a?t=document.querySelector(a):"object"==typeof a&&("string"==typeof a.nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?t=a:"function"==typeof a.drawArrays||"function"==typeof a.drawElements?n=(i=a).canvas:("gl"in a?i=a.gl:"canvas"in a?n=x(a.canvas):"container"in a&&(r=x(a.container)),"attributes"in a&&(e=a.attributes),"extensions"in a&&(p=w(a.extensions)),"optionalExtensions"in a&&(h=w(a.optionalExtensions)),"onDone"in a&&(g=a.onDone),"profile"in a&&(m=!!a.profile),"pixelRatio"in a&&(d=+a.pixelRatio))),t&&("canvas"===t.nodeName.toLowerCase()?n=t:r=t),!i){if(!n){if(f=r||document.body,u=d,l=document.createElement("canvas"),xe(l.style,{border:0,margin:0,padding:0,top:0,left:0}),f.appendChild(l),f===document.body&&(l.style.position="absolute",xe(f.style,{margin:0,padding:0})),f!==document.body&&"function"==typeof ResizeObserver?(c=new ResizeObserver(function(){setTimeout(b)})).observe(f):window.addEventListener("resize",b,!1),b(),!(t={canvas:l,onDestroy:function(){c?c.disconnect():window.removeEventListener("resize",b),f.removeChild(l)}}))return null;n=t.canvas,v=t.onDestroy}void 0===e.premultipliedAlpha&&(e.premultipliedAlpha=!0),o=n,s=e,i=y("webgl")||y("experimental-webgl")||y("webgl-experimental")}function y(e){try{return o.getContext(e,s)}catch(e){return null}}function b(){var e=window.innerWidth,t=window.innerHeight;f!==document.body&&(e=(t=f.getBoundingClientRect()).right-t.left,t=t.bottom-t.top),l.width=u*e,l.height=u*t,xe(l.style,{width:e+"px",height:t+"px"})}return i?{gl:i,canvas:n,container:r,extensions:p,optionalExtensions:h,pixelRatio:d,profile:m,onDone:g,onDestroy:v}:(v(),g("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Z(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}function a(e){var t,r=(65535<e)<<4;return r|=t=(255<(e>>>=r))<<3,(r|=t=(15<(e>>>=t))<<2)|(t=(3<(e>>>=t))<<1)|e>>>t>>1}function e(){function n(e){e:{for(var t=16;t<=268435456;t*=16)if(e<=t){e=t;break e}e=0}return 0<(t=r[a(e)>>2]).length?t.pop():new ArrayBuffer(e)}function t(e){r[a(e.byteLength)>>2].push(e)}var r=Z(8,function(){return[]});return{alloc:n,free:t,allocType:function(e,t){var r=null;switch(e){case 5120:r=new Int8Array(n(t),0,t);break;case 5121:r=new Uint8Array(n(t),0,t);break;case 5122:r=new Int16Array(n(2*t),0,t);break;case 5123:r=new Uint16Array(n(2*t),0,t);break;case 5124:r=new Int32Array(n(4*t),0,t);break;case 5125:r=new Uint32Array(n(4*t),0,t);break;case 5126:r=new Float32Array(n(4*t),0,t);break;default:return null}return r.length!==t?r.subarray(0,t):r},freeType:function(e){t(e.buffer)}}}function ie(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||Ce(e.data))}function l(e,t,r,n,i,a){for(var o=0;o<t;++o)for(var s=e[o],f=0;f<r;++f)for(var u=s[f],c=0;c<n;++c)i[a++]=u[c]}function ae(e){return 0|je[Object.prototype.toString.call(e)]}function oe(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function se(e,t,r,n,i,a,o){for(var s=0,f=0;f<r;++f)for(var u=0;u<n;++u)e[s++]=t[i*f+a*u+o]}function fe(e){for(var t,r,n,i=Ee.allocType(5123,e.length),a=0;a<e.length;++a)isNaN(e[a])?i[a]=65535:1/0===e[a]?i[a]=31744:-1/0===e[a]?i[a]=64512:(o[0]=e[a],t=(n=s[0])>>>31<<15,r=(n<<1>>>24)-127,n=n>>13&1023,i[a]=r<-24?t:r<-14?t+(1024+n>>-14-r):15<r?31744+t:t+(15+r<<10)+n);return i}function ue(e){return Array.isArray(e)||Ce(e)}function t(e){return"[object "+e+"]"}function ce(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function le(e){return!(!Array.isArray(e)||0===e.length||!ue(e[0]))}function pe(e){return Object.prototype.toString.call(e)}function he(e){if(e){var t=pe(e);return 0<=f.indexOf(t)||(ce(e)||le(e)||ie(e))}}function de(e,t){36193===e.type?(e.data=fe(t),Ee.freeType(t)):e.data=t}function me(e,t,r,n,i,a){if(e=void 0!==c[e]?c[e]:Le[e]*u[t],a&&(e*=6),i){for(n=0;1<=r;)n+=e*r*r,r/=2;return n}return e*r*n}function h(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function ge(i,a,e,t,c,l,o){function r(){this.id=++n,this.attributes=[],this.elements=null,this.ownsElements=!1,this.offset=this.count=0,this.instances=-1,this.primitive=4;var e=a.oes_vertex_array_object;this.vao=e?e.createVertexArrayOES():null,(u[this.id]=this).buffers=[]}var s=e.maxAttributes,f=Array(s);for(e=0;e<s;++e)f[e]=new h;var n=0,u={},p={Record:h,scope:{},state:f,currentVAO:null,targetVAO:null,restore:a.oes_vertex_array_object?function(){a.oes_vertex_array_object&&Te(u).forEach(function(e){e.refresh()})}:function(){},createVAO:function(e){function f(e){var t;Array.isArray(e)?(t=e,u.elements&&u.ownsElements&&u.elements.destroy(),u.elements=null,u.ownsElements=!1,u.offset=0,u.count=0,u.instances=-1,u.primitive=4):(e.elements?(t=e.elements,u.ownsElements?("function"==typeof t&&"elements"===t._reglType?u.elements.destroy():u.elements(t),u.ownsElements=!1):l.getElements(e.elements)?(u.elements=e.elements,u.ownsElements=!1):(u.elements=l.create(e.elements),u.ownsElements=!0)):(u.elements=null,u.ownsElements=!1),t=e.attributes,u.offset=0,u.count=-1,u.instances=-1,u.primitive=4,u.elements&&(u.count=u.elements._elements.vertCount,u.primitive=u.elements._elements.primType),"offset"in e&&(u.offset=0|e.offset),"count"in e&&(u.count=0|e.count),"instances"in e&&(u.instances=0|e.instances),"primitive"in e&&(u.primitive=Be[e.primitive])),e={};var r=u.attributes;r.length=t.length;for(var n=0;n<t.length;++n){var i,a=t[n],o=r[n]=new h,s=a.data||a;Array.isArray(s)||Ce(s)||ie(s)?(u.buffers[n]&&(i=u.buffers[n],Ce(s)&&i._buffer.byteLength>=s.byteLength?i.subdata(s):(i.destroy(),u.buffers[n]=null)),u.buffers[n]||(i=u.buffers[n]=c.create(a,34962,!1,!0)),o.buffer=c.getBuffer(i),o.size=0|o.buffer.dimension,o.normalized=!1,o.type=o.buffer.dtype,o.offset=0,o.stride=0,o.divisor=0,o.state=1,e[n]=1):c.getBuffer(a)?(o.buffer=c.getBuffer(a),o.size=0|o.buffer.dimension,o.normalized=!1,o.type=o.buffer.dtype,o.offset=0,o.stride=0,o.divisor=0,o.state=1):c.getBuffer(a.buffer)?(o.buffer=c.getBuffer(a.buffer),o.size=0|(+a.size||o.buffer.dimension),o.normalized=!!a.normalized||!1,o.type="type"in a?De[a.type]:o.buffer.dtype,o.offset=0|(a.offset||0),o.stride=0|(a.stride||0),o.divisor=0|(a.divisor||0),o.state=1):"x"in a&&(o.x=+a.x||0,o.y=+a.y||0,o.z=+a.z||0,o.w=+a.w||0,o.state=2)}for(i=0;i<u.buffers.length;++i)!e[i]&&u.buffers[i]&&(u.buffers[i].destroy(),u.buffers[i]=null);return u.refresh(),f}var u=new r;return t.vaoCount+=1,f.destroy=function(){for(var e=0;e<u.buffers.length;++e)u.buffers[e]&&u.buffers[e].destroy();u.buffers.length=0,u.ownsElements&&(u.elements.destroy(),u.elements=null,u.ownsElements=!1),u.destroy()},f._vao=u,f._reglType="vao",f(e)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var t=0;t<f.length;++t){var r=f[t];r.buffer===e&&(i.disableVertexAttribArray(t),r.buffer=null)}},setVAO:a.oes_vertex_array_object?function(e){var t;e!==p.currentVAO&&(t=a.oes_vertex_array_object,e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),p.currentVAO=e)}:function(e){if(e!==p.currentVAO){if(e)e.bindAttrs();else{for(var t=a.angle_instanced_arrays,r=0;r<f.length;++r){var n=f[r];n.buffer?(i.enableVertexAttribArray(r),n.buffer.bind(),i.vertexAttribPointer(r,n.size,n.type,n.normalized,n.stride,n.offfset),t&&n.divisor&&t.vertexAttribDivisorANGLE(r,n.divisor)):(i.disableVertexAttribArray(r),i.vertexAttrib4f(r,n.x,n.y,n.z,n.w))}o.elements?i.bindBuffer(34963,o.elements.buffer.buffer):i.bindBuffer(34963,null)}p.currentVAO=e}},clear:a.oes_vertex_array_object?function(){Te(u).forEach(function(e){e.destroy()})}:function(){}};return r.prototype.bindAttrs=function(){for(var e=a.angle_instanced_arrays,t=this.attributes,r=0;r<t.length;++r){var n=t[r];n.buffer?(i.enableVertexAttribArray(r),i.bindBuffer(34962,n.buffer.buffer),i.vertexAttribPointer(r,n.size,n.type,n.normalized,n.stride,n.offset),e&&n.divisor&&e.vertexAttribDivisorANGLE(r,n.divisor)):(i.disableVertexAttribArray(r),i.vertexAttrib4f(r,n.x,n.y,n.z,n.w))}for(e=t.length;e<s;++e)i.disableVertexAttribArray(e);(e=l.getElements(this.elements))?i.bindBuffer(34963,e.buffer.buffer):i.bindBuffer(34963,null)},r.prototype.refresh=function(){var e=a.oes_vertex_array_object;e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),p.currentVAO=this)},r.prototype.destroy=function(){var e;this.vao&&(e=a.oes_vertex_array_object,this===p.currentVAO&&(p.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null),this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),u[this.id]&&(delete u[this.id],--t.vaoCount)},p}function ve(s,f,u,c){function n(e){var t=null===f.next?5121:f.next.colorAttachments[0].texture._texture.type,r=0,n=0,i=c.framebufferWidth,a=c.framebufferHeight,o=null;return Ce(e)?o=e:e&&(r=0|e.x,n=0|e.y,i=0|(e.width||c.framebufferWidth-r),a=0|(e.height||c.framebufferHeight-n),o=e.data||null),u(),e=i*a*4,o||(5121===t?o=new Uint8Array(e):5126===t&&(o=o||new Float32Array(e))),s.pixelStorei(3333,4),s.readPixels(r,n,i,a,6408,t,o),o}return function(e){return e&&"framebuffer"in e?(t=e,f.setFBO({framebuffer:t.framebuffer},function(){r=n(t)}),r):n(e);var t,r}}function B(e){return Array.prototype.slice.call(e)}function F(e){return B(e).join("")}function $(e){return Array.isArray(e)||Ce(e)||ie(e)}function z(e){return e.sort(function(e,t){return"viewport"===e||"viewport"!==t&&e<t?-1:1})}function ee(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function te(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function re(e){return new ee(!1,!1,!1,e)}function ye(e,t){var r=e.type;if(0===r)return new ee(!0,1<=(r=e.data.length),2<=r,t);if(4===r)return new ee((r=e.data).thisDep,r.contextDep,r.propDep,t);if(5===r)return new ee(!1,!1,!1,t);if(6!==r)return new ee(3===r,2===r,1===r,t);for(var n=r=!1,i=!1,a=0;a<e.data.length;++a){var o=e.data[a];1===o.type?i=!0:2===o.type?n=!0:3===o.type?r=!0:0===o.type?(r=!0,1<=(o=o.data)&&(n=!0),2<=o&&(i=!0)):4===o.type&&(r=r||o.data.thisDep,n=n||o.data.contextDep,i=i||o.data.propDep)}return new ee(r,n,i,t)}function be(e,V,N,a,q,W,t,H,r,G,Q,n,i,m,o){function Y(e){return e.replace(".","_")}function s(e,t,r){var n=Y(e);K.push(e),j[n]=S[n]=!!r,D[n]=t}function f(e,t,r){var n=Y(e);K.push(e),Array.isArray(r)?(S[n]=r.slice(),j[n]=r.slice()):S[n]=j[n]=r,P[n]=t}function h(){var n,r,i,a,o,s=(n=0,r=[],i=[],a=u(),o={},{global:a,link:function(e){for(var t=0;t<i.length;++t)if(i[t]===e)return r[t];return t="g"+n++,r.push(t),i.push(e),t},block:u,proc:function(e,t){function r(){var e="a"+n.length;return n.push(e),e}var n=[];t=t||0;for(var i=0;i<t;++i)r();var a=(i=c()).toString;return o[e]=xe(i,{arg:r,toString:function(){return F(["function(",n.join(),"){",a(),"}"])}})},scope:c,cond:function(){var t=F(arguments),e=c(),r=c(),n=e.toString,i=r.toString;return xe(e,{then:function(){return e.apply(e,B(arguments)),this},else:function(){return r.apply(r,B(arguments)),this},toString:function(){var e=(e=i())&&"else{"+e+"}";return F(["if(",t,"){",n(),"}",e])}})},compile:function(){var t=['"use strict";',a,"return {"];Object.keys(o).forEach(function(e){t.push('"',e,'":',o[e].toString(),",")}),t.push("}");var e=F(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,r.concat(e)).apply(null,i)}}),f=s.link,t=s.global;function u(){var t=[],r=[];return xe(function(){t.push.apply(t,B(arguments))},{def:function(){var e="v"+n++;return r.push(e),0<arguments.length&&(t.push(e,"="),t.push.apply(t,B(arguments)),t.push(";")),e},toString:function(){return F([0<r.length?"var "+r.join(",")+";":"",F(t)])}})}function c(){function n(e,t){r(e,t,"=",i.def(e,t),";")}var i=u(),r=u(),e=i.toString,t=r.toString;return xe(function(){i.apply(i,B(arguments))},{def:i.def,entry:i,exit:r,save:n,set:function(e,t,r){n(e,t),i(e,t,"=",r,";")},toString:function(){return e()+t()}})}s.id=R++,s.batchId="0";var l=f(M),p=s.shared={props:"a0"};Object.keys(M).forEach(function(e){p[e]=t.def(l,".",e)});var h=s.next={},d=s.current={};Object.keys(P).forEach(function(e){Array.isArray(S[e])&&(h[e]=t.def(p.next,".",e),d[e]=t.def(p.current,".",e))});var m=s.constants={};Object.keys(I).forEach(function(e){m[e]=t.def(JSON.stringify(I[e]))}),s.invoke=function(t,e){switch(e.type){case 0:var r=["this",p.context,p.props,s.batchId];return t.def(f(e.data),".call(",r.slice(0,Math.max(e.data.length+1,4)),")");case 1:return t.def(p.props,e.data);case 2:return t.def(p.context,e.data);case 3:return t.def("this",e.data);case 4:return e.data.append(s,t),e.data.ref;case 5:return e.data.toString();case 6:return e.data.map(function(e){return s.invoke(t,e)})}},s.attribCache={};var g={};return s.scopeAttrib=function(e){if((e=V.id(e))in g)return g[e];var t=(t=G.scope[e])||(G.scope[e]=new X);return g[e]=f(t)},s}function u(e,t,r,n){function i(e){var t=w[e];t&&(A[e]=t)}var a,o,s,f,u,c,l,p,h,d,m,g,v,y=function(e,t){if("string"==typeof(r=e.static).frag&&"string"==typeof r.vert){if(0<Object.keys(t.dynamic).length)return null;var r=t.static,n=Object.keys(r);if(0<n.length&&"number"==typeof r[n[0]]){for(var i=[],a=0;a<n.length;++a)i.push([0|r[n[a]],n[a]]);return i}}return null}(e,t),b=function(e){var t=e.static,e=e.dynamic;if("framebuffer"in t){var n=t.framebuffer;return n?(n=H.getFramebuffer(n),re(function(e,t){var r=e.link(n),e=e.shared;return t.set(e.framebuffer,".next",r),e=e.context,t.set(e,".framebufferWidth",r+".width"),t.set(e,".framebufferHeight",r+".height"),r})):re(function(e,t){e=e.shared;return t.set(e.framebuffer,".next","null"),e=e.context,t.set(e,".framebufferWidth",e+".drawingBufferWidth"),t.set(e,".framebufferHeight",e+".drawingBufferHeight"),"null"})}if("framebuffer"in e){var i=e.framebuffer;return ye(i,function(e,t){var r=e.invoke(t,i),n=e.shared,e=n.framebuffer,r=t.def(e,".getFramebuffer(",r,")");return t.set(e,".next",r),n=n.context,t.set(n,".framebufferWidth",r+"?"+r+".width:"+n+".drawingBufferWidth"),t.set(n,".framebufferHeight",r+"?"+r+".height:"+n+".drawingBufferHeight"),r})}return null}(e),w=(d=b,g=(E=e).static,v=E.dynamic,(E=k("viewport"))&&(E=new ee((m=E).thisDep,E.contextDep,E.propDep,function(e,t){var r=m.append(e,t),e=e.shared.context;return t.set(e,".viewportWidth",r[2]),t.set(e,".viewportHeight",r[3]),r})),{viewport:E,scissor_box:k("scissor.box")}),x=function(e){function t(e,r){if(e in a){var n=0|a[e];return r?f.offset=n:f.instances=n,re(function(e,t){return r&&(e.OFFSET=n),n})}if(e in s){var i=s[e];return ye(i,function(e,t){t=e.invoke(t,i);return r&&(e.OFFSET=t),t})}if(r){if(l)return re(function(e,t){return e.OFFSET=0});if(u)return new ee(c.thisDep,c.contextDep,c.propDep,function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")})}else if(u)return new ee(c.thisDep,c.contextDep,c.propDep,function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")});return null}var a=e.static,s=e.dynamic,f={},u=!1,c=function(){if("vao"in a){var r=a.vao;return null!==r&&null===G.getVAO(r)&&(r=G.createVAO(r)),u=!0,f.vao=r,re(function(e){var t=G.getVAO(r);return t?e.link(t):"null"})}if("vao"in s){u=!0;var n=s.vao;return ye(n,function(e,t){var r=e.invoke(t,n);return t.def(e.shared.vao+".getVAO("+r+")")})}return null}(),l=!1,i=function(){if("elements"in a){var e,n=a.elements;return $(f.elements=n)?(e=f.elements=W.create(n,!0),n=W.getElements(e),l=!0):n&&(n=W.getElements(n),l=!0),(e=re(function(e,t){if(n){var r=e.link(n);return e.ELEMENTS=r}return e.ELEMENTS=null})).value=n,e}if("elements"in s){l=!0;var o=s.elements;return ye(o,function(e,t){var r=(n=e.shared).isBufferArgs,n=n.elements,i=e.invoke(t,o),a=t.def("null"),r=t.def(r,"(",i,")"),i=e.cond(r).then(a,"=",n,".createStream(",i,");").else(a,"=",n,".getElements(",i,");");return t.entry(i),t.exit(e.cond(r).then(n,".destroyStream(",a,");")),e.ELEMENTS=a})}return u?new ee(c.thisDep,c.contextDep,c.propDep,function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")}):null}();l&&(c=re(function(){return"null"}));var n=t("offset",!0),r=function(){if("primitive"in a){var r=a.primitive;return f.primitive=r,re(function(e,t){return Be[r]})}if("primitive"in s){var n=s.primitive;return ye(n,function(e,t){var r=e.constants.primTypes,e=e.invoke(t,n);return t.def(r,"[",e,"]")})}return l?te(i)?i.value?re(function(e,t){return t.def(e.ELEMENTS,".primType")}):re(function(){return 4}):new ee(i.thisDep,i.contextDep,i.propDep,function(e,t){e=e.ELEMENTS;return t.def(e,"?",e,".primType:",4)}):u?new ee(c.thisDep,c.contextDep,c.propDep,function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:4")}):null}(),o=function(){if("count"in a){var e=0|a.count;return f.count=e,re(function(){return e})}if("count"in s){var r=s.count;return ye(r,function(e,t){return e.invoke(t,r)})}return l?te(i)?i?n?new ee(n.thisDep,n.contextDep,n.propDep,function(e,t){return t.def(e.ELEMENTS,".vertCount-",e.OFFSET)}):re(function(e,t){return t.def(e.ELEMENTS,".vertCount")}):re(function(){return-1}):new ee(i.thisDep||n.thisDep,i.contextDep||n.contextDep,i.propDep||n.propDep,function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")}):u?new ee(c.thisDep,c.contextDep,c.propDep,function(e,t){return t.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")}):null}(),e=t("instances",!1);return{elements:i,primitive:r,count:o,instances:e,offset:n,vao:c,vaoActive:u,elementsActive:l,static:f}}(e),A=(l=(c=e).static,p=c.dynamic,h={},K.forEach(function(a){function e(e,r){var t,n;a in l?(t=e(l[a]),h[i]=re(function(){return t})):a in p&&(n=p[a],h[i]=ye(n,function(e,t){return r(e,t,e.invoke(t,n))}))}var i=Y(a);switch(a){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return e(function(e){return e},function(e,t,r){return r});case"depth.func":return e(function(e){return Ke[e]},function(e,t,r){return t.def(e.constants.compareFuncs,"[",r,"]")});case"depth.range":return e(function(e){return e},function(e,t,r){return[t.def("+",r,"[0]"),t=t.def("+",r,"[1]")]});case"blend.func":return e(function(e){return[Je["srcRGB"in e?e.srcRGB:e.src],Je["dstRGB"in e?e.dstRGB:e.dst],Je["srcAlpha"in e?e.srcAlpha:e.src],Je["dstAlpha"in e?e.dstAlpha:e.dst]]},function(e,r,n){function t(e,t){return r.def('"',e,t,'" in ',n,"?",n,".",e,t,":",n,".",e)}e=e.constants.blendFuncs;var i=t("src","RGB"),a=t("dst","RGB"),i=r.def(e,"[",i,"]"),o=r.def(e,"[",t("src","Alpha"),"]");return[i,a=r.def(e,"[",a,"]"),o,e=r.def(e,"[",t("dst","Alpha"),"]")]});case"blend.equation":return e(function(e){return"string"==typeof e?[J[e],J[e]]:"object"==typeof e?[J[e.rgb],J[e.alpha]]:void 0},function(e,t,r){var n=e.constants.blendEquations,i=t.def(),a=t.def();return(e=e.cond("typeof ",r,'==="string"')).then(i,"=",a,"=",n,"[",r,"];"),e.else(i,"=",n,"[",r,".rgb];",a,"=",n,"[",r,".alpha];"),t(e),[i,a]});case"blend.color":return e(function(t){return Z(4,function(e){return+t[e]})},function(e,t,r){return Z(4,function(e){return t.def("+",r,"[",e,"]")})});case"stencil.mask":return e(function(e){return 0|e},function(e,t,r){return t.def(r,"|0")});case"stencil.func":return e(function(e){return[Ke[e.cmp||"keep"],e.ref||0,"mask"in e?e.mask:-1]},function(e,t,r){return[e=t.def('"cmp" in ',r,"?",e.constants.compareFuncs,"[",r,".cmp]",":",7680),t.def(r,".ref|0"),t=t.def('"mask" in ',r,"?",r,".mask|0:-1")]});case"stencil.opFront":case"stencil.opBack":return e(function(e){return["stencil.opBack"===a?1029:1028,Ze[e.fail||"keep"],Ze[e.zfail||"keep"],Ze[e.zpass||"keep"]]},function(e,t,r){function n(e){return t.def('"',e,'" in ',r,"?",i,"[",r,".",e,"]:",7680)}var i=e.constants.stencilOps;return["stencil.opBack"===a?1029:1028,n("fail"),n("zfail"),n("zpass")]});case"polygonOffset.offset":return e(function(e){return[0|e.factor,0|e.units]},function(e,t,r){return[t.def(r,".factor|0"),t=t.def(r,".units|0")]});case"cull.face":return e(function(e){var t=0;return"front"===e?t=1028:"back"===e&&(t=1029),t},function(e,t,r){return t.def(r,'==="front"?',1028,":",1029)});case"lineWidth":return e(function(e){return e},function(e,t,r){return r});case"frontFace":return e(function(e){return $e[e]},function(e,t,r){return t.def(r+'==="cw"?2304:2305')});case"colorMask":return e(function(e){return e.map(function(e){return!!e})},function(e,t,r){return Z(4,function(e){return"!!"+r+"["+e+"]"})});case"sample.coverage":return e(function(e){return["value"in e?e.value:1,!!e.invert]},function(e,t,r){return[t.def('"value" in ',r,"?+",r,".value:1"),t=t.def("!!",r,".invert")]})}}),h),c=(U=y,a=(E=e).static,o=E.dynamic,s=_("frag"),f=_("vert"),u=null,E=te(s)&&te(f)?(u=Q.program(f.id,s.id,null,U),re(function(e,t){return e.link(u)})):new ee(s&&s.thisDep||f&&f.thisDep,s&&s.contextDep||f&&f.contextDep,s&&s.propDep||f&&f.propDep,function(e,t){var r=e.shared.shader,n=s?s.append(e,t):t.def(r,".","frag"),e=f?f.append(e,t):t.def(r,".","vert");return t.def(r+".program("+e+","+n+")")}),{frag:s,vert:f,progVar:E,program:u});function _(e){if(e in a){var t=V.id(a[e]);return(e=re(function(){return t})).id=t,e}if(e in o){var n=o[e];return ye(n,function(e,t){var r=e.invoke(t,n);return t.def(e.shared.strings,".id(",r,")")})}return null}function k(e){if(e in g){var i=g[e];e=!0;var a,o,s=0|i.x,f=0|i.y;return"width"in i?a=0|i.width:e=!1,"height"in i?o=0|i.height:e=!1,new ee(!e&&d&&d.thisDep,!e&&d&&d.contextDep,!e&&d&&d.propDep,function(e,t){var r=e.shared.context,n=a;"width"in i||(n=t.def(r,".","framebufferWidth","-",s));e=o;return"height"in i||(e=t.def(r,".","framebufferHeight","-",f)),[s,f,n,e]})}if(e in v){var u=v[e];return e=ye(u,function(e,t){var r=e.invoke(t,u),n=e.shared.context,i=t.def(r,".x|0"),e=t.def(r,".y|0");return[i,e,t.def('"width" in ',r,"?",r,".width|0:","(",n,".","framebufferWidth","-",i,")"),r=t.def('"height" in ',r,"?",r,".height|0:","(",n,".","framebufferHeight","-",e,")")]}),d&&(e.thisDep=e.thisDep||d.thisDep,e.contextDep=e.contextDep||d.contextDep,e.propDep=e.propDep||d.propDep),e}return d?new ee(d.thisDep,d.contextDep,d.propDep,function(e,t){e=e.shared.context;return[0,0,t.def(e,".","framebufferWidth"),t.def(e,".","framebufferHeight")]}):null}i("viewport"),i(Y("scissor.box"));var E,T,C,O,S,j,D,P,M,I,R,B,F,z,L,U=0<Object.keys(A).length;return(b={framebuffer:b,draw:x,shader:c,state:A,dirty:U,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}}).profile=(U=(E=e).static,E=E.dynamic,"profile"in U?(T=!!U.profile,(C=re(function(e,t){return T})).enable=T):"profile"in E&&(C=ye(O=E.profile,function(e,t){return e.invoke(t,O)})),C),b.uniforms=(S=(r=r).static,j=r.dynamic,D={},Object.keys(S).forEach(function(e){var t,r,n=S[e];"number"==typeof n||"boolean"==typeof n?t=re(function(){return n}):"function"==typeof n?"texture2d"===(r=n._reglType)||"textureCube"===r?t=re(function(e){return e.link(n)}):"framebuffer"!==r&&"framebufferCube"!==r||(t=re(function(e){return e.link(n.color[0])})):ue(n)&&(t=re(function(e){return e.global.def("[",Z(n.length,function(e){return n[e]}),"]")})),t.value=n,D[e]=t}),Object.keys(j).forEach(function(e){var r=j[e];D[e]=ye(r,function(e,t){return e.invoke(t,r)})}),D),b.drawVAO=b.scopeVAO=x.vao,!b.drawVAO&&c.program&&!y&&N.angle_instanced_arrays&&x.static.elements&&(P=!0,e=c.program.attributes.map(function(e){return e=t.static[e],P=P&&!!e,e}),P&&0<e.length&&(M=G.getVAO(G.createVAO({attributes:e,elements:x.static.elements})),b.drawVAO=new ee(null,null,null,function(e,t){return e.link(M)}),b.useVAO=!0)),y?b.useVAO=!0:b.attributes=(I=(y=t).static,R=y.dynamic,B={},Object.keys(I).forEach(function(e){var r,t,n,i,a,o,s,f=I[e],u=V.id(e),c=new X;$(f)?(c.state=1,c.buffer=q.getBuffer(q.create(f,34962,!1,!0)),c.type=0):(t=q.getBuffer(f))?(c.state=1,c.buffer=t,c.type=0):"constant"in f?(r=f.constant,c.buffer="null",c.state=2,"number"==typeof r?c.x=r:Xe.forEach(function(e,t){t<r.length&&(c[e]=r[t])})):(t=$(f.buffer)?q.getBuffer(q.create(f.buffer,34962,!1,!0)):q.getBuffer(f.buffer),n=0|f.offset,i=0|f.stride,a=0|f.size,o=!!f.normalized,s=0,"type"in f&&(s=De[f.type]),f=0|f.divisor,c.buffer=t,c.state=1,c.size=a,c.normalized=o,c.type=s||t.dtype,c.offset=n,c.stride=i,c.divisor=f),B[e]=re(function(e,t){var r=e.attribCache;if(u in r)return r[u];var n={isStream:!1};return Object.keys(c).forEach(function(e){n[e]=c[e]}),c.buffer&&(n.buffer=e.link(c.buffer),n.type=n.type||n.buffer+".dtype"),r[u]=n})}),Object.keys(R).forEach(function(e){var c=R[e];B[e]=ye(c,function(e,t){function r(e){t(s[e],"=",n,".",e,"|0;")}var n=e.invoke(t,c),i=e.shared,a=e.constants,o=i.isBufferArgs,i=i.buffer,s={isStream:t.def(!1)},f=new X;f.state=1,Object.keys(f).forEach(function(e){s[e]=t.def(""+f[e])});var u=s.buffer,e=s.type;return t("if(",o,"(",n,")){",s.isStream,"=true;",u,"=",i,".createStream(",34962,",",n,");",e,"=",u,".dtype;","}else{",u,"=",i,".getBuffer(",n,");","if(",u,"){",e,"=",u,".dtype;",'}else if("constant" in ',n,"){",s.state,"=",2,";","if(typeof "+n+'.constant === "number"){',s[Xe[0]],"=",n,".constant;",Xe.slice(1).map(function(e){return s[e]}).join("="),"=0;","}else{",Xe.map(function(e,t){return s[e]+"="+n+".constant.length>"+t+"?"+n+".constant["+t+"]:0;"}).join(""),"}}else{","if(",o,"(",n,".buffer)){",u,"=",i,".createStream(",34962,",",n,".buffer);","}else{",u,"=",i,".getBuffer(",n,".buffer);","}",e,'="type" in ',n,"?",a.glTypes,"[",n,".type]:",u,".dtype;",s.normalized,"=!!",n,".normalized;"),r("size"),r("offset"),r("stride"),r("divisor"),t("}}"),t.exit("if(",s.isStream,"){",i,".destroyStream(",u,");","}"),s})}),B),b.context=(F=(n=n).static,z=n.dynamic,L={},Object.keys(F).forEach(function(e){var r=F[e];L[e]=re(function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)})}),Object.keys(z).forEach(function(e){var r=z[e];L[e]=ye(r,function(e,t){return e.invoke(t,r)})}),L),b}function l(r,n,i){var a=r.shared.context,o=r.scope();Object.keys(i).forEach(function(e){n.save(a,"."+e);var t=i[e].append(r,n);Array.isArray(t)?o(a,".",e,"=[",t.join(),"];"):o(a,".",e,"=",t,";")}),n(o)}function d(e,t,r,n){var i,a=(s=e.shared).gl,o=s.framebuffer;C&&(i=t.def(s.extensions,".webgl_draw_buffers"));var s=(f=e.constants).drawBuffer,f=f.backBuffer;e=r?r.append(e,t):t.def(o,".next"),n||t("if(",e,"!==",o,".cur){"),t("if(",e,"){",a,".bindFramebuffer(",36160,",",e,".framebuffer);"),C&&t(i,".drawBuffersWEBGL(",s,"[",e,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),C&&t(i,".drawBuffersWEBGL(",f,");"),t("}",o,".cur=",e,";"),n||t("}")}function c(i,e,a){var t=i.shared,o=t.gl,s=i.current,f=i.next,u=t.current,c=t.next,l=i.cond(u,".dirty");K.forEach(function(e){var t,r,n;(e=Y(e))in a.state||(e in f?(t=f[e],r=s[e],n=Z(S[e].length,function(e){return l.def(t,"[",e,"]")}),l(i.cond(n.map(function(e,t){return e+"!=="+r+"["+t+"]"}).join("||")).then(o,".",P[e],"(",n,");",n.map(function(e,t){return r+"["+t+"]="+e}).join(";"),";"))):(t=l.def(c,".",e),n=i.cond(t,"!==",u,".",e),l(n),e in D?n(i.cond(t).then(o,".enable(",D[e],");").else(o,".disable(",D[e],");"),u,".",e,"=",t,";"):n(o,".",P[e],"(",t,");",u,".",e,"=",t,";")))}),0===Object.keys(a.state).length&&l(u,".dirty=false;"),e(l)}function p(a,o,s,f){var e=a.shared,u=a.current,c=e.current,l=e.gl;z(Object.keys(s)).forEach(function(e){var t,r,n,i=s[e];f&&!f(i)||(t=i.append(a,o),D[e]?(r=D[e],te(i)?o(l,t?".enable(":".disable(",r,");"):o(a.cond(t).then(l,".enable(",r,");").else(l,".disable(",r,");")),o(c,".",e,"=",t,";")):ue(t)?(n=u[e],o(l,".",P[e],"(",t,");",t.map(function(e,t){return n+"["+t+"]="+e}).join(";"),";")):o(l,".",P[e],"(",t,");",c,".",e,"=",t,";"))})}function g(e,t){T&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function v(e,r,t,n,i){function a(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function o(e){e(u=r.def(),"=",a(),";"),"string"==typeof i?e(p,".count+=",i,";"):e(p,".count++;"),m&&(n?e(c=r.def(),"=",d,".getNumPendingQueries();"):e(d,".beginQuery(",p,");"))}function s(e){e(p,".cpuTime+=",a(),"-",u,";"),m&&(n?e(d,".pushScopeStats(",c,",",d,".getNumPendingQueries(),",p,");"):e(d,".endQuery();"))}function f(e){var t=r.def(h,".profile");r(h,".profile=",e,";"),r.exit(h,".profile=",t,";")}var u,c,l=e.shared,p=e.stats,h=l.current,d=l.timer;if(t=t.profile){if(te(t))return void(t.enable?(o(r),s(r.exit),f("true")):f("false"));f(t=t.append(e,r))}else t=r.def(h,".profile");o(l=e.block()),r("if(",t,"){",l,"}"),s(e=e.block()),r.exit("if(",t,"){",e,"}")}function y(l,p,a,e,o){var h=l.shared;e.forEach(function(e){var t=e.name,r=a.attributes[t];if(r){if(!o(r))return;i=r.append(l,p)}else{if(!o(U))return;var n=l.scopeAttrib(t),i={};Object.keys(new X).forEach(function(e){i[e]=p.def(n,".",e)})}!function(e,r,n){function t(){p("if(!",s,".buffer){",a,".enableVertexAttribArray(",o,");}");var e=n.type,t=n.size?p.def(n.size,"||",r):r;p("if(",s,".type!==",e,"||",s,".size!==",t,"||",c.map(function(e){return s+"."+e+"!=="+n[e]}).join("||"),"){",a,".bindBuffer(",34962,",",f,".buffer);",a,".vertexAttribPointer(",[o,t,e,n.normalized,n.stride,n.offset],");",s,".type=",e,";",s,".size=",t,";",c.map(function(e){return s+"."+e+"="+n[e]+";"}).join(""),"}"),T&&(e=n.divisor,p("if(",s,".divisor!==",e,"){",l.instancing,".vertexAttribDivisorANGLE(",[o,e],");",s,".divisor=",e,";}"))}function i(){p("if(",s,".buffer){",a,".disableVertexAttribArray(",o,");",s,".buffer=null;","}if(",Xe.map(function(e,t){return s+"."+e+"!=="+u[t]}).join("||"),"){",a,".vertexAttrib4f(",o,",",u,");",Xe.map(function(e,t){return s+"."+e+"="+u[t]+";"}).join(""),"}")}var a=h.gl,o=p.def(e,".location"),s=p.def(h.attributes,"[",o,"]");e=n.state;var f=n.buffer,u=[n.x,n.y,n.z,n.w],c=["buffer","normalized","offset","stride"];1===e?t():2===e?i():(p("if(",e,"===",1,"){"),t(),p("}else{"),i(),p("}"))}(l.link(e),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(e.info.type),i)})}function b(e,t,r,n,i,a){for(var o,s=e.shared,f=s.gl,u=0;u<n.length;++u){var c,l=(d=n[u]).name,p=d.info.type,h=r.uniforms[l],d=e.link(d)+".location";if(h){if(!i(h))continue;if(te(h)){if(l=h.value,35678===p||35680===p)t(f,".uniform1i(",d,",",(p=e.link(l._texture||l.color[0]._texture))+".bind());"),t.exit(p,".unbind();");else if(35674===p||35675===p||35676===p)h=2,35675===p?h=3:35676===p&&(h=4),t(f,".uniformMatrix",h,"fv(",d,",false,",l=e.global.def("new Float32Array(["+Array.prototype.slice.call(l)+"])"),");");else{switch(p){case 5126:o="1f";break;case 35664:o="2f";break;case 35665:o="3f";break;case 35666:o="4f";break;case 35670:case 5124:o="1i";break;case 35671:case 35667:o="2i";break;case 35672:case 35668:o="3i";break;case 35673:o="4i";break;case 35669:o="4i"}t(f,".uniform",o,"(",d,",",ue(l)?Array.prototype.slice.call(l):l,");")}continue}c=h.append(e,t)}else{if(!i(U))continue;c=t.def(s.uniforms,"[",V.id(l),"]")}switch(35678===p?t("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}"):35680===p&&t("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}"),l=1,p){case 35678:case 35680:p=t.def(c,"._texture"),t(f,".uniform1i(",d,",",p,".bind());"),t.exit(p,".unbind();");continue;case 5124:case 35670:o="1i";break;case 35667:case 35671:o="2i",l=2;break;case 35668:case 35672:o="3i",l=3;break;case 35669:case 35673:o="4i",l=4;break;case 5126:o="1f";break;case 35664:o="2f",l=2;break;case 35665:o="3f",l=3;break;case 35666:o="4f",l=4;break;case 35674:o="Matrix2fv";break;case 35675:o="Matrix3fv";break;case 35676:o="Matrix4fv"}if("M"===o.charAt(0)){t(f,".uniform",o,"(",d,",");var d=Math.pow(p-35674+2,2),m=e.global.def("new Float32Array(",d,")");Array.isArray(c)?t("false,(",Z(d,function(e){return m+"["+e+"]="+c[e]}),",",m,")"):t("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",Z(d,function(e){return m+"["+e+"]="+c+"["+e+"]"}),",",m,")"),t(");")}else{if(1<l){for(var p=[],g=[],h=0;h<l;++h)Array.isArray(c)?g.push(c[h]):g.push(t.def(c+"["+h+"]")),a&&p.push(t.def());a&&t("if(!",e.batchId,"||",p.map(function(e,t){return e+"!=="+g[t]}).join("||"),"){",p.map(function(e,t){return e+"="+g[t]+";"}).join("")),t(f,".uniform",o,"(",d,",",g.join(","),");")}else a&&(p=t.def(),t("if(!",e.batchId,"||",p,"!==",c,"){",p,"=",c,";")),t(f,".uniform",o,"(",d,",",c,");");a&&t("}")}}}function w(r,n,i,a){function e(e){var t=d[e];return t?t.contextDep&&a.contextDynamic||t.propDep?t.append(r,i):t.append(r,n):n.def(h,".",e)}function t(){function e(){i(c,".drawElementsInstancedANGLE(",[g,y,b,v+"<<(("+b+"-5121)>>1)",u],");")}function t(){i(c,".drawArraysInstancedANGLE(",[g,v,y,u],");")}m&&"null"!==m?w?e():(i("if(",m,"){"),e(),i("}else{"),t(),i("}")):t()}function o(){function e(){i(p+".drawElements("+[g,y,b,v+"<<(("+b+"-5121)>>1)"]+");")}function t(){i(p+".drawArrays("+[g,v,y]+");")}m&&"null"!==m?w?e():(i("if(",m,"){"),e(),i("}else{"),t(),i("}")):t()}var s,f,u,c,l=r.shared,p=l.gl,h=l.draw,d=a.draw,m=(s=d.elements,f=n,s?((s.contextDep&&a.contextDynamic||s.propDep)&&(f=i),d.vaoActive?s=s.append(r,f):f("if("+(s=s.append(r,f))+")"+p+".bindBuffer(34963,"+s+".buffer.buffer);")):(s=f.def(),f("if(",l.vao,".currentVAO){",s,"=",r.shared.elements+".getElements("+l.vao,".currentVAO.elements);",O?"":"if("+s+")"+p+".bindBuffer(34963,"+s+".buffer.buffer);","}else{",s,"=",h,".","elements",";","if(",s,"){",p,".bindBuffer(",34963,",",s,".buffer.buffer);}}")),s),g=e("primitive"),v=e("offset"),y=(l=d.count,s=n,l=l?((l.contextDep&&a.contextDynamic||l.propDep)&&(s=i),l.append(r,s)):s.def(h,".","count"));if("number"==typeof y){if(0===y)return}else i("if(",y,"){"),i.exit("}");T&&(u=e("instances"),c=r.instancing);var b=m+".type",w=d.elements&&te(d.elements)&&!d.vaoActive;T&&("number"!=typeof u||0<=u)?"string"==typeof u?(i("if(",u,">0){"),t(),i("}else if(",u,"<0){"),o(),i("}")):t():o()}function x(e,t,r,n,i){return i=(t=h()).proc("body",i),T&&(t.instancing=i.def(t.shared.extensions,".angle_instanced_arrays")),e(t,i,r,n),t.compile().body}function A(e,t,r,n){g(e,t),r.useVAO?r.drawVAO?t(e.shared.vao,".setVAO(",r.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),y(e,t,r,n.attributes,function(){return 1})),b(e,t,r,n.uniforms,function(){return 1},!1),w(e,t,t,r)}function _(e,t,r,n){function i(){return!0}e.batchId="a1",g(e,t),y(e,t,r,n.attributes,i),b(e,t,r,n.uniforms,i,!1),w(e,t,t,r)}function k(t,e,r,n){function i(e){return e.contextDep&&o||e.propDep}function a(e){return!i(e)}g(t,e);var o=r.contextDep,s=e.def(),f=e.def();t.shared.props=f,t.batchId=s;var u=t.scope(),c=t.scope();e(u.entry,"for(",s,"=0;",s,"<","a1",";++",s,"){",f,"=","a0","[",s,"];",c,"}",u.exit),r.needsContext&&l(t,c,r.context),r.needsFramebuffer&&d(t,c,r.framebuffer),p(t,c,r.state,i),r.profile&&i(r.profile)&&v(t,c,r,!1,!0),n?(r.useVAO?r.drawVAO?i(r.drawVAO)?c(t.shared.vao,".setVAO(",r.drawVAO.append(t,c),");"):u(t.shared.vao,".setVAO(",r.drawVAO.append(t,u),");"):u(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(u(t.shared.vao,".setVAO(null);"),y(t,u,r,n.attributes,a),y(t,c,r,n.attributes,i)),b(t,u,r,n.uniforms,a,!1),b(t,c,r,n.uniforms,i,!0),w(t,u,c,r)):(e=t.global.def("{}"),n=r.shader.progVar.append(t,c),f=c.def(n,".id"),u=c.def(e,"[",f,"]"),c(t.shared.gl,".useProgram(",n,".program);","if(!",u,"){",u,"=",e,"[",f,"]=",t.link(function(e){return x(_,t,r,e,2)}),"(",n,");}",u,".call(this,a0[",s,"],",s,");"))}function E(r,e,t){var n,i,a,o,s,f,u=e.static[t];u&&function(e){if("object"==typeof e&&!ue(e))for(var t=Object.keys(e),r=0;r<t.length;++r)if(Ae.isDynamic(e[t[r]]))return 1}(u)&&(n=r.global,i=Object.keys(u),s=o=a=!1,f=r.global.def("{}"),i.forEach(function(e){var t=u[e];if(Ae.isDynamic(t))"function"==typeof t&&(t=u[e]=Ae.unbox(t)),e=ye(t,null),a=a||e.thisDep,s=s||e.propDep,o=o||e.contextDep;else{switch(n(f,".",e,"="),typeof t){case"number":n(t);break;case"string":n('"',t,'"');break;case"object":Array.isArray(t)&&n("[",t.join(),"]");break;default:n(r.link(t))}n(";")}}),e.dynamic[t]=new Ae.DynamicVariable(4,{thisDep:a,contextDep:o,propDep:s,ref:f,append:function(r,n){i.forEach(function(e){var t=u[e];Ae.isDynamic(t)&&(t=r.invoke(n,t),n(f,".",e,"=",t,";"))})}}),delete e.static[t])}var X=G.Record,J={add:32774,subtract:32778,"reverse subtract":32779};N.ext_blend_minmax&&(J.min=32775,J.max=32776);var T=N.angle_instanced_arrays,C=N.webgl_draw_buffers,O=N.oes_vertex_array_object,S={dirty:!0,profile:o.profile},j={},K=[],D={},P={};s("dither",3024),s("blend.enable",3042),f("blend.color","blendColor",[0,0,0,0]),f("blend.equation","blendEquationSeparate",[32774,32774]),f("blend.func","blendFuncSeparate",[1,0,1,0]),s("depth.enable",2929,!0),f("depth.func","depthFunc",513),f("depth.range","depthRange",[0,1]),f("depth.mask","depthMask",!0),f("colorMask","colorMask",[!0,!0,!0,!0]),s("cull.enable",2884),f("cull.face","cullFace",1029),f("frontFace","frontFace",2305),f("lineWidth","lineWidth",1),s("polygonOffset.enable",32823),f("polygonOffset.offset","polygonOffset",[0,0]),s("sample.alpha",32926),s("sample.enable",32928),f("sample.coverage","sampleCoverage",[1,!1]),s("stencil.enable",2960),f("stencil.mask","stencilMask",-1),f("stencil.func","stencilFunc",[519,0,-1]),f("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),f("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),s("scissor.enable",3089),f("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),f("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var M={gl:e,context:i,strings:V,next:j,current:S,draw:n,elements:W,buffer:q,shader:Q,attributes:G.state,vao:G,uniforms:r,framebuffer:H,extensions:N,timer:m,isBufferArgs:$},I={primTypes:Be,compareFuncs:Ke,blendFuncs:Je,blendEquations:J,stencilOps:Ze,glTypes:De,orientationType:$e};C&&(I.backBuffer=[1029],I.drawBuffer=Z(a.maxDrawbuffers,function(e){return 0===e?[0]:Z(e,function(e){return 36064+e})}));var R=0;return{next:j,current:S,procs:function(){var o=h(),s=o.proc("poll"),f=o.proc("refresh"),u=o.block();s(u),f(u);var e,t=o.shared,c=t.gl,l=t.next,p=t.current;u(p,".dirty=false;"),d(o,s),d(o,f,null,!0),T&&(e=o.link(T)),N.oes_vertex_array_object&&f(o.link(N.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var r=0;r<a.maxAttributes;++r){var n=f.def(t.attributes,"[",r,"]"),i=o.cond(n,".buffer");i.then(c,".enableVertexAttribArray(",r,");",c,".bindBuffer(",34962,",",n,".buffer.buffer);",c,".vertexAttribPointer(",r,",",n,".size,",n,".type,",n,".normalized,",n,".stride,",n,".offset);").else(c,".disableVertexAttribArray(",r,");",c,".vertexAttrib4f(",r,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;"),f(i),T&&f(e,".vertexAttribDivisorANGLE(",r,",",n,".divisor);")}return f(o.shared.vao,".currentVAO=null;",o.shared.vao,".setVAO(",o.shared.vao,".targetVAO);"),Object.keys(D).forEach(function(e){var t=D[e],r=u.def(l,".",e),n=o.block();n("if(",r,"){",c,".enable(",t,")}else{",c,".disable(",t,")}",p,".",e,"=",r,";"),f(n),s("if(",r,"!==",p,".",e,"){",n,"}")}),Object.keys(P).forEach(function(e){var t,r,n=P[e],i=S[e],a=o.block();a(c,".",n,"("),ue(i)?(n=i.length,t=o.global.def(l,".",e),r=o.global.def(p,".",e),a(Z(n,function(e){return t+"["+e+"]"}),");",Z(n,function(e){return r+"["+e+"]="+t+"["+e+"];"}).join("")),s("if(",Z(n,function(e){return t+"["+e+"]!=="+r+"["+e+"]"}).join("||"),"){",a,"}")):(t=u.def(l,".",e),r=u.def(p,".",e),a(t,");",p,".",e,"=",t,";"),s("if(",t,"!==",r,"){",a,"}")),f(a)}),o.compile()}(),compile:function(t,r,e,n,i){var a=h();a.stats=a.link(i),Object.keys(r.static).forEach(function(e){E(a,r,e)}),L.forEach(function(e){E(a,t,e)});var o=u(t,r,e,n);return function(t,r){var e=t.proc("draw",1);g(t,e),l(t,e,r.context),d(t,e,r.framebuffer),c(t,e,r),p(t,e,r.state),v(t,e,r,!1,!0);var n,i,a,o=r.shader.progVar.append(t,e);e(t.shared.gl,".useProgram(",o,".program);"),r.shader.program?A(t,e,r,r.shader.program):(e(t.shared.vao,".setVAO(null);"),n=t.global.def("{}"),i=e.def(o,".id"),a=e.def(n,"[",i,"]"),e(t.cond(a).then(a,".call(this,a0);").else(a,"=",n,"[",i,"]=",t.link(function(e){return x(A,t,r,e,1)}),"(",o,");",a,".call(this,a0);"))),0<Object.keys(r.state).length&&e(t.shared.current,".dirty=true;")}(a,o),function(n,i){function e(e){var t=i.shader[e];t&&a.set(o.shader,"."+e,t.append(n,a))}var a=n.proc("scope",3);n.batchId="a2";var o=n.shared,t=o.current;l(n,a,i.context),i.framebuffer&&i.framebuffer.append(n,a),z(Object.keys(i.state)).forEach(function(r){var e=i.state[r].append(n,a);ue(e)?e.forEach(function(e,t){a.set(n.next[r],"["+t+"]",e)}):a.set(o.next,"."+r,e)}),v(n,a,i,!0,!0),["elements","offset","count","instances","primitive"].forEach(function(e){var t=i.draw[e];t&&a.set(o.draw,"."+e,""+t.append(n,a))}),Object.keys(i.uniforms).forEach(function(e){var t=i.uniforms[e].append(n,a);Array.isArray(t)&&(t="["+t.join()+"]"),a.set(o.uniforms,"["+V.id(e)+"]",t)}),Object.keys(i.attributes).forEach(function(e){var t=i.attributes[e].append(n,a),r=n.scopeAttrib(e);Object.keys(new X).forEach(function(e){a.set(r,"."+e,t[e])})}),i.scopeVAO&&a.set(o.vao,".targetVAO",i.scopeVAO.append(n,a)),e("vert"),e("frag"),0<Object.keys(i.state).length&&(a(t,".dirty=true;"),a.exit(t,".dirty=true;")),a("a1(",n.shared.context,",a0,",n.batchId,");")}(a,o),function(t,r){function n(e){return e.contextDep&&i||e.propDep}var e=t.proc("batch",2);t.batchId="0",g(t,e);var i=!1,a=!0;Object.keys(r.context).forEach(function(e){i=i||r.context[e].propDep}),i||(l(t,e,r.context),a=!1);var o,s=r.framebuffer,f=!1;s?(s.propDep?i=f=!0:s.contextDep&&i&&(f=!0),f||d(t,e,s)):d(t,e,null),r.state.viewport&&r.state.viewport.propDep&&(i=!0),c(t,e,r),p(t,e,r.state,function(e){return!n(e)}),r.profile&&n(r.profile)||v(t,e,r,!1,"a1"),r.contextDep=i,r.needsContext=a,r.needsFramebuffer=f,(a=r.shader.progVar).contextDep&&i||a.propDep?k(t,e,r,null):(a=a.append(t,e),e(t.shared.gl,".useProgram(",a,".program);"),r.shader.program?k(t,e,r,r.shader.program):(e(t.shared.vao,".setVAO(null);"),s=t.global.def("{}"),f=e.def(a,".id"),o=e.def(s,"[",f,"]"),e(t.cond(o).then(o,".call(this,a0,a1);").else(o,"=",s,"[",f,"]=",t.link(function(e){return x(k,t,r,e,2)}),"(",a,");",o,".call(this,a0,a1);")))),0<Object.keys(r.state).length&&e(t.shared.current,".dirty=true;")}(a,o),xe(a.compile(),{destroy:function(){o.shader.program.destroy()}})}}}function we(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}var xe=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e},n=0,Ae={DynamicVariable:i,define:function(e,t){return new i(e,r(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof i},unbox:function r(e,n){return"function"==typeof e?new i(0,e):"number"==typeof e||"boolean"==typeof e?new i(5,e):Array.isArray(e)?new i(6,e.map(function(e,t){return r(e,n+"["+t+"]")})):e instanceof i?e:void 0},accessor:r},_e={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},ke="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},Ee=e();Ee.zero=e();function Te(t){return Object.keys(t).map(function(e){return t[e]})}var Ce=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},Oe=function(e){for(var t=[];e.length;e=e[0])t.push(e.length);return t},Se=function(e,t,r,n){var i=1;if(t.length)for(var a=0;a<t.length;++a)i*=t[a];else i=0;switch(r=n||Ee.allocType(r,i),t.length){case 0:break;case 1:for(n=t[0],t=0;t<n;++t)r[t]=e[t];break;case 2:for(n=t[0],t=t[1],a=i=0;a<n;++a)for(var o=e[a],s=0;s<t;++s)r[i++]=o[s];break;case 3:l(e,t[0],t[1],t[2],r,0);break;default:!function e(t,r,n,i,a){for(var o=1,s=n+1;s<r.length;++s)o*=r[s];var f=r[n];if(4==r.length-n){var u=r[n+1],c=r[n+2];for(r=r[n+3],s=0;s<f;++s)l(t[s],u,c,r,i,a),a+=o}else for(s=0;s<f;++s)e(t[s],r,n+1,i,a),a+=o}(e,t,0,r,0)}return r},je={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},De={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Pe={dynamic:35048,stream:35040,static:35044},Me=Se,Ie=Oe,Re=[];Re[5120]=1,Re[5122]=2,Re[5124]=4,Re[5121]=1,Re[5123]=2,Re[5125]=4;var Be={points:0,point:0,lines:1,line:1,triangles:Re[5126]=4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},o=new Float32Array(1),s=new Uint32Array(o.buffer),Fe=[9984,9986,9985,9987],ze=[0,6409,6410,6407,6408],Le={};Le[6409]=Le[6406]=Le[6402]=1,Le[34041]=Le[6410]=2,Le[6407]=Le[35904]=3,Le[6408]=Le[35906]=4;var Ue=t("HTMLCanvasElement"),Ve=t("OffscreenCanvas"),Ne=t("CanvasRenderingContext2D"),qe=t("ImageBitmap"),We=t("HTMLImageElement"),He=t("HTMLVideoElement"),f=Object.keys(je).concat([Ue,Ve,Ne,qe,We,He]),u=[];u[5121]=1,u[5126]=4,u[36193]=2,u[5123]=2,u[5125]=4;var c=[];c[32854]=2,c[32855]=2,c[36194]=2,c[34041]=4,c[33776]=.5,c[33777]=.5,c[33778]=1,c[33779]=1,c[35986]=.5,c[35987]=1,c[34798]=1,c[35840]=.5,c[35841]=.25,c[35842]=.5,c[35843]=.25,c[36196]=.5;var Ge=[];Ge[32854]=2,Ge[32855]=2,Ge[36194]=2,Ge[33189]=2,Ge[36168]=1,Ge[34041]=4,Ge[35907]=4,Ge[34836]=16,Ge[34842]=8,Ge[34843]=6;var Qe=[];Qe[6408]=4,Qe[6407]=3;var Ye=[];Ye[5121]=1,Ye[5126]=4,Ye[36193]=2;var Xe=["x","y","z","w"],L="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Je={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ke={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ze={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},$e={cw:2304,ccw:2305},U=new ee(!1,!1,!1,function(){});return function(e){function r(){if(0===G.length)j&&j.update(),J=null;else{J=_e.next(r),c();for(var e=G.length-1;0<=e;--e){var t=G[e];t&&t(I,null,0)}h.flush(),j&&j.update()}}function n(){!J&&0<G.length&&(J=_e.next(r))}function i(){J&&(_e.cancel(r),J=null)}function t(e){e.preventDefault(),i(),Q.forEach(function(e){e()})}function a(e){h.getError(),m.restore(),L.restore(),B.restore(),U.restore(),V.restore(),N.restore(),z.restore(),j&&j.restore(),q.procs.refresh(),n(),Y.forEach(function(e){e()})}function o(e){function t(n,i){var a={},o={};return Object.keys(n).forEach(function(e){var t=n[e];if(Ae.isDynamic(t))o[e]=Ae.unbox(t,e);else{if(i&&Array.isArray(t))for(var r=0;r<t.length;++r)if(Ae.isDynamic(t[r]))return void(o[e]=Ae.unbox(t,e));a[e]=t}}),{dynamic:o,static:a}}var n,r=t(e.context||{},!0),i=t(e.uniforms||{},!0),a=t(e.attributes||{},!1);function o(t){var r;t in n&&(r=n[t],delete n[t],Object.keys(r).forEach(function(e){n[t+"."+e]=r[e]}))}e=t((delete(n=xe({},s=e)).uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),o("blend"),o("depth"),o("cull"),o("stencil"),o("polygonOffset"),o("scissor"),o("sample"),"vao"in s&&(n.vao=s.vao),n),!1);var s={gpuTime:0,cpuTime:0,count:0},f=q.compile(e,a,i,r,s),u=f.draw,c=f.batch,l=f.scope,p=[];return xe(function(e,t){var r;if("function"==typeof e)return l.call(this,null,e,0);if("function"!=typeof t)return"number"!=typeof e?Array.isArray(e)?e.length?c.call(this,e,e.length):void 0:u.call(this,e):0<e?c.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e):void 0;if("number"==typeof e)for(r=0;r<e;++r)l.call(this,null,t,r);else{if(!Array.isArray(e))return l.call(this,e,t,0);for(r=0;r<e.length;++r)l.call(this,e[r],t,r)}},{stats:s,destroy:function(){f.destroy()}})}function s(e,t){var r=0;q.procs.poll();var n=t.color;n&&(h.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),r|=16384),"depth"in t&&(h.clearDepth(+t.depth),r|=256),"stencil"in t&&(h.clearStencil(0|t.stencil),r|=1024),h.clear(r)}function f(t){return G.push(t),n(),{cancel:function(){var e=we(G,t);G[e]=function e(){var t=we(G,e);G[t]=G[G.length-1],--G.length,G.length<=0&&i()}}}}function u(){var e=W.viewport,t=W.scissor_box;e[0]=e[1]=t[0]=t[1]=0,I.viewportWidth=I.framebufferWidth=I.drawingBufferWidth=e[2]=t[2]=h.drawingBufferWidth,I.viewportHeight=I.framebufferHeight=I.drawingBufferHeight=e[3]=t[3]=h.drawingBufferHeight}function c(){I.tick+=1,I.time=p(),u(),q.procs.poll()}function l(){U.refresh(),u(),q.procs.refresh(),j&&j.update()}function p(){return(ke()-D)/1e3}if(!(e=ne(e)))return null;var h=e.gl,d=h.getContextAttributes();h.isContextLost();var m=function(r,e){function t(e){var t;e=e.toLowerCase();try{t=n[e]=r.getExtension(e)}catch(e){}return!!t}for(var n={},i=0;i<e.extensions.length;++i){var a=e.extensions[i];if(!t(a))return e.onDestroy(),e.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(t),{extensions:n,restore:function(){Object.keys(n).forEach(function(e){if(n[e]&&!t(e))throw Error("(regl): error restoring extension "+e)})}}}(h,e);if(!m)return null;var g,v,y,b,w,x,A,_,k,E,T,C=(E={"":0},T=[""],{id:function(e){var t=E[e];return t||(t=E[e]=T.length,T.push(e),t)},str:function(e){return T[e]}}),O={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},S=m.extensions,j=function(a){function i(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function r(e,t,r){var n=f.pop()||new i;n.startQueryIndex=e,n.endQueryIndex=t,n.sum=0,n.stats=r,u.push(n)}if(!a.ext_disjoint_timer_query)return null;var o=[],s=[],f=[],u=[],c=[],l=[];return{beginQuery:function(e){var t=o.pop()||a.ext_disjoint_timer_query.createQueryEXT();a.ext_disjoint_timer_query.beginQueryEXT(35007,t),s.push(t),r(s.length-1,s.length,e)},endQuery:function(){a.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:r,update:function(){var e=s.length;if(0!==e){l.length=Math.max(l.length,e+1),c.length=Math.max(c.length,e+1),c[0]=0;for(var t=l[0]=0,r=e=0;r<s.length;++r){var n=s[r];a.ext_disjoint_timer_query.getQueryObjectEXT(n,34919)?(t+=a.ext_disjoint_timer_query.getQueryObjectEXT(n,34918),o.push(n)):s[e++]=n,c[r+1]=t,l[r+1]=e}for(s.length=e,r=e=0;r<u.length;++r){var i=(t=u[r]).startQueryIndex,n=t.endQueryIndex;t.sum+=c[n]-c[i],i=l[i],(n=l[n])===i?(t.stats.gpuTime+=t.sum/1e6,f.push(t)):(t.startQueryIndex=i,t.endQueryIndex=n,u[e++]=t)}u.length=e}},getNumPendingQueries:function(){return s.length},clear:function(){o.push.apply(o,s);for(var e=0;e<o.length;e++)a.ext_disjoint_timer_query.deleteQueryEXT(o[e]);s.length=0,o.length=0},restore:function(){s.length=0,o.length=0}}}(S),D=ke(),P=h.drawingBufferWidth,M=h.drawingBufferHeight,I={tick:0,time:0,viewportWidth:P,viewportHeight:M,framebufferWidth:P,framebufferHeight:M,drawingBufferWidth:P,drawingBufferHeight:M,pixelRatio:e.pixelRatio},P={elements:null,primitive:4,count:-1,offset:0,instances:-1},R=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(34047));var n=1,i=1;t.webgl_draw_buffers&&(n=e.getParameter(34852),i=e.getParameter(36063));var a,o,s=!!t.oes_texture_float;return s&&(s=e.createTexture(),e.bindTexture(3553,s),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null),a=e.createFramebuffer(),e.bindFramebuffer(36160,a),e.framebufferTexture2D(36160,36064,3553,s,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160)?s=!1:(e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384),o=Ee.allocType(5126,4),e.readPixels(0,0,1,1,6408,5126,o),s=!e.getError()&&(e.deleteFramebuffer(a),e.deleteTexture(s),1===o[0]),Ee.freeType(o))),o=!0,"undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(o=e.createTexture(),a=Ee.allocType(5121,36),e.activeTexture(33984),e.bindTexture(34067,o),e.texImage2D(34069,0,6408,3,3,0,6408,5121,a),Ee.freeType(a),e.bindTexture(34067,null),e.deleteTexture(o),o=!e.getError()),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:s,npotTextureCube:o}}(h,S),B=function(c,n,s,t){function i(e){this.id=r++,this.buffer=c.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,s.profile&&(this.stats={size:0})}function p(e,t,r){e.byteLength=t.byteLength,c.bufferData(e.type,t,r)}function l(e,t,r,n,i,a){var o,s,f,u,c;if(e.usage=r,Array.isArray(t)){if(e.dtype=n||5126,0<t.length)if(Array.isArray(t[0])){i=Ie(t);for(var l=n=1;l<i.length;++l)n*=i[l];e.dimension=n,p(e,t=Me(t,i,e.dtype),r),a?e.persistentData=t:Ee.freeType(t)}else"number"==typeof t[0]?(e.dimension=i,oe(i=Ee.allocType(e.dtype,t.length),t),p(e,i,r),a?e.persistentData=i:Ee.freeType(i)):Ce(t[0])&&(e.dimension=t[0].length,e.dtype=n||ae(t[0])||5126,p(e,t=Me(t,[t.length,t[0].length],e.dtype),r),a?e.persistentData=t:Ee.freeType(t))}else Ce(t)?(e.dtype=n||ae(t),e.dimension=i,p(e,t,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)))):ie(t)?(i=t.shape,o=t.stride,l=t.offset,c=u=f=s=0,1===i.length?(s=i[0],f=1,u=o[0],c=0):2===i.length&&(s=i[0],f=i[1],u=o[0],c=o[1]),e.dtype=n||ae(t.data)||5126,e.dimension=f,se(i=Ee.allocType(e.dtype,s*f),t.data,s,f,u,c,l),p(e,i,r),a?e.persistentData=i:Ee.freeType(i)):t instanceof ArrayBuffer&&(e.dtype=5121,e.dimension=i,p(e,t,r),a&&(e.persistentData=new Uint8Array(new Uint8Array(t))))}function a(e){n.bufferCount--,t(e),c.deleteBuffer(e.buffer),e.buffer=null,delete h[e.id]}var r=0,h={};i.prototype.bind=function(){c.bindBuffer(this.type,this.buffer)},i.prototype.destroy=function(){a(this)};var o=[];return s.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(h).forEach(function(e){t+=h[e].stats.size}),t}),{create:function(e,t,r,o){function f(e){var t=35044,r=null,n=0,i=0,a=1;return Array.isArray(e)||Ce(e)||ie(e)||e instanceof ArrayBuffer?r=e:"number"==typeof e?n=0|e:e&&("data"in e&&(r=e.data),"usage"in e&&(t=Pe[e.usage]),"type"in e&&(i=De[e.type]),"dimension"in e&&(a=0|e.dimension),"length"in e&&(n=0|e.length)),u.bind(),r?l(u,r,t,i,a,o):(n&&c.bufferData(u.type,n,t),u.dtype=i||5121,u.usage=t,u.dimension=a,u.byteLength=n),s.profile&&(u.stats.size=u.byteLength*Re[u.dtype]),f}n.bufferCount++;var u=new i(t);return h[u.id]=u,r||f(e),f._reglType="buffer",f._buffer=u,f.subdata=function(e,t){var r,n,i,a,o,s=0|(t||0);return u.bind(),Ce(e)||e instanceof ArrayBuffer?c.bufferSubData(u.type,s,e):Array.isArray(e)?0<e.length&&("number"==typeof e[0]?(oe(n=Ee.allocType(u.dtype,e.length),e),c.bufferSubData(u.type,s,n),Ee.freeType(n)):(Array.isArray(e[0])||Ce(e[0]))&&(r=Ie(e),n=Me(e,r,u.dtype),c.bufferSubData(u.type,s,n),Ee.freeType(n))):ie(e)&&(r=e.shape,i=e.stride,t=o=a=n=0,1===r.length?(n=r[0],a=1,o=i[0],t=0):2===r.length&&(n=r[0],a=r[1],o=i[0],t=i[1]),r=Array.isArray(e.data)?u.dtype:ae(e.data),se(r=Ee.allocType(r,n*a),e.data,n,a,o,t,e.offset),c.bufferSubData(u.type,s,r),Ee.freeType(r)),f},s.profile&&(f.stats=u.stats),f.destroy=function(){a(u)},f},createStream:function(e,t){var r=o.pop();return(r=r||new i(e)).bind(),l(r,t,35040,0,1,!1),r},destroyStream:function(e){o.push(e)},clear:function(){Te(h).forEach(a),o.forEach(a)},getBuffer:function(e){return e&&e._buffer instanceof i?e._buffer:null},restore:function(){Te(h).forEach(function(e){e.buffer=c.createBuffer(),c.bindBuffer(e.type,e.buffer),c.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:l}}(h,O,e,function(e){return z.destroyBuffer(e)}),F=function(f,u,c,r){function n(e){this.id=a++,(t[this.id]=this).buffer=e,this.primType=4,this.type=this.vertCount=0}function l(e,t,r,n,i,a,o){var s;if(e.buffer.bind(),t?((s=o)||Ce(t)&&(!ie(t)||Ce(t.data))||(s=u.oes_element_index_uint?5125:5123),c._initBuffer(e.buffer,t,r,s,3)):(f.bufferData(34963,a,r),e.buffer.dtype=s||5121,e.buffer.usage=r,e.buffer.dimension=3,e.buffer.byteLength=a),!(s=o)){switch(e.buffer.dtype){case 5121:case 5120:s=5121;break;case 5123:case 5122:s=5123;break;case 5125:case 5124:s=5125}e.buffer.dtype=s}e.type=s,(t=i)<0&&(t=e.buffer.byteLength,5123===s?t>>=1:5125===s&&(t>>=2)),e.vertCount=t,(t=n)<0&&(t=4,1===(n=e.buffer.dimension)&&(t=0),2===n&&(t=1),3===n&&(t=4)),e.primType=t}function i(e){r.elementsCount--,delete t[e.id],e.buffer.destroy(),e.buffer=null}var t={},a=0,p={uint8:5121,uint16:5123};u.oes_element_index_uint&&(p.uint32=5125),n.prototype.bind=function(){this.buffer.bind()};var o=[];return{create:function(e,t){function s(e){var t,r,n,i,a,o;return e?"number"==typeof e?(f(e),u.primType=4,u.vertCount=0|e,u.type=5121):(t=null,r=35044,i=n=-1,o=a=0,Array.isArray(e)||Ce(e)||ie(e)?t=e:("data"in e&&(t=e.data),"usage"in e&&(r=Pe[e.usage]),"primitive"in e&&(n=Be[e.primitive]),"count"in e&&(i=0|e.count),"type"in e&&(o=p[e.type]),"length"in e?a=0|e.length:(a=i,5123===o||5122===o?a*=2:5125!==o&&5124!==o||(a*=4))),l(u,t,r,n,i,a,o)):(f(),u.primType=4,u.vertCount=0,u.type=5121),s}var f=c.create(null,34963,!0),u=new n(f._buffer);return r.elementsCount++,s(e),s._reglType="elements",s._elements=u,s.subdata=function(e,t){return f.subdata(e,t),s},s.destroy=function(){i(u)},s},createStream:function(e){var t=o.pop();return l(t=t||new n(c.create(null,34963,!0,!1)._buffer),e,35040,-1,-1,0,0),t},destroyStream:function(e){o.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof n?e._elements:null},clear:function(){Te(t).forEach(i)}}}(h,S,B,O),z=ge(h,S,R,O,B,F,P),L=(g=h,v=C,y=O,w={},x={},A={},_=[],k=0,(b=e).profile&&(y.getMaxUniformsCount=function(){var t=0;return _.forEach(function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)}),t},y.getMaxAttributesCount=function(){var t=0;return _.forEach(function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)}),t}),{clear:function(){var e=g.deleteShader.bind(g);Te(w).forEach(e),w={},Te(x).forEach(e),x={},_.forEach(function(e){g.deleteProgram(e.program)}),_.length=0,A={},y.shaderCount=0},program:function(e,t,r,n){var i=A[t],a=(i=i||(A[t]={}))[e];if(a&&(a.refCount++,!n))return a;var o=new ee(t,e);return y.shaderCount++,te(o,0,n),a||(i[e]=o),_.push(o),xe(o,{destroy:function(){var e;o.refCount--,o.refCount<=0&&(g.deleteProgram(o.program),e=_.indexOf(o),_.splice(e,1),y.shaderCount--),i[o.vertId].refCount<=0&&(g.deleteShader(x[o.vertId]),delete x[o.vertId],delete A[o.fragId][o.vertId]),Object.keys(A[o.fragId]).length||(g.deleteShader(w[o.fragId]),delete w[o.fragId],delete A[o.fragId])}})},restore:function(){w={},x={};for(var e=0;e<_.length;++e)te(_[e],0,_[e].attributes.map(function(e){return[e.location,e.name]}))},shader:$,frag:-1,vert:-1}),U=function(d,n,e,m,g,o,l){function r(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function p(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function v(e,t){var r,n,i,a;"object"==typeof t&&t&&("premultiplyAlpha"in t&&(e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(e.flipY=t.flipY),"alignment"in t&&(e.unpackAlignment=t.alignment),"colorSpace"in t&&(e.colorSpace=M[t.colorSpace]),"type"in t&&(e.type=I[t.type]),r=e.width,n=e.height,i=e.channels,a=!1,"shape"in t?(r=t.shape[0],n=t.shape[1],3===t.shape.length&&(i=t.shape[2],a=!0)):("radius"in t&&(r=n=t.radius),"width"in t&&(r=t.width),"height"in t&&(n=t.height),"channels"in t&&(i=t.channels,a=!0)),e.width=0|r,e.height=0|n,e.channels=0|i,r=!1,"format"in t&&(r=t.format,n=e.internalformat=R[r],e.format=W[n],r in I&&!("type"in t)&&(e.type=I[r]),r in B&&(e.compressed=!0),r=!0),!a&&r?e.channels=Le[e.format]:a&&!r&&e.channels!==ze[e.format]&&(e.format=e.internalformat=ze[e.channels]))}function y(e){d.pixelStorei(37440,e.flipY),d.pixelStorei(37441,e.premultiplyAlpha),d.pixelStorei(37443,e.colorSpace),d.pixelStorei(3317,e.unpackAlignment)}function t(){r.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function h(e,t){var r=null;if(he(t)?r=t:t&&(v(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),he(t.data)&&(r=t.data)),t.copy){var n=g.viewportWidth,i=g.viewportHeight;e.width=e.width||n-e.xOffset,e.height=e.height||i-e.yOffset,e.needsCopy=!0}else if(r){if(Ce(r))e.channels=e.channels||4,e.data=r,"type"in t||5121!==e.type||(e.type=0|je[Object.prototype.toString.call(r)]);else if(ce(r)){switch(e.channels=e.channels||4,i=(n=r).length,e.type){case 5121:case 5123:case 5125:case 5126:(i=Ee.allocType(e.type,i)).set(n),e.data=i;break;case 36193:e.data=fe(n)}e.alignment=1,e.needsFree=!0}else if(ie(r)){n=r.data,Array.isArray(n)||5121!==e.type||(e.type=0|je[Object.prototype.toString.call(n)]);var a,i=r.shape,o=r.stride,s=3===i.length?(a=i[2],o[2]):a=1,f=i[0],u=i[1];i=o[0],o=o[1],e.alignment=1,e.width=f,e.height=u,e.channels=a,e.format=e.internalformat=ze[a],e.needsFree=!0,f=s,r=r.offset,a=e.width,s=e.height,u=e.channels;for(var c=Ee.allocType(36193===e.type?5126:e.type,a*s*u),l=0,p=0;p<s;++p)for(var h=0;h<a;++h)for(var d=0;d<u;++d)c[l++]=n[i*h+o*p+f*d+r];de(e,c)}else if(pe(r)===Ue||pe(r)===Ve||pe(r)===Ne)pe(r)===Ue||pe(r)===Ve?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(pe(r)===qe)e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(pe(r)===We)e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(pe(r)===He)e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(le(r)){for(n=e.width||r[0].length,i=e.height||r.length,o=e.channels,o=ue(r[0][0])?o||r[0][0].length:o||1,f=Oe(r),a=1,s=0;s<f.length;++s)a*=f[s];a=Ee.allocType(36193===e.type?5126:e.type,a),Se(r,f,"",a),de(e,a),e.alignment=1,e.width=n,e.height=i,e.channels=o,e.format=e.internalformat=ze[o],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4}function b(e,t,r,n,i){var a=e.element,o=e.data,s=e.internalformat,f=e.format,u=e.type,c=e.width,l=e.height;y(e),a?d.texSubImage2D(t,i,r,n,f,u,a):e.compressed?d.compressedTexSubImage2D(t,i,r,n,s,c,l,o):e.needsCopy?(m(),d.copyTexSubImage2D(t,i,r,n,e.xOffset,e.yOffset,c,l)):d.texSubImage2D(t,i,r,n,c,l,f,u,o)}function w(){return H.pop()||new t}function x(e){e.needsFree&&Ee.freeType(e.data),t.call(e),H.push(e)}function i(){r.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function A(e,t,r){var n=e.images[0]=w();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function _(e,t){var r=null;if(he(t))p(r=e.images[0]=w(),e),h(r,t),e.mipmask=1;else if(v(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,i=0;i<n.length;++i)p(r=e.images[i]=w(),e),r.width>>=i,r.height>>=i,h(r,n[i]),e.mipmask|=1<<i;else p(r=e.images[0]=w(),e),h(r,t),e.mipmask=1;p(e,e.images[0])}function k(e,t){for(var r=e.images,n=0;n<r.length&&r[n];++n){var i=r[n],a=t,o=n,s=i.element,f=i.data,u=i.internalformat,c=i.format,l=i.type,p=i.width,h=i.height;y(i),s?d.texImage2D(a,o,c,c,l,s):i.compressed?d.compressedTexImage2D(a,o,u,p,h,0,f):i.needsCopy?(m(),d.copyTexImage2D(a,o,c,i.xOffset,i.yOffset,p,h,0)):d.texImage2D(a,o,c,p,h,0,c,l,f||null)}}function E(){var e=G.pop()||new i;r.call(e);for(var t=e.mipmask=0;t<16;++t)e.images[t]=null;return e}function T(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&x(t[r]),t[r]=null;G.push(e)}function C(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function O(e,t){"min"in t&&(e.minFilter=c[t.min],0<=Fe.indexOf(e.minFilter)&&!("faces"in t)&&(e.genMipmaps=!0)),"mag"in t&&(e.magFilter=u[t.mag]);var r,n=e.wrapS,i=e.wrapT;if("wrap"in t?"string"==typeof(r=t.wrap)?n=i=f[r]:Array.isArray(r)&&(n=f[r[0]],i=f[r[1]]):("wrapS"in t&&(n=f[t.wrapS]),"wrapT"in t&&(i=f[t.wrapT])),e.wrapS=n,e.wrapT=i,"anisotropic"in t&&(e.anisotropic=t.anisotropic),"mipmap"in t){switch(n=!1,typeof t.mipmap){case"string":e.mipmapHint=s[t.mipmap],n=e.genMipmaps=!0;break;case"boolean":n=e.genMipmaps=t.mipmap;break;case"object":n=!(e.genMipmaps=!1)}!n||"min"in t||(e.minFilter=9984)}}function S(e,t){d.texParameteri(t,10241,e.minFilter),d.texParameteri(t,10240,e.magFilter),d.texParameteri(t,10242,e.wrapS),d.texParameteri(t,10243,e.wrapT),n.ext_texture_filter_anisotropic&&d.texParameteri(t,34046,e.anisotropic),e.genMipmaps&&(d.hint(33170,e.mipmapHint),d.generateMipmap(t))}function j(e){r.call(this),this.mipmask=0,this.internalformat=6408,this.id=Q++,this.refCount=1,this.target=e,this.texture=d.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new C,l.profile&&(this.stats={size:0})}function D(e){d.activeTexture(33984),d.bindTexture(e.target,e.texture)}function P(){var e=J[0];e?d.bindTexture(e.target,e.texture):d.bindTexture(3553,null)}function a(e){var t=e.texture,r=e.unit,n=e.target;0<=r&&(d.activeTexture(33984+r),d.bindTexture(n,null),J[r]=null),d.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete Y[e.id],o.textureCount--}var s={"don't care":4352,"dont care":4352,nice:4354,fast:4353},f={repeat:10497,clamp:33071,mirror:33648},u={nearest:9728,linear:9729},c=xe({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},u),M={none:0,browser:37444},I={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},R={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},B={};n.ext_srgb&&(R.srgb=35904,R.srgba=35906),n.oes_texture_float&&(I.float32=I.float=5126),n.oes_texture_half_float&&(I.float16=I["half float"]=36193),n.webgl_depth_texture&&(xe(R,{depth:6402,"depth stencil":34041}),xe(I,{uint16:5123,uint32:5125,"depth stencil":34042})),n.webgl_compressed_texture_s3tc&&xe(B,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),n.webgl_compressed_texture_atc&&xe(B,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),n.webgl_compressed_texture_pvrtc&&xe(B,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),n.webgl_compressed_texture_etc1&&(B["rgb etc1"]=36196);var F=Array.prototype.slice.call(d.getParameter(34467));Object.keys(B).forEach(function(e){var t=B[e];0<=F.indexOf(t)&&(R[e]=t)});var z=Object.keys(R);e.textureFormats=z;var L=[];Object.keys(R).forEach(function(e){L[R[e]]=e});var U=[];Object.keys(I).forEach(function(e){U[I[e]]=e});var V=[];Object.keys(u).forEach(function(e){V[u[e]]=e});var N=[];Object.keys(c).forEach(function(e){N[c[e]]=e});var q=[];Object.keys(f).forEach(function(e){q[f[e]]=e});var W=z.reduce(function(e,t){var r=R[t];return 6409===r||6406===r||6409===r||6410===r||6402===r||34041===r||n.ext_srgb&&(35904===r||35906===r)?e[r]=r:32855===r||0<=t.indexOf("rgba")?e[r]=6408:e[r]=6407,e},{}),H=[],G=[],Q=0,Y={},X=e.maxTextureUnits,J=Array(X).map(function(){return null});return xe(j.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<X;++t){var r=J[t];if(r){if(0<r.bindCount)continue;r.unit=-1}J[t]=this,e=t;break}l.profile&&o.maxTextureUnits<e+1&&(o.maxTextureUnits=e+1),this.unit=e,d.activeTexture(33984+e),d.bindTexture(this.target,this.texture)}return e},unbind:function(){--this.bindCount},decRef:function(){--this.refCount<=0&&a(this)}}),l.profile&&(o.getTotalTextureSize=function(){var t=0;return Object.keys(Y).forEach(function(e){t+=Y[e].stats.size}),t}),{create2D:function(e,t){function s(e,t){var r=f.texInfo;C.call(r);var n=E();return"number"==typeof e?A(n,0|e,"number"==typeof t?0|t:0|e):e?(O(r,e),_(n,e)):A(n,1,1),r.genMipmaps&&(n.mipmask=(n.width<<1)-1),f.mipmask=n.mipmask,p(f,n),f.internalformat=n.internalformat,s.width=n.width,s.height=n.height,D(f),k(n,3553),S(r,3553),P(),T(n),l.profile&&(f.stats.size=me(f.internalformat,f.type,n.width,n.height,r.genMipmaps,!1)),s.format=L[f.internalformat],s.type=U[f.type],s.mag=V[r.magFilter],s.min=N[r.minFilter],s.wrapS=q[r.wrapS],s.wrapT=q[r.wrapT],s}var f=new j(3553);return Y[f.id]=f,o.textureCount++,s(e,t),s.subimage=function(e,t,r,n){t|=0,r|=0,n|=0;var i=w();return p(i,f),i.width=0,i.height=0,h(i,e),i.width=i.width||(f.width>>n)-t,i.height=i.height||(f.height>>n)-r,D(f),b(i,3553,t,r,n),P(),x(i),s},s.resize=function(e,t){var r=0|e,n=0|t||r;if(r===f.width&&n===f.height)return s;s.width=f.width=r,s.height=f.height=n,D(f);for(var i=0;f.mipmask>>i;++i){var a=r>>i,o=n>>i;if(!a||!o)break;d.texImage2D(3553,i,f.format,a,o,0,f.format,f.type,null)}return P(),l.profile&&(f.stats.size=me(f.internalformat,f.type,r,n,!1,!1)),s},s._reglType="texture2d",s._texture=f,l.profile&&(s.stats=f.stats),s.destroy=function(){f.decRef()},s},createCube:function(e,t,r,n,i,a){function f(e,t,r,n,i,a){var o,s=u.texInfo;for(C.call(s),o=0;o<6;++o)c[o]=E();if("number"!=typeof e&&e){if("object"==typeof e)if(t)_(c[0],e),_(c[1],t),_(c[2],r),_(c[3],n),_(c[4],i),_(c[5],a);else if(O(s,e),v(u,e),"faces"in e)for(e=e.faces,o=0;o<6;++o)p(c[o],u),_(c[o],e[o]);else for(o=0;o<6;++o)_(c[o],e)}else for(e=0|e||1,o=0;o<6;++o)A(c[o],e,e);for(p(u,c[0]),u.mipmask=s.genMipmaps?(c[0].width<<1)-1:c[0].mipmask,u.internalformat=c[0].internalformat,f.width=c[0].width,f.height=c[0].height,D(u),o=0;o<6;++o)k(c[o],34069+o);for(S(s,34067),P(),l.profile&&(u.stats.size=me(u.internalformat,u.type,f.width,f.height,s.genMipmaps,!0)),f.format=L[u.internalformat],f.type=U[u.type],f.mag=V[s.magFilter],f.min=N[s.minFilter],f.wrapS=q[s.wrapS],f.wrapT=q[s.wrapT],o=0;o<6;++o)T(c[o]);return f}var u=new j(34067);Y[u.id]=u,o.cubeCount++;var c=Array(6);return f(e,t,r,n,i,a),f.subimage=function(e,t,r,n,i){r|=0,n|=0,i|=0;var a=w();return p(a,u),a.width=0,a.height=0,h(a,t),a.width=a.width||(u.width>>i)-r,a.height=a.height||(u.height>>i)-n,D(u),b(a,34069+e,r,n,i),P(),x(a),f},f.resize=function(e){if((e|=0)!==u.width){f.width=u.width=e,f.height=u.height=e,D(u);for(var t=0;t<6;++t)for(var r=0;u.mipmask>>r;++r)d.texImage2D(34069+t,r,u.format,e>>r,e>>r,0,u.format,u.type,null);return P(),l.profile&&(u.stats.size=me(u.internalformat,u.type,f.width,f.height,!1,!0)),f}},f._reglType="textureCube",f._texture=u,l.profile&&(f.stats=u.stats),f.destroy=function(){u.decRef()},f},clear:function(){for(var e=0;e<X;++e)d.activeTexture(33984+e),d.bindTexture(3553,null),J[e]=null;Te(Y).forEach(a),o.cubeCount=0,o.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<X;++e){var t=J[e];t&&(t.bindCount=0,t.unit=-1,J[e]=null)}Te(Y).forEach(function(e){e.texture=d.createTexture(),d.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(3553===e.target)d.texImage2D(3553,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)d.texImage2D(34069+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);S(e.texInfo,e.target)})},refresh:function(){for(var e=0;e<X;++e){var t=J[e];t&&(t.bindCount=0,t.unit=-1,J[e]=null),d.activeTexture(33984+e),d.bindTexture(3553,null),d.bindTexture(34067,null)}}}}(h,S,R,function(){q.procs.poll()},I,O,e),V=function(s,e,r,f){function n(e){this.id=i++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.height=this.width=0,f.profile&&(this.stats={size:0})}function t(e){var t=e.renderbuffer;s.bindRenderbuffer(36161,null),s.deleteRenderbuffer(t),e.renderbuffer=null,e.refCount=0,delete l[e.id],r.renderbufferCount--}var u={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(u.srgba=35907),e.ext_color_buffer_half_float&&(u.rgba16f=34842,u.rgb16f=34843),e.webgl_color_buffer_float&&(u.rgba32f=34836);var c=[];Object.keys(u).forEach(function(e){c[u[e]]=e});var i=0,l={};return n.prototype.decRef=function(){--this.refCount<=0&&t(this)},f.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(l).forEach(function(e){t+=l[e].stats.size}),t}),{create:function(e,t){function a(e,t){var r=0,n=0,i=32854;if("object"==typeof e&&e?("shape"in e?(r=0|(n=e.shape)[0],n=0|n[1]):("radius"in e&&(r=n=0|e.radius),"width"in e&&(r=0|e.width),"height"in e&&(n=0|e.height)),"format"in e&&(i=u[e.format])):"number"==typeof e?(r=0|e,n="number"==typeof t?0|t:r):e||(r=n=1),r!==o.width||n!==o.height||i!==o.format)return a.width=o.width=r,a.height=o.height=n,o.format=i,s.bindRenderbuffer(36161,o.renderbuffer),s.renderbufferStorage(36161,i,r,n),f.profile&&(o.stats.size=Ge[o.format]*o.width*o.height),a.format=c[o.format],a}var o=new n(s.createRenderbuffer());return l[o.id]=o,r.renderbufferCount++,a(e,t),a.resize=function(e,t){e|=0,t=0|t||e;return e===o.width&&t===o.height||(a.width=o.width=e,a.height=o.height=t,s.bindRenderbuffer(36161,o.renderbuffer),s.renderbufferStorage(36161,o.format,e,t),f.profile&&(o.stats.size=Ge[o.format]*o.width*o.height)),a},a._reglType="renderbuffer",a._renderbuffer=o,f.profile&&(a.stats=o.stats),a.destroy=function(){o.decRef()},a},clear:function(){Te(l).forEach(t)},restore:function(){Te(l).forEach(function(e){e.renderbuffer=s.createRenderbuffer(),s.bindRenderbuffer(36161,e.renderbuffer),s.renderbufferStorage(36161,e.format,e.width,e.height)}),s.bindRenderbuffer(36161,null)}}}(h,S,O,e),N=function(n,e,i,u,a,r){function o(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=e=0;t?(e=t.width,n=t.height):r&&(e=r.width,n=r.height),this.width=e,this.height=n}function t(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function b(e){e&&(e.texture?e.texture._texture.refCount+=1:e.renderbuffer._renderbuffer.refCount+=1)}function s(e,t){t&&(t.texture?n.framebufferTexture2D(36160,e,t.target,t.texture._texture.texture,0):n.framebufferRenderbuffer(36160,e,36161,t.renderbuffer._renderbuffer.renderbuffer))}function w(e){var t=3553,r=null,n=null,i=e;return"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),"texture2d"===(e=i._reglType)||"textureCube"===e?r=i:"renderbuffer"===e&&(n=i,t=36161),new o(t,r,n)}function x(e,t,r,n,i){return r?((e=u.create2D({width:e,height:t,format:n,type:i}))._texture.refCount=0,new o(3553,e,null)):((e=a.create({width:e,height:t,format:n}))._renderbuffer.refCount=0,new o(36161,null,e))}function A(e){return e&&(e.texture||e.renderbuffer)}function f(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r),e.width=t,e.height=r)}function c(){this.id=m++,(g[this.id]=this).framebuffer=n.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function _(e){e.colorAttachments.forEach(t),t(e.depthAttachment),t(e.stencilAttachment),t(e.depthStencilAttachment)}function l(e){n.deleteFramebuffer(e.framebuffer),e.framebuffer=null,r.framebufferCount--,delete g[e.id]}function k(e){n.bindFramebuffer(36160,e.framebuffer);for(var t=e.colorAttachments,r=0;r<t.length;++r)s(36064+r,t[r]);for(r=t.length;r<i.maxColorAttachments;++r)n.framebufferTexture2D(36160,36064+r,3553,null,0);n.framebufferTexture2D(36160,33306,3553,null,0),n.framebufferTexture2D(36160,36096,3553,null,0),n.framebufferTexture2D(36160,36128,3553,null,0),s(36096,e.depthAttachment),s(36128,e.stencilAttachment),s(33306,e.depthStencilAttachment),n.checkFramebufferStatus(36160),n.isContextLost(),n.bindFramebuffer(36160,h.next?h.next.framebuffer:null),h.cur=h.next,n.getError()}function p(e,t){function v(e,t){var r=0,n=0,i=!0,a=!0,o=null,s=!0,f="rgba",u="uint8",c=1,l=null,p=null,h=null,d=!1;"number"==typeof e?(r=0|e,n=0|t||r):e?("shape"in e?(r=(n=e.shape)[0],n=n[1]):("radius"in e&&(r=n=e.radius),"width"in e&&(r=e.width),"height"in e&&(n=e.height)),("color"in e||"colors"in e)&&(o=e.color||e.colors,Array.isArray(o)),o||("colorCount"in e&&(c=0|e.colorCount),"colorTexture"in e&&(s=!!e.colorTexture,f="rgba4"),"colorType"in e&&(u=e.colorType,!s)&&("half float"===u||"float16"===u?f="rgba16f":"float"!==u&&"float32"!==u||(f="rgba32f")),"colorFormat"in e&&(f=e.colorFormat,0<=E.indexOf(f)?s=!0:0<=T.indexOf(f)&&(s=!1))),("depthTexture"in e||"depthStencilTexture"in e)&&(d=!(!e.depthTexture&&!e.depthStencilTexture)),"depth"in e&&("boolean"==typeof e.depth?i=e.depth:(l=e.depth,a=!1)),"stencil"in e&&("boolean"==typeof e.stencil?a=e.stencil:(p=e.stencil,i=!1)),"depthStencil"in e&&("boolean"==typeof e.depthStencil?i=a=e.depthStencil:(h=e.depthStencil,a=i=!1))):r=n=1;var m=null,g=null,t=null,e=null;if(Array.isArray(o))m=o.map(w);else if(o)m=[w(o)];else for(m=Array(c),o=0;o<c;++o)m[o]=x(r,n,s,f,u);for(r=r||m[0].width,n=n||m[0].height,l?g=w(l):i&&!a&&(g=x(r,n,d,"depth","uint32")),p?t=w(p):a&&!i&&(t=x(r,n,!1,"stencil","uint8")),h?e=w(h):!l&&!p&&a&&i&&(e=x(r,n,d,"depth stencil","depth stencil")),i=null,o=0;o<m.length;++o)b(m[o]),m[o]&&m[o].texture&&(a=Qe[m[o].texture._texture.format]*Ye[m[o].texture._texture.type],null===i&&(i=a));return b(g),b(t),b(e),_(y),y.width=r,y.height=n,y.colorAttachments=m,y.depthAttachment=g,y.stencilAttachment=t,y.depthStencilAttachment=e,v.color=m.map(A),v.depth=A(g),v.stencil=A(t),v.depthStencil=A(e),v.width=y.width,v.height=y.height,k(y),v}var y=new c;return r.framebufferCount++,v(e,t),xe(v,{resize:function(e,t){var r=Math.max(0|e,1),n=Math.max(0|t||r,1);if(r===y.width&&n===y.height)return v;for(var i=y.colorAttachments,a=0;a<i.length;++a)f(i[a],r,n);return f(y.depthAttachment,r,n),f(y.stencilAttachment,r,n),f(y.depthStencilAttachment,r,n),y.width=v.width=r,y.height=v.height=n,k(y),v},_reglType:"framebuffer",_framebuffer:y,destroy:function(){l(y),_(y)},use:function(e){h.setFBO({framebuffer:v},e)}})}var h={cur:null,next:null,dirty:!1,setFBO:null},E=["rgba"],T=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&T.push("srgba"),e.ext_color_buffer_half_float&&T.push("rgba16f","rgb16f"),e.webgl_color_buffer_float&&T.push("rgba32f");var d=["uint8"];e.oes_texture_half_float&&d.push("half float","float16"),e.oes_texture_float&&d.push("float","float32");var m=0,g={};return xe(h,{getFramebuffer:function(e){return"function"==typeof e&&"framebuffer"===e._reglType&&(e=e._framebuffer)instanceof c?e:null},create:p,createCube:function(e){function s(e){var t={color:null},r=0,n=null,i="rgba",a="uint8",o=1;if("number"==typeof e?r=0|e:e?("shape"in e?r=e.shape[0]:("radius"in e&&(r=0|e.radius),"width"in e?r=0|e.width:"height"in e&&(r=0|e.height)),("color"in e||"colors"in e)&&(n=e.color||e.colors,Array.isArray(n)),n||("colorCount"in e&&(o=0|e.colorCount),"colorType"in e&&(a=e.colorType),"colorFormat"in e&&(i=e.colorFormat)),"depth"in e&&(t.depth=e.depth),"stencil"in e&&(t.stencil=e.stencil),"depthStencil"in e&&(t.depthStencil=e.depthStencil)):r=1,n)if(Array.isArray(n))for(e=[],i=0;i<n.length;++i)e[i]=n[i];else e=[n];else for(e=Array(o),n={radius:r,format:i,type:a},i=0;i<o;++i)e[i]=u.createCube(n);for(t.color=Array(e.length),i=0;i<e.length;++i)o=e[i],r=r||o.width,t.color[i]={target:34069,data:e[i]};for(i=0;i<6;++i){for(o=0;o<e.length;++o)t.color[o].target=34069+i;0<i&&(t.depth=f[0].depth,t.stencil=f[0].stencil,t.depthStencil=f[0].depthStencil),f[i]?f[i](t):f[i]=p(t)}return xe(s,{width:r,height:r,color:e})}var f=Array(6);return s(e),xe(s,{faces:f,resize:function(e){var t=0|e;if(t===s.width)return s;var r=s.color;for(e=0;e<r.length;++e)r[e].resize(t);for(e=0;e<6;++e)f[e].resize(t);return s.width=s.height=t,s},_reglType:"framebufferCube",destroy:function(){f.forEach(function(e){e.destroy()})}})},clear:function(){Te(g).forEach(l)},restore:function(){h.cur=null,h.next=null,h.dirty=!0,Te(g).forEach(function(e){e.framebuffer=n.createFramebuffer(),k(e)})}})}(h,S,R,U,V,O),q=be(h,C,S,R,B,F,0,N,{},z,L,P,I,j,e),C=ve(h,N,q.procs.poll,I),W=q.next,H=h.canvas,G=[],Q=[],Y=[],X=[e.onDestroy],J=null;function K(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function Z(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function $(e,t,r){var n,i=(r=35632===e?w:x)[t];return i||(n=v.str(t),i=g.createShader(e),g.shaderSource(i,n),g.compileShader(i),r[t]=i),i}function ee(e,t){this.id=k++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,b.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function te(e,t,r){var n=$(35632,e.fragId),i=$(35633,e.vertId);if(t=e.program=g.createProgram(),g.attachShader(t,n),g.attachShader(t,i),r)for(n=0;n<r.length;++n)i=r[n],g.bindAttribLocation(t,i[0],i[1]);g.linkProgram(t),i=g.getProgramParameter(t,35718),b.profile&&(e.stats.uniformsCount=i);var a=e.uniforms;for(n=0;n<i;++n)if(r=g.getActiveUniform(t,n))if(1<r.size)for(var o=0;o<r.size;++o){var s=r.name.replace("[0]","["+o+"]");Z(a,new K(s,v.id(s),g.getUniformLocation(t,s),r))}else Z(a,new K(r.name,v.id(r.name),g.getUniformLocation(t,r.name),r));for(i=g.getProgramParameter(t,35721),b.profile&&(e.stats.attributesCount=i),e=e.attributes,n=0;n<i;++n)(r=g.getActiveAttrib(t,n))&&Z(e,new K(r.name,v.id(r.name),g.getAttribLocation(t,r.name),r))}H&&(H.addEventListener("webglcontextlost",t,!1),H.addEventListener("webglcontextrestored",a,!1));var re=N.setFBO=o({framebuffer:Ae.define.call(null,1,"framebuffer")});return l(),d=xe(o,{clear:function(e){if("framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;t<6;++t)re(xe({framebuffer:e.framebuffer.faces[t]},e),s);else re(e,s);else s(0,e)},prop:Ae.define.bind(null,1),context:Ae.define.bind(null,2),this:Ae.define.bind(null,3),draw:o({}),buffer:function(e){return B.create(e,34962,!1,!1)},elements:function(e){return F.create(e,!1)},texture:U.create2D,cube:U.createCube,renderbuffer:V.create,framebuffer:N.create,framebufferCube:N.createCube,vao:z.createVAO,attributes:d,frame:f,on:function(e,t){var r;switch(e){case"frame":return f(t);case"lost":r=Q;break;case"restore":r=Y;break;case"destroy":r=X}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t){r[e]=r[r.length-1],r.pop();break}}}},limits:R,hasExtension:function(e){return 0<=R.extensions.indexOf(e.toLowerCase())},read:C,destroy:function(){G.length=0,i(),H&&(H.removeEventListener("webglcontextlost",t),H.removeEventListener("webglcontextrestored",a)),L.clear(),N.clear(),V.clear(),z.clear(),U.clear(),F.clear(),B.clear(),j&&j.clear(),X.forEach(function(e){e()})},_gl:h,_refresh:l,poll:function(){c(),j&&j.update()},now:p,stats:O}),e.onDone(null,d),d}},"object"==typeof r&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):n.createREGL=i()},{}],178:[function(e,t,r){var u=["manifest","onDone","onProgress","onError"],p=["type","src","stream","credentials","parser"],g=["onData","onDone"],v=0;function y(e){throw new Error("resl: "+e)}function b(e,t,r){Object.keys(e).forEach(function(e){t.indexOf(e)<0&&y('invalid parameter "'+e+'" in '+r)})}function w(e,t){this.state=v,this.ready=!1,this.progress=0,this.name=e,this.cancel=t}t.exports=function(r){"object"==typeof r&&r||y("invalid or missing configuration"),b(r,u,"config");var c=r.manifest;function e(e){if(e in r){var t=r[e];return"function"!=typeof t&&y('invalid callback "'+e+'"'),t}return null}"object"==typeof c&&c||y("missing manifest");var n=e("onDone");n||y("missing onDone() callback");var i=e("onProgress"),t=e("onError"),h={},a=v;function o(t){var r=t.name,e=t.stream,n="binary"===t.type,i=t.parser,a=new XMLHttpRequest,o=null,s=new w(r,function(){if(1===s.state||-1===s.state)return;a.onreadystatechange=null,a.abort(),s.state=-1});function f(){if(!(a.readyState<2||1===s.state||-1===s.state)){if(200!==a.status)return d('error loading resource "'+t.name+'"');if(2<a.readyState&&s.state===v){var e="binary"===t.type?a.response:a.responseText;if(i.data)try{o=i.data(e)}catch(e){return d(e)}else o=e}if(3<a.readyState&&s.state===v){if(i.done)try{o=i.done()}catch(e){return d(e)}s.state=1}h[r]=o,s.progress=.75*s.progress+.25,s.ready=t.stream&&!!o||1===s.state,m()}}return a.onreadystatechange=e?f:function(){4===a.readyState&&f()},n&&(a.responseType="arraybuffer"),t.credentials&&(a.withCredentials=!0),a.open("GET",t.src,!0),a.send(),s}function s(e,t){var r,n,i=e.name,a=e.parser,o=new w(i,function(){if(1===o.state||-1===o.state)return;o.state=-1,p(),t.src=""}),s=t;function f(){if(o.state===v)if(a.data)try{s=a.data(t)}catch(e){return d(e),0}else s=t}function u(e){f(),h[i]=s,e.lengthComputable?o.progress=Math.max(o.progress,e.loaded/e.total):o.progress=.75*o.progress+.25,m(i)}function c(){if(f(),o.state===v){if(a.done)try{s=a.done()}catch(e){return d(e)}o.state=1}o.progress=1,o.ready=!0,h[i]=s,p(),m("finish "+i)}function l(){d('error loading asset "'+i+'"')}function p(){e.stream&&t.removeEventListener("progress",u),"image"===e.type?t.addEventListener("load",c):t.addEventListener("canplay",c),t.removeEventListener("error",l)}return e.stream&&t.addEventListener("progress",u),"image"===e.type?t.addEventListener("load",c):(n=r=!1,t.addEventListener("loadedmetadata",function(){n=!0,r&&c()}),t.addEventListener("canplay",function(){r=!0,n&&c()})),t.addEventListener("error",l),e.credentials?t.crossOrigin="use-credentials":t.crossOrigin="anonymous",t.src=e.src,o}var l={text:o,binary:o,image:function(e){return s(e,document.createElement("img"))},video:function(e){return s(e,document.createElement("video"))},audio:function(e){return s(e,document.createElement("audio"))}},f=Object.keys(c).map(function(e){var n=c[e];function t(e,t){if(e in n.parser){var r=n.parser[e];return"function"!=typeof r&&y("invalid parser callback "+e+' for asset "'+e+'"'),r}return t}"string"==typeof n?n={src:n}:"object"==typeof n&&n||y('invalid asset definition "'+e+'"'),b(n,p,'asset "'+e+'"');var r,i,a,o,s,f,u={};return"parser"in n&&("function"==typeof n.parser?u={data:n.parser}:"object"==typeof n.parser&&n.parser?(b(u,g,'parser for asset "'+e+'"'),"onData"in u||y('missing onData callback for parser in asset "'+e+'"'),u={data:t("onData"),done:t("onDone")}):y('invalid parser for asset "'+e+'"')),{name:e,type:(o="type",s=Object.keys(l),f="text",o in n&&(f=n[o]),s.indexOf(f)<0&&y("invalid "+o+' "'+f+'" for asset "'+e+'", possible values: '+s),f),stream:!!n.stream,credentials:!!n.credentials,src:(i=!0,a="",(r="src")in n?a=n[r]:i&&y("missing "+r+' for asset "'+e+'"'),"string"!=typeof a&&y("invalid "+r+' for asset "'+e+'", must be a string'),a),parser:u}}).map(function(e){return l[e.type](e)});function d(e){-1!==a&&1!==a&&(a=-1,f.forEach(function(e){e.cancel()}),t?t("string"==typeof e?new Error("resl: "+e):e):console.error("resl error:",e))}function m(e){var t,r;-1!==a&&1!==a&&(r=t=0,f.forEach(function(e){e.ready&&(r+=1),t+=e.progress}),r===f.length?(a=1,n(h)):i&&i(t/f.length,e))}0===f.length&&setTimeout(function(){m("done")},1)}},{}],179:[function(e,t,r){"use strict";var u={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};u.localCName=u.generateIdentifier(),u.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},u.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},u.matchPrefix=function(e,t){return u.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},u.parseCandidate=function(e){for(var t=(0===e.indexOf("a=candidate:")?e.substring(12):e.substring(10)).split(" "),r={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;default:r[t[n]]=t[n+1]}return r},u.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},u.parseIceOptions=function(e){return e.substr(14).split(" ")},u.parseRtpMap=function(e){var t=e.substr(9).split(" "),e={payloadType:parseInt(t.shift(),10)},t=t[0].split("/");return e.name=t[0],e.clockRate=parseInt(t[1],10),e.numChannels=3===t.length?parseInt(t[2],10):1,e},u.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},u.parseExtmap=function(e){e=e.substr(9).split(" ");return{id:parseInt(e[0],10),direction:0<e[0].indexOf("/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},u.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},u.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},u.writeFmtp=function(t){var r,e="",n=t.payloadType;return void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length&&(r=[],Object.keys(t.parameters).forEach(function(e){r.push(e+"="+t.parameters[e])}),e+="a=fmtp:"+n+" "+r.join(";")+"\r\n"),e},u.parseRtcpFb=function(e){e=e.substr(e.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},u.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},u.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return-1<n?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},u.getMid=function(e){e=u.matchPrefix(e,"a=mid:")[0];if(e)return e.substr(6)},u.parseFingerprint=function(e){e=e.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},u.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:u.matchPrefix(e+t,"a=fingerprint:").map(u.parseFingerprint)}},u.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},u.getIceParameters=function(e,t){e=u.splitLines(e);return{usernameFragment:(e=e.concat(u.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:e.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},u.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},u.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=u.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var i=r[n],a=u.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){var o=u.parseRtpMap(a),a=u.matchPrefix(e,"a=fmtp:"+i+" ");switch(o.parameters=a.length?u.parseFmtp(a[0]):{},o.rtcpFeedback=u.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(u.parseRtcpFb),t.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(o.name.toUpperCase())}}}return u.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(u.parseExtmap(e))}),t},u.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=0<t.codecs.length?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=u.writeRtpMap(e),r+=u.writeFmtp(e),r+=u.writeRtcpFb(e)});var n=0;return t.codecs.forEach(function(e){e.maxptime>n&&(n=e.maxptime)}),0<n&&(r+="a=maxptime:"+n+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){r+=u.writeExtmap(e)}),r},u.parseRtpEncodingParameters=function(e){var t,r=[],n=u.parseRtpParameters(e),i=-1!==n.fecMechanisms.indexOf("RED"),a=-1!==n.fecMechanisms.indexOf("ULPFEC"),o=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),s=0<o.length&&o[0].ssrc,o=u.matchPrefix(e,"a=ssrc-group:FID").map(function(e){e=e.split(" ");return e.shift(),e.map(function(e){return parseInt(e,10)})});0<o.length&&1<o[0].length&&o[0][0]===s&&(t=o[0][1]),n.codecs.forEach(function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}},r.push(e),i&&((e=JSON.parse(JSON.stringify(e))).fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},r.push(e)))}),0===r.length&&s&&r.push({ssrc:s});var f=u.matchPrefix(e,"b=");return f.length&&(0===f[0].indexOf("b=TIAS:")?f=parseInt(f[0].substr(7),10):0===f[0].indexOf("b=AS:")&&(f=parseInt(f[0].substr(5),10)),r.forEach(function(e){e.maxBitrate=f})),r},u.parseRtcpParameters=function(e){var t={},r=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);r=u.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<r.length,t.compound=0===r.length;e=u.matchPrefix(e,"a=rtcp-mux");return t.mux=0<e.length,t},u.parseMsid=function(e){var t,r=u.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};e=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<e.length?{stream:(t=e[0].value.split(" "))[0],track:t[1]}:void 0},u.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},u.writeMediaSection=function(e,t,r,n){t=u.writeRtpDescription(e.kind,t);return t+=u.writeIceParameters(e.iceGatherer.getLocalParameters()),t+=u.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),t+="a=mid:"+e.mid+"\r\n",e.direction?t+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?t+="a=sendrecv\r\n":e.rtpSender?t+="a=sendonly\r\n":e.rtpReceiver?t+="a=recvonly\r\n":t+="a=inactive\r\n",e.rtpSender&&(t+="a="+(n="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n"),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+n,e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+n,t+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+"\r\n"),t},u.getDirection=function(e,t){for(var r=u.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?u.getDirection(t):"sendrecv"},u.getKind=function(e){return u.splitLines(e)[0].split(" ")[0].substr(2)},u.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.exports=u},{}],180:[function(e,t,r){"use strict";var u=e("parenthesis");t.exports=function(e,t,r){if(null==e)throw Error("First argument should be a string");if(null==t)throw Error("Separator should be a string or a RegExp");r?"string"!=typeof r&&!Array.isArray(r)||(r={ignore:r}):r={},null==r.escape&&(r.escape=!0),null==r.ignore?r.ignore=["[]","()","{}","<>",'""',"''","``","“”","«»"]:("string"==typeof r.ignore&&(r.ignore=[r.ignore]),r.ignore=r.ignore.map(function(e){return 1===e.length&&(e+=e),e}));var n=u.parse(e,{flat:!0,brackets:r.ignore}),i=n[0].split(t);if(r.escape){for(var a=[],o=0;o<i.length;o++){var s=i[o],f=i[o+1];"\\"===s[s.length-1]&&"\\"!==s[s.length-2]?(a.push(s+t+f),o++):a.push(s)}i=a}for(o=0;o<i.length;o++)n[0]=i[o],i[o]=u.stringify(n,{flat:!0});return i}},{parenthesis:173}],181:[function(e,t,r){"use strict";var n=e("parse-unit");t.exports=s;var i=o("in",document.body);function a(e,t){t=n(getComputedStyle(e).getPropertyValue(t));return t[0]*s(t[1],e)}function o(e,t){var r=document.createElement("div");r.style.height="128"+e,t.appendChild(r);e=a(r,"height")/128;return t.removeChild(r),e}function s(e,t){if(!e)return null;switch(t=t||document.body,e=(e+""||"px").trim().toLowerCase(),t!==window&&t!==document||(t=document.body),e){case"%":return t.clientHeight/100;case"ch":case"ex":return o(e,t);case"em":return a(t,"font-size");case"rem":return a(document.body,"font-size");case"vw":return window.innerWidth/100;case"vh":return window.innerHeight/100;case"vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case"vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case"in":return i;case"cm":return i/2.54;case"mm":return i/25.4;case"pt":return i/72;case"pc":return i/6;case"px":return 1}e=n(e);if(isNaN(e[0])||!e[1])return null;t=s(e[1],t);return"number"==typeof t?e[0]*t:null}},{"parse-unit":175}],182:[function(e,t,r){"use strict";var n=e("../prototype/is");t.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!n(e)}},{"../prototype/is":189}],183:[function(e,t,r){"use strict";function n(e,t){return e.replace("%v",s(t))}var i=e("../value/is"),a=e("../object/is"),o=e("../string/coerce"),s=e("./to-short-string");t.exports=function(e,t,r){if(!a(r))throw new TypeError(n(t,e));if(!i(e)){if("default"in r)return r.default;if(r.isOptional)return null}r=o(r.errorMessage);throw i(r)||(r=t),new TypeError(n(r,e))}},{"../object/is":186,"../string/coerce":190,"../value/is":192,"./to-short-string":185}],184:[function(e,t,r){"use strict";t.exports=function(t){try{return t.toString()}catch(e){try{return String(t)}catch(e){return null}}}},{}],185:[function(e,t,r){"use strict";var n=e("./safe-to-string"),i=/[\n\r\u2028\u2029]/g;t.exports=function(e){e=n(e);return null===e?"<Non-coercible to string value>":(100<e.length&&(e=e.slice(0,99)+"…"),e=e.replace(i,function(e){switch(e){case"\n":return"\\n";case"\r":return"\\r";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw new Error("Unexpected character")}}))}},{"./safe-to-string":184}],186:[function(e,t,r){"use strict";var n=e("../value/is"),i={object:!0,function:!0,undefined:!0};t.exports=function(e){return!!n(e)&&hasOwnProperty.call(i,typeof e)}},{"../value/is":192}],187:[function(e,t,r){"use strict";var n=e("../lib/resolve-exception"),i=e("./is");t.exports=function(e){return i(e)?e:n(e,"%v is not a plain function",arguments[1])}},{"../lib/resolve-exception":183,"./is":188}],188:[function(e,t,r){"use strict";var n=e("../function/is"),i=/^\s*class[\s{/}]/,a=Function.prototype.toString;t.exports=function(e){return!!n(e)&&!i.test(a.call(e))}},{"../function/is":182}],189:[function(e,t,r){"use strict";var n=e("../object/is");t.exports=function(e){if(!n(e))return!1;try{return e.constructor?e.constructor.prototype===e:!1}catch(e){return!1}}},{"../object/is":186}],190:[function(e,t,r){"use strict";var n=e("../value/is"),i=e("../object/is"),a=Object.prototype.toString;t.exports=function(e){if(!n(e))return null;if(i(e)){var t=e.toString;if("function"!=typeof t)return null;if(t===a)return null}try{return""+e}catch(e){return null}}},{"../object/is":186,"../value/is":192}],191:[function(e,t,r){"use strict";var n=e("../lib/resolve-exception"),i=e("./is");t.exports=function(e){return i(e)?e:n(e,"Cannot use %v",arguments[1])}},{"../lib/resolve-exception":183,"./is":192}],192:[function(e,t,r){"use strict";t.exports=function(e){return null!=e}},{}],193:[function(E,e,T){(function(k){(function(){"use strict";var r=E("bit-twiddle"),e=E("dup"),n=E("buffer").Buffer;k.__TYPEDARRAY_POOL||(k.__TYPEDARRAY_POOL={UINT8:e([32,0]),UINT16:e([32,0]),UINT32:e([32,0]),BIGUINT64:e([32,0]),INT8:e([32,0]),INT16:e([32,0]),INT32:e([32,0]),BIGINT64:e([32,0]),FLOAT:e([32,0]),DOUBLE:e([32,0]),DATA:e([32,0]),UINT8C:e([32,0]),BUFFER:e([32,0])});var t="undefined"!=typeof Uint8ClampedArray,i="undefined"!=typeof BigUint64Array,a="undefined"!=typeof BigInt64Array,o=k.__TYPEDARRAY_POOL;o.UINT8C||(o.UINT8C=e([32,0])),o.BIGUINT64||(o.BIGUINT64=e([32,0])),o.BIGINT64||(o.BIGINT64=e([32,0])),o.BUFFER||(o.BUFFER=e([32,0]));var s=o.DATA,f=o.BUFFER;function u(e){var t;e&&(t=e.length||e.byteLength,t=r.log2(t),s[t].push(e))}function c(e){var e=r.nextPow2(e),t=r.log2(e),t=s[t];return 0<t.length?t.pop():new ArrayBuffer(e)}function l(e){return new Uint8Array(c(e),0,e)}function p(e){return new Uint16Array(c(2*e),0,e)}function h(e){return new Uint32Array(c(4*e),0,e)}function d(e){return new Int8Array(c(e),0,e)}function m(e){return new Int16Array(c(2*e),0,e)}function g(e){return new Int32Array(c(4*e),0,e)}function v(e){return new Float32Array(c(4*e),0,e)}function y(e){return new Float64Array(c(8*e),0,e)}function b(e){return t?new Uint8ClampedArray(c(e),0,e):l(e)}function w(e){return i?new BigUint64Array(c(8*e),0,e):null}function x(e){return a?new BigInt64Array(c(8*e),0,e):null}function A(e){return new DataView(c(e),0,e)}function _(e){e=r.nextPow2(e);var t=r.log2(e),t=f[t];return 0<t.length?t.pop():new n(e)}T.free=function(e){var t;n.isBuffer(e)?f[r.log2(e.length)].push(e):("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),e&&(t=e.length||e.byteLength,t=0|r.log2(t),s[t].push(e)))},T.freeUint8=T.freeUint16=T.freeUint32=T.freeBigUint64=T.freeInt8=T.freeInt16=T.freeInt32=T.freeBigInt64=T.freeFloat32=T.freeFloat=T.freeFloat64=T.freeDouble=T.freeUint8Clamped=T.freeDataView=function(e){u(e.buffer)},T.freeArrayBuffer=u,T.freeBuffer=function(e){f[r.log2(e.length)].push(e)},T.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return c(e);switch(t){case"uint8":return l(e);case"uint16":return p(e);case"uint32":return h(e);case"int8":return d(e);case"int16":return m(e);case"int32":return g(e);case"float":case"float32":return v(e);case"double":case"float64":return y(e);case"uint8_clamped":return b(e);case"bigint64":return x(e);case"biguint64":return w(e);case"buffer":return _(e);case"data":case"dataview":return A(e);default:return null}return null},T.mallocArrayBuffer=c,T.mallocUint8=l,T.mallocUint16=p,T.mallocUint32=h,T.mallocInt8=d,T.mallocInt16=m,T.mallocInt32=g,T.mallocFloat32=T.mallocFloat=v,T.mallocFloat64=T.mallocDouble=y,T.mallocUint8Clamped=b,T.mallocBigUint64=w,T.mallocBigInt64=x,T.mallocDataView=A,T.mallocBuffer=_,T.clearCache=function(){for(var e=0;e<32;++e)o.UINT8[e].length=0,o.UINT16[e].length=0,o.UINT32[e].length=0,o.INT8[e].length=0,o.INT16[e].length=0,o.INT32[e].length=0,o.FLOAT[e].length=0,o.DOUBLE[e].length=0,o.BIGUINT64[e].length=0,o.BIGINT64[e].length=0,o.UINT8C[e].length=0,s[e].length=0,f[e].length=0}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"bit-twiddle":3,buffer:4,dup:25}],194:[function(e,t,r){var n=/[\'\"]/;t.exports=function(e){return e?(n.test(e.charAt(0))&&(e=e.substr(1)),n.test(e.charAt(e.length-1))&&(e=e.substr(0,e.length-1)),e):""}},{}],195:[function(o,s,e){"use strict";!function(){var e=o("./utils").log,t=o("./utils").browserDetails;s.exports.browserDetails=t,s.exports.extractVersion=o("./utils").extractVersion,s.exports.disableLog=o("./utils").disableLog;var r=o("./chrome/chrome_shim")||null,n=o("./edge/edge_shim")||null,i=o("./firefox/firefox_shim")||null,a=o("./safari/safari_shim")||null;switch(t.browser){case"opera":case"chrome":if(!r||!r.shimPeerConnection)return e("Chrome shim is not included in this adapter release.");e("adapter.js shimming chrome."),(s.exports.browserShim=r).shimGetUserMedia(),r.shimMediaStream(),r.shimSourceObject(),r.shimPeerConnection(),r.shimOnTrack();break;case"firefox":if(!i||!i.shimPeerConnection)return e("Firefox shim is not included in this adapter release.");e("adapter.js shimming firefox."),(s.exports.browserShim=i).shimGetUserMedia(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack();break;case"edge":if(!n||!n.shimPeerConnection)return e("MS edge shim is not included in this adapter release.");e("adapter.js shimming edge."),(s.exports.browserShim=n).shimGetUserMedia(),n.shimPeerConnection();break;case"safari":if(!a)return e("Safari shim is not included in this adapter release.");e("adapter.js shimming safari."),(s.exports.browserShim=a).shimGetUserMedia();break;default:e("Unsupported browser!")}}()},{"./chrome/chrome_shim":196,"./edge/edge_shim":198,"./firefox/firefox_shim":200,"./safari/safari_shim":202,"./utils":203}],196:[function(e,t,r){"use strict";var n=e("../utils.js").log,i=e("../utils.js").browserDetails,a={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var n=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(r){r.stream.addEventListener("addtrack",function(e){var t=new Event("track");t.track=e.track,t.receiver={track:e.track},t.streams=[r.stream],n.dispatchEvent(t)}),r.stream.getTracks().forEach(function(e){var t=new Event("track");t.track=e,t.receiver={track:e},t.streams=[r.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):this.src=""}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(e,t){n("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var t=new webkitRTCPeerConnection(e,t),s=t.getStats.bind(t);return t.getStats=function(r,e,t){var n=this,i=arguments;if(0<arguments.length&&"function"==typeof r)return s(r,e);function a(e){var n={};return e.result().forEach(function(t){var r={id:t.id,timestamp:t.timestamp,type:t.type};t.names().forEach(function(e){r[e]=t.stat(e)}),n[r.id]=r}),n}function o(t,r){var n=new Map(Object.keys(t).map(function(e){return[e,t[e]]}));return r=r||t,Object.keys(r).forEach(function(e){n[e]=r[e]}),n}if(2<=arguments.length)return s.apply(this,[function(e){i[1](o(a(e)))},r]);return new Promise(function(t,e){1===i.length&&"object"==typeof r?s.apply(n,[function(e){t(o(a(e)))},e]):s.apply(n,[function(e){t(o(a(e),e.result()))},e])}).then(e,t)},t},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var i=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var r=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(e,t){i.apply(r,[e,t,n])})}return i.apply(this,arguments)}}),i.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var i=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var r=arguments,n=this,e=new Promise(function(e,t){i.apply(n,[r[0],e,t])});return r.length<2?e:e.then(function(){r[1].apply(null,[])},function(e){3<=r.length&&r[2].apply(null,[e])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};t.exports={shimMediaStream:a.shimMediaStream,shimOnTrack:a.shimOnTrack,shimSourceObject:a.shimSourceObject,shimPeerConnection:a.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":203,"./getusermedia":197}],197:[function(e,t,r){"use strict";var o=e("../utils.js").log;t.exports=function(){function i(i){if("object"!=typeof i||i.mandatory||i.optional)return i;var a={};return Object.keys(i).forEach(function(t){var r,n,e;"require"!==t&&"advanced"!==t&&"mediaSource"!==t&&(void 0!==(r="object"==typeof i[t]?i[t]:{ideal:i[t]}).exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact),n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t},void 0!==r.ideal&&(a.optional=a.optional||[],e={},"number"==typeof r.ideal?(e[n("min",t)]=r.ideal,a.optional.push(e),(e={})[n("max",t)]=r.ideal):e[n("",t)]=r.ideal,a.optional.push(e)),void 0!==r.exact&&"number"!=typeof r.exact?(a.mandatory=a.mandatory||{},a.mandatory[n("",t)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(a.mandatory=a.mandatory||{},a.mandatory[n(e,t)]=r[e])}))}),i.advanced&&(a.optional=(a.optional||[]).concat(i.advanced)),a}function n(t,r){if((t=JSON.parse(JSON.stringify(t)))&&t.audio&&(t.audio=i(t.audio)),t&&"object"==typeof t.video){var n=(n=t.video.facingMode)&&("object"==typeof n?n:{ideal:n});if(n&&("user"===n.exact||"environment"===n.exact||"user"===n.ideal||"environment"===n.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete t.video.facingMode,"environment"===n.exact||"environment"===n.ideal))return navigator.mediaDevices.enumerateDevices().then(function(e){e=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(e){return-1!==e.label.toLowerCase().indexOf("back")})||e.length&&e[e.length-1];return e&&(t.video.deviceId=n.exact?{exact:e.deviceId}:{ideal:e.deviceId}),t.video=i(t.video),o("chrome: "+JSON.stringify(t)),r(t)});t.video=i(t.video)}return o("chrome: "+JSON.stringify(t)),r(t)}function a(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}}navigator.getUserMedia=function(e,t,r){n(e,function(e){navigator.webkitGetUserMedia(e,t,function(e){r(a(e))})})};function e(r){return new Promise(function(e,t){navigator.getUserMedia(r,e,t)})}var r;navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:e,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia?(r=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices),navigator.mediaDevices.getUserMedia=function(e){return n(e,function(t){return r(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(a(e))})})}):navigator.mediaDevices.getUserMedia=e,void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){o("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){o("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":203}],198:[function(e,t,r){"use strict";var C=e("sdp"),i=e("../utils").browserDetails,n={shimPeerConnection:function(){var r;window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e}),r=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled"),Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})),window.RTCPeerConnection=function(e){var t,r=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return r.localStreams},this.getRemoteStreams=function(){return r.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers&&(t=JSON.parse(JSON.stringify(e.iceServers)),this.iceOptions.iceServers=t.filter(function(e){if(e&&e.urls){e=e.urls;return"string"==typeof e&&(e=[e]),!!(e=e.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")||0===e.indexOf("stun:")&&14393<=i.version})[0])}return!1})),this._config=e,this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var r=this,n=C.splitSections(r.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(e){if(!e.candidate||0===Object.keys(e.candidate).length)for(var t=1;t<n.length;t++)-1===n[t].indexOf("\r\na=end-of-candidates\r\n")&&(n[t]+="a=end-of-candidates\r\n");else-1===e.candidate.candidate.indexOf("typ endOfCandidates")&&(n[e.candidate.sdpMLineIndex+1]+="a="+e.candidate.candidate+"\r\n");r.localDescription.sdp=n.join(""),r.dispatchEvent(e),null!==r.onicecandidate&&r.onicecandidate(e),e.candidate||"complete"===r.iceGatheringState||r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&(r.iceGatheringState="complete")}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.getConfiguration=function(){return this._config},window.RTCPeerConnection.prototype.addStream=function(e){var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),this.localStreams.push(n),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){e=this.localStreams.indexOf(e);-1<e&&(this.localStreams.splice(e,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,n){var i={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(r){for(var e=0;e<n.codecs.length;e++){var t=n.codecs[e];if(r.name.toLowerCase()===t.name.toLowerCase()&&r.clockRate===t.clockRate){t.numChannels=Math.min(r.numChannels,t.numChannels),i.codecs.push(t),t.rtcpFeedback=t.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var t=0;t<n.headerExtensions.length;t++){var r=n.headerExtensions[t];if(e.uri===r.uri){i.headerExtensions.push(r);break}}}),i},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(n,i){var a=this,o=new RTCIceGatherer(a.iceOptions),s=new RTCIceTransport(o);o.onlocalcandidate=function(e){var t=new Event("icecandidate");t.candidate={sdpMid:n,sdpMLineIndex:i};var r=e.candidate,e=!r||0===Object.keys(r).length;e?(void 0===o.state&&(o.state="completed"),t.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(r.component="RTCP"===s.component?2:1,t.candidate.candidate=C.writeCandidate(r));r=C.splitSections(a.localDescription.sdp);-1===t.candidate.candidate.indexOf("typ endOfCandidates")?r[t.candidate.sdpMLineIndex+1]+="a="+t.candidate.candidate+"\r\n":r[t.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",a.localDescription.sdp=r.join("");r=a.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(a.iceGatheringState){case"new":a._localIceCandidatesBuffer.push(t),e&&r&&a._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":a._emitBufferedCandidates(),a.dispatchEvent(t),null!==a.onicecandidate&&a.onicecandidate(t),r&&(a.dispatchEvent(new Event("icecandidate")),null!==a.onicecandidate&&a.onicecandidate(new Event("icecandidate")),a.iceGatheringState="complete")}},s.onicestatechange=function(){a._updateConnectionState()};var e=new RTCDtlsTransport(s);return e.ondtlsstatechange=function(){a._updateConnectionState()},e.onerror=function(){e.state="failed",a._updateConnectionState()},{iceGatherer:o,iceTransport:s,dtlsTransport:e}},window.RTCPeerConnection.prototype._transceive=function(e,t,r){var n=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(n.encodings=e.sendEncodingParameters,n.rtcp={cname:C.localCName},e.recvEncodingParameters.length&&(n.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(n)),r&&e.rtpReceiver&&("video"===e.kind&&e.recvEncodingParameters&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),n.encodings=e.recvEncodingParameters,n.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(n.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(n))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t,c,l,p=this;switch("offer"===e.type?this._pendingOffer&&(t=C.splitSections(e.sdp),c=t.shift(),t.forEach(function(e,t){e=C.parseRtpParameters(e);p._pendingOffer[t].localCapabilities=e}),this.transceivers=this._pendingOffer,delete this._pendingOffer):"answer"===e.type&&(t=C.splitSections(p.remoteDescription.sdp),c=t.shift(),l=0<C.matchPrefix(c,"a=ice-lite").length,t.forEach(function(e,t){var r,n,i=p.transceivers[t],a=i.iceGatherer,o=i.iceTransport,s=i.dtlsTransport,f=i.localCapabilities,u=i.remoteCapabilities;"0"===e.split("\n",1)[0].split(" ",2)[1]||i.isDatachannel||(r=C.getIceParameters(e,c),!l||(n=C.matchPrefix(e,"a=candidate:").map(function(e){return C.parseCandidate(e)}).filter(function(e){return"1"===e.component})).length&&o.setRemoteCandidates(n),e=C.getDtlsParameters(e,c),l&&(e.role="server"),p.usingBundle&&0!==t||(o.start(a,r,l?"controlling":"controlled"),s.start(e)),u=p._getCommonCapabilities(f,u),p._transceive(i,0<u.codecs.length,!1))})),this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var r,n=1<arguments.length&&"function"==typeof arguments[1];n&&(r=arguments[1],window.setTimeout(function(){r(),"new"===p.iceGatheringState&&(p.iceGatheringState="gathering"),p._emitBufferedCandidates()},0));e=Promise.resolve();return e.then(function(){n||("new"===p.iceGatheringState&&(p.iceGatheringState="gathering"),window.setTimeout(p._emitBufferedCandidates.bind(p),500))}),e},window.RTCPeerConnection.prototype.setRemoteDescription=function(x){var A=this,_=new MediaStream,k=[],e=C.splitSections(x.sdp),E=e.shift(),T=0<C.matchPrefix(E,"a=ice-lite").length;switch(this.usingBundle=0<C.matchPrefix(E,"a=group:BUNDLE ").length,e.forEach(function(e,t){var r,n,i,a,o,s,f,u,c,l,p,h,d,m,g=C.splitLines(e)[0].substr(2).split(" "),v=g[0],y="0"===g[1],b=C.getDirection(e,E),w=(w=C.matchPrefix(e,"a=mid:")).length?w[0].substr(6):C.generateIdentifier();"application"!==v||"DTLS/SCTP"!==g[2]?(f=C.parseRtpParameters(e),y||(u=C.getIceParameters(e,E),(c=C.getDtlsParameters(e,E)).role="client"),a=C.parseRtpEncodingParameters(e),(p=C.matchPrefix(e,"a=ssrc:").map(function(e){return C.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0])&&(l=p.value),h=0<C.matchPrefix(e,"a=end-of-candidates",E).length,g=C.matchPrefix(e,"a=candidate:").map(function(e){return C.parseCandidate(e)}).filter(function(e){return"1"===e.component}),"offer"!==x.type||y?"answer"!==x.type||y||(p=(d=A.transceivers[t]).iceGatherer,e=d.iceTransport,y=d.dtlsTransport,r=d.rtpSender,n=d.rtpReceiver,i=d.sendEncodingParameters,o=d.localCapabilities,A.transceivers[t].recvEncodingParameters=a,A.transceivers[t].remoteCapabilities=f,A.transceivers[t].cname=l,(T||h)&&g.length&&e.setRemoteCandidates(g),A.usingBundle&&0!==t||(e.start(p,u,"controlling"),y.start(c)),A._transceive(d,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!n||"sendrecv"!==b&&"sendonly"!==b?delete d.rtpReceiver:(s=n.track,k.push([s,n]),_.addTrack(s))):(d=A.usingBundle&&0<t?{iceGatherer:A.transceivers[0].iceGatherer,iceTransport:A.transceivers[0].iceTransport,dtlsTransport:A.transceivers[0].dtlsTransport}:A._createIceAndDtlsTransports(w,t),h&&d.iceTransport.setRemoteCandidates(g),(o=RTCRtpReceiver.getCapabilities(v)).codecs=o.codecs.filter(function(e){return"rtx"!==e.name}),i=[{ssrc:1001*(2*t+2)}],s=(n=new RTCRtpReceiver(d.dtlsTransport,v)).track,k.push([s,n]),_.addTrack(s),0<A.localStreams.length&&A.localStreams[0].getTracks().length>=t&&("audio"===v?m=A.localStreams[0].getAudioTracks()[0]:"video"===v&&(m=A.localStreams[0].getVideoTracks()[0]),m&&(r=new RTCRtpSender(m,d.dtlsTransport))),A.transceivers[t]={iceGatherer:d.iceGatherer,iceTransport:d.iceTransport,dtlsTransport:d.dtlsTransport,localCapabilities:o,remoteCapabilities:f,rtpSender:r,rtpReceiver:n,kind:v,mid:w,cname:l,sendEncodingParameters:i,recvEncodingParameters:a},A._transceive(A.transceivers[t],!1,"sendrecv"===b||"sendonly"===b))):A.transceivers[t]={mid:w,isDatachannel:!0}}),this.remoteDescription={type:x.type,sdp:x.sdp},x.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+x.type+'"')}return _.getTracks().length&&(A.remoteStreams.push(_),window.setTimeout(function(){var n=new Event("addstream");n.stream=_,A.dispatchEvent(n),null!==A.onaddstream&&window.setTimeout(function(){A.onaddstream(n)},0),k.forEach(function(e){var t=e[0],e=e[1],r=new Event("track");r.track=t,r.receiver=e,r.streams=[_],A.dispatchEvent(n),null!==A.ontrack&&window.setTimeout(function(){A.ontrack(r)},0)})},0)),1<arguments.length&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;e=new Event("signalingstatechange");this.dispatchEvent(e),null!==this.onsignalingstatechange&&this.onsignalingstatechange(e)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting||0<t.checking?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":(0<t.connected||0<t.completed)&&(e="connected"),e!==this.iceConnectionState&&(this.iceConnectionState=e,e=new Event("iceconnectionstatechange"),this.dispatchEvent(e),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(e))},window.RTCPeerConnection.prototype.createOffer=function(){var c=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");1===arguments.length&&"function"!=typeof arguments[0]?e=arguments[0]:3===arguments.length&&(e=arguments[2]);var t=[],r=0,n=0;if(this.localStreams.length&&(r=this.localStreams[0].getAudioTracks().length,n=this.localStreams[0].getVideoTracks().length),e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(r=e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(n=e.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){t.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?0<r:0<n}),"audio"===e.kind?r--:"video"===e.kind&&n--});0<r||0<n;)0<r&&(t.push({kind:"audio",wantReceive:!0}),r--),0<n&&(t.push({kind:"video",wantReceive:!0}),n--);var i=C.writeSessionBoilerplate(),l=[];t.forEach(function(e,t){var r,n,i=e.track,a=e.kind,o=C.generateIdentifier(),s=c.usingBundle&&0<t?{iceGatherer:l[0].iceGatherer,iceTransport:l[0].iceTransport,dtlsTransport:l[0].dtlsTransport}:c._createIceAndDtlsTransports(o,t),f=RTCRtpSender.getCapabilities(a);f.codecs=f.codecs.filter(function(e){return"rtx"!==e.name}),f.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var u=[{ssrc:1001*(2*t+1)}];i&&(r=new RTCRtpSender(i,s.dtlsTransport)),e.wantReceive&&(n=new RTCRtpReceiver(s.dtlsTransport,a)),l[t]={iceGatherer:s.iceGatherer,iceTransport:s.iceTransport,dtlsTransport:s.dtlsTransport,localCapabilities:f,remoteCapabilities:null,rtpSender:r,rtpReceiver:n,kind:a,mid:o,sendEncodingParameters:u,recvEncodingParameters:null}}),this.usingBundle&&(i+="a=group:BUNDLE "+l.map(function(e){return e.mid}).join(" ")+"\r\n"),t.forEach(function(e,t){t=l[t];i+=C.writeMediaSection(t,t.localCapabilities,"offer",c.localStreams[0])}),this._pendingOffer=l;var e=new RTCSessionDescription({type:"offer",sdp:i});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,e),Promise.resolve(e)},window.RTCPeerConnection.prototype.createAnswer=function(){var r=this,n=C.writeSessionBoilerplate();this.usingBundle&&(n+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(e){var t;e.isDatachannel?n+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n":(t=r._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities),n+=C.writeMediaSection(e,t,"answer",r.localStreams[0]))});var e=new RTCSessionDescription({type:"answer",sdp:n});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,e),Promise.resolve(e)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var r=0;r<this.transceivers.length;r++)if(this.transceivers[r].mid===e.sdpMid){t=r;break}var n=this.transceivers[t];if(n){var i=0<Object.keys(e.candidate).length?C.parseCandidate(e.candidate):{};if("tcp"===i.protocol&&(0===i.port||9===i.port))return;if("1"!==i.component)return;"endOfCandidates"===i.type&&(i={}),n.iceTransport.addRemoteCandidate(i);n=C.splitSections(this.remoteDescription.sdp);n[t+1]+=(i.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=n.join("")}}else this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});return 1<arguments.length&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var n=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){t[e]&&n.push(t[e].getStats())})});var i=1<arguments.length&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(t){var r=new Map;Promise.all(n).then(function(e){e.forEach(function(t){Object.keys(t).forEach(function(e){r.set(e,t[e]),r[e]=t[e]})}),i&&window.setTimeout(i,0,r),t(r)})})}}};t.exports={shimPeerConnection:n.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":203,"./getusermedia":199,sdp:179}],199:[function(e,t,r){"use strict";t.exports=function(){var t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e).catch(function(e){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(e=e).name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}})})}}},{}],200:[function(e,t,r){"use strict";var s=e("../utils").browserDetails,n={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(r){r.stream.getTracks().forEach(function(e){var t=new Event("track");t.track=e,t.receiver={track:e},t.streams=[r.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){var e,n;"object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)&&(window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(s.version<38&&e&&e.iceServers){for(var r=[],n=0;n<e.iceServers.length;n++){var i=e.iceServers[n];if(i.hasOwnProperty("urls"))for(var a=0;a<i.urls.length;a++){var o={url:i.urls[a]};0===i.urls[a].indexOf("turn")&&(o.username=i.username,o.credential=i.credential),r.push(o)}else r.push(e.iceServers[n])}e.iceServers=r}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}}),e=RTCPeerConnection.prototype.addIceCandidate,RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())},s.version<48&&(n=RTCPeerConnection.prototype.getStats,RTCPeerConnection.prototype.getStats=function(e,t,r){return n.apply(this,[e||null]).then(function(e){return t=e,r=new Map,Object.keys(t).forEach(function(e){r.set(e,t[e]),r[e]=t[e]}),r;var t,r}).then(t,r)}))}};t.exports={shimOnTrack:n.shimOnTrack,shimSourceObject:n.shimSourceObject,shimPeerConnection:n.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":203,"./getusermedia":201}],201:[function(e,t,r){"use strict";var a=e("../utils").log,o=e("../utils").browserDetails;t.exports=function(){function i(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}}function n(e,t,r){function n(n){if("object"!=typeof n||n.require)return n;var i=[];return Object.keys(n).forEach(function(e){var t,r;"require"!==e&&"advanced"!==e&&"mediaSource"!==e&&(void 0===(t=n[e]="object"==typeof n[e]?n[e]:{ideal:n[e]}).min&&void 0===t.max&&void 0===t.exact||i.push(e),void 0!==t.exact&&("number"==typeof t.exact?t.min=t.max=t.exact:n[e]=t.exact,delete t.exact),void 0!==t.ideal&&(n.advanced=n.advanced||[],r={},"number"==typeof t.ideal?r[e]={min:t.ideal,max:t.ideal}:r[e]=t.ideal,n.advanced.push(r),delete t.ideal,Object.keys(t).length||delete n[e]))}),i.length&&(n.require=i),n}return e=JSON.parse(JSON.stringify(e)),o.version<38&&(a("spec: "+JSON.stringify(e)),e.audio&&(e.audio=n(e.audio)),e.video&&(e.video=n(e.video)),a("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,function(e){r(i(e))})}var e,r;navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:function(r){return new Promise(function(e,t){n(r,e,t)})},addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},o.version<41&&(e=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices),navigator.mediaDevices.enumerateDevices=function(){return e().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}),o.version<49&&(r=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices),navigator.mediaDevices.getUserMedia=function(t){return r(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(e){return Promise.reject(i(e))})}),navigator.getUserMedia=function(e,t,r){if(o.version<44)return n(e,t,r);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(t,r)}}},{"../utils":203}],202:[function(e,t,r){"use strict";var n={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};t.exports={shimGetUserMedia:n.shimGetUserMedia}},{}],203:[function(e,t,r){"use strict";var n=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e)?"adapter.js logging disabled":"adapter.js logging enabled"},log:function(){"object"==typeof window&&(n||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments))},extractVersion:function(e,t,r){t=e.match(t);return t&&t.length>=r&&parseInt(t[r],10)},detectBrowser:function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return e}};t.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion}},{}],204:[function(n,e,t){var u=n("regl")({pixelRatio:1}),c=n("gl-mat4/perspective"),l=n("gl-mat4/lookAt"),i=n("gl-text"),a=n("mouse-change")();e.exports={execute:function(){var e,r,t=new i(u);t.update({position:[100,100],text:"Click to play music",font:"30px Impact, sans-serif",color:"#A9A9A9"}),t.render(),e=function(e){return a.buttons},r=function(t){e()?t():setTimeout(function(e){return r(t)},25)},new Promise(r).then(function(e){n("resl")({manifest:{song:{type:"audio",src:"../assets/audio/dontFlySpirit.mp3",stream:!0}},onDone:function(e){var t=e.song,r=new AudioContext,e=r.createMediaElementSource(t),n=r.createAnalyser();e.connect(n),e.connect(r.destination),t.play();var i=u.texture({data:new Uint8Array(16384).fill(128),radius:128,channels:1,min:"linear",mag:"linear",wrap:"repeat"}),a=u.texture({width:32,height:1,channels:4,min:"linear",mag:"linear",wrap:"repeat"}),o=u({vert:"\n          precision highp float;\n          #define N float(128)\n          #define WEIGHT1 vec4(-1.0, 8.0, -8.0, 1.0)\n          #define WEIGHT2 vec4(-1.0, 16.0, 16.0, -1.0)\n          attribute vec2 vertId;\n          uniform float t;\n          uniform mat4 projection, view;\n          uniform vec3 lightPosition;\n          uniform float offsetRow;\n          uniform sampler2D terrain, color;\n          varying vec3 grad, fragColor, eyeDir, lightDir;\n          varying float curvature;\n          float f(vec2 x) {\n            return 0.025 * pow(texture2D(terrain, x).r, 2.0) *\n              (1.0 + 2.5 * pow(texture2D(color, vec2(x.y, 0.0)).a, 3.0));\n          }\n          vec4 stencil(vec2 x, vec2 d) {\n            return vec4(\n              f(x - 2.0 * d),\n              f(x - d),\n              f(x + d),\n              f(x + 2.0 * d));\n          }\n          void main () {\n            vec2 uv = (vertId + vec2(0.0, offsetRow)) / N;\n            float h0 = f(uv);\n            vec4 hx = stencil(uv, vec2(1.0 / N, 0.0));\n            vec4 hy = stencil(uv, vec2(0.0, 1.0 / N));\n            grad = normalize(vec3(\n              dot(WEIGHT1, hx),\n              dot(WEIGHT1, hy),\n              0.025));\n            curvature =\n              max(max((dot(WEIGHT2, hx) - 30.0 * h0),\n                  (dot(WEIGHT2, hy) - 30.0 * h0)), 0.0);\n            vec3 pos = vec3(vertId / N, h0 + 0.4);\n            lightDir = lightPosition - pos;\n            vec4 viewPos = view * vec4(pos, 1);\n            gl_Position = projection * viewPos;\n            eyeDir = viewPos.xyz / viewPos.w;\n            vec3 audioColor = texture2D(color, vec2(uv.y, 0)).rgb;\n            float minC = 0.9 * min(min(audioColor.r, audioColor.g), audioColor.b);\n            float maxC = max(max(audioColor.r, audioColor.g), audioColor.b);\n            fragColor = (audioColor - minC) / (maxC - minC);\n          }",frag:"\n          precision highp float;\n          varying vec3 grad, fragColor, eyeDir, lightDir;\n          varying float curvature;\n          void main () {\n            vec3 N = normalize(grad);\n            vec3 V = normalize(eyeDir);\n            vec3 L = normalize(lightDir);\n            vec3 H = normalize(V + L);\n            float ao = 1.0 - curvature;\n            float diffuse = max(dot(L, N), 0.0);\n            float fresnel = 0.1 + 0.5 * pow(1.0 - max(dot(H, V), 0.0), 5.0);\n            float light = 0.25 * ao + 0.8 * diffuse + fresnel;\n            gl_FragColor = vec4(light * fragColor, 1);\n          }",attributes:{vertId:Array(65536).fill().map(function(e,t){var r=.5*Math.floor(t/256),t=t%256*.5;return[r,t,.5+r,t,r,.5+t,r,.5+t,.5+r,.5+t,.5+r,t]})},uniforms:{offsetRow:function(e){return e.tick%128},terrain:i,projection:function(e){var t=e.viewportWidth,e=e.viewportHeight;return c([],Math.PI/4,t/e,.01,1e3)},view:function(e){e=e.tick;return l([],[.5+.2*Math.cos(.001*e),1,.7+.2*Math.cos(.003*e+2.4)],[.5,0,0],[0,0,1])},lightPosition:function(e){e=e.tick;return[.5+Math.sin(.01*e),1+Math.cos(.01*e),1+.6*Math.cos(.04*e)]},color:a,t:function(e){return.01*e.tick}},elements:null,instances:-1,count:393216}),s={width:128,height:1,data:new Uint8Array(128)},f=new Uint8Array(128);u.frame(function(e){e=e.tick%128;u.clear({color:[0,0,0,1],depth:1}),n.getByteTimeDomainData(s.data),i.subimage(s,0,e),n.getByteFrequencyData(f),a.subimage(f),o()})}})})}}},{"gl-mat4/lookAt":106,"gl-mat4/perspective":109,"gl-text":119,"mouse-change":170,regl:177,resl:178}],205:[function(e,t,r){var i=e("regl")();t.exports={execute:function(){var e=Array(1048576).fill(0).map(function(){return.9<Math.random()?255:0}),t=Array(2).fill().map(function(){return i.framebuffer({color:i.texture({radius:512,data:e,wrap:"repeat"}),depthStencil:!1})}),r=i({frag:"\n        precision mediump float;\n        uniform sampler2D prevState;\n        varying vec2 uv;\n        void main() {\n            float n = 0.0;\n            for(int dx=-1; dx<=1; ++dx)\n            for(int dy=-1; dy<=1; ++dy) {\n            n += texture2D(prevState, uv+vec2(dx,dy)/float(512)).r;\n            }\n            float s = texture2D(prevState, uv).r;\n            if(n > 3.0+s || n < 3.0) {\n            gl_FragColor = vec4(0,0,0,1);\n            } else {\n            gl_FragColor = vec4(1,1,1,1);\n            }\n        }",framebuffer:function(e){e=e.tick;return t[(e+1)%2]}}),n=i({frag:"\n        precision mediump float;\n        uniform sampler2D prevState;\n        varying vec2 uv;\n        void main() {\n            float state = texture2D(prevState, uv).r;\n            gl_FragColor = vec4(vec3(state), 1);\n        }",vert:"\n        precision mediump float;\n        attribute vec2 position;\n        varying vec2 uv;\n        void main() {\n            uv = 0.5 * (position + 1.0);\n            gl_Position = vec4(position, 0, 1);\n        }",attributes:{position:[-4,-4,4,-4,0,4]},uniforms:{prevState:function(e){e=e.tick;return t[e%2]}},depth:{enable:!1},count:3});i.frame(function(){n(function(){i.draw(),r()})})}}},{regl:177}],206:[function(e,t,r){var o=e("regl")();t.exports={execute:function(){e("getusermedia")({audio:!0},function(e,t){var r,n,i,a;e||(e=new AudioContext,r=e.createAnalyser(),e.createMediaStreamSource(t).connect(r),t=r.frequencyBinCount,n=new Uint8Array(t),i=o.buffer({length:t,type:"uint8",usage:"dynamic"}),a=o({vert:"\n            precision mediump float;\n            #define FFT_SIZE "+t+"\n            #define PI "+Math.PI+"\n            attribute float index, frequency;\n            void main() {\n                float theta = 2.0 * PI * index / float(FFT_SIZE);\n                gl_Position = vec4(\n                0.5 * cos(theta) * (1.0 + frequency),\n                0.5 * sin(theta) * (1.0 + frequency),\n                0,\n                1);\n            }",frag:"\n            void main() {\n                gl_FragColor = vec4(1, 1, 1, 1);\n            }",attributes:{index:Array(t).fill().map(function(e,t){return t}),frequency:{buffer:i,normalized:!0}},elements:null,instances:-1,lineWidth:1,depth:{enable:!1},count:t,primitive:"line loop"}),o.frame(function(e){e.tick;o.clear({color:[0,0,0,1],depth:1}),r.getByteFrequencyData(n),i.subdata(n),a()}))})}}},{getusermedia:88,regl:177}],207:[function(e,t,r){var n=e("regl")(),i=e("gl-mat4"),a=e("hsv2rgb");t.exports={name:"pong",execute:function(){var e=n.buffer(Array(1e4).fill().map(function(){var e=a(360*Math.random(),.7,1);return[10*Math.random(),10*Math.random(),10*Math.random(),10*Math.random(),2*Math.PI*Math.random(),2*Math.PI*Math.random(),2*Math.PI*Math.random(),2*Math.PI*Math.random(),e[0]/255,e[1]/255,e[2]/255]})),r=Math.random()*Math.floor(4)+3,t=n({vert:"\n      precision mediump float;\n      attribute vec4 freq, phase;\n      attribute vec3 color;\n      uniform float time;\n      uniform mat4 view, projection;\n      varying vec3 fragColor;\n      void main() {\n        vec3 position = 8.0 * cos(freq.xyz * time + phase.xyz);\n        gl_PointSize = 5.0 * (1.0 + cos(freq.w * time + phase.w));\n        gl_Position = projection * view * vec4(position, 1);\n        fragColor = color;\n      }",frag:"\n      precision lowp float;\n      varying vec3 fragColor;\n      void main() {\n        if (length(gl_PointCoord.xy - 0.5) > 0.5) {\n          discard;\n        }\n        gl_FragColor = vec4(fragColor, 1);\n      }",attributes:{freq:{buffer:e,stride:44,offset:0},phase:{buffer:e,stride:44,offset:16},color:{buffer:e,stride:44,offset:32}},uniforms:{view:function(e){e=.01*e.tick;return i.lookAt([],[30*Math.cos(e),2.5,30*Math.sin(e)],[0,0,0],[0,1,0])},projection:function(e){var t=e.viewportWidth,e=e.viewportHeight;return i.perspective([],Math.PI/r,t/e,.01,1e3)},time:function(e){return.001*e.tick}},count:1e4,primitive:"points"});n.frame(function(){n.clear({depth:1,color:[0,0,0,1]}),t()})}}},{"gl-mat4":104,hsv2rgb:167,regl:177}],208:[function(w,e,t){var x=w("regl")(),A=w("gl-vec2");e.exports={execute:function(){var o=null;function e(e,t){this.c=A.fromValues(e[0],e[1]),this.r=A.fromValues(t[0],t[1])}w("mouse-change")(function(e,t,r){o=r});var s=new e([-.9,0],[.03,.15]),f=new e([.9,0],[.03,.15]),u=new e([0,0],[.005,1]),c=new e([0,0],[0,0]),l=A.fromValues(0,0),a=new AudioContext;function p(e,t,r){return t<r?e<t?t:r<e?r:e:e<r?r:t<e?t:e}function h(e,t,r){var n=e.c[0]-t.c[0]-(e.r[0]+t.r[0]),i=-(e.c[0]-t.c[0])-(e.r[0]+t.r[0]);if(0<n||0<i)return!1;var a=e.c[1]-t.c[1]-r*(e.r[1]+t.r[1]),t=-(e.c[1]-t.c[1])-r*(e.r[1]+t.r[1]);return!(0<a||0<t)&&(i<n&&a<n&&t<n?A.fromValues(-1,0):n<i&&a<i&&t<i?A.fromValues(1,0):n<a&&i<a&&t<a?A.fromValues(0,-1):n<t&&i<t&&a<t?A.fromValues(0,1):void 0)}function i(e,t){return Math.random()*(t-e)+e}function d(e){c.c=[0,0],c.r=[.02,.02];var t=i(.3,.4);l=(e=e?i(Math.PI-1.2,Math.PI+1.2):i(-1.2,1.2),[t*Math.cos(e),t*Math.sin(e)])}function t(e,t){for(var r=a.sampleRate*e,n=a.createBuffer(2,r,a.sampleRate),i=0;i<2;i++)t(n.getChannelData(i),r);return n}function m(e){var t=a.createBufferSource();t.buffer=e,t.connect(a.destination),t.start()}var r=[];r[0]=t(.15,function(e,t){for(var r=.1,n=0;n<t;n++)n%100==0&&(r*=-1),e[n]=r*(1-n/t)}),r[1]=t(.15,function(e,t){for(var r=.1,n=0;n<t;n++)n%150==0&&(r*=-1),e[n]=r*(1-n/t)});var g=t(.4,function(e,t){for(var r=.1,n=50,i=0;i<t;i++){i%n==0&&(r*=-1),i%600==0&&(n-=2);var a=i/t;e[i]=r*(1-a)}}),v=t(.5,function(e,t){for(var r=i(-.1,.1),n=0;n<t;n++)n%150==0&&(r=i(-.1,.1)),e[n]=r*(1-n/t)}),n=0;function y(e,t){m(r[n]),n=(n+1)%2;return A.subtract(e,e,A.scale([0,0],t,2.1*A.dot(e,t)))}var b=x({frag:"\n            precision mediump float;\n            void main() {\n            gl_FragColor = vec4(1.0);\n            }",vert:"\n        precision mediump float;\n        attribute vec2 position;\n        uniform vec2 offset;\n        uniform vec2 scale;\n        uniform float viewportWidth;\n        uniform float viewportHeight;\n        void main() {\n            // windows ratio scaling factor.\n            float r = (viewportWidth) / (viewportHeight);\n            gl_Position = vec4(position.xy * scale * vec2(1.0, r) + offset, 0, 1);\n        }",attributes:{position:[[-1,-1],[1,1],[-1,1],[-1,-1],[1,-1],[1,1]]},uniforms:{offset:function(e,t){return t.aabb.c},scale:function(e,t){return t.aabb.r},viewportWidth:x.context("viewportWidth"),viewportHeight:x.context("viewportHeight")},depth:{enable:!1},cull:{enable:!0},count:6});d(!0),x.frame(function(e){var t=e.viewportWidth,r=e.viewportHeight,n=e.pixelRatio;x.clear({color:[0,0,0,1]});var i=t/r,e=s.r[1]*i-1,t=1-s.r[1]*i;null!==o&&(a=1-o*n/r,s.c[1]=p(2*a-1,e,t));var a=c.c[1]-f.c[1];f.c[1]=p(f.c[1]+.017*a*1.9,e,t),A.scaleAndAdd(c.c,c.c,l,.017),1<=c.c[1]+i*c.r[1]&&(l=y(l,A.fromValues(0,-1))),1<=c.c[0]+c.r[0]&&(m(g),d(!0)),c.c[1]-i*c.r[1]<=-1&&(l=y(l,A.fromValues(0,1))),c.c[0]-c.r[0]<=-1&&(m(v),d(!1));t=h(f,c,i);!1!==t&&(l=y(l,t)),!1!==(t=h(s,c,i))&&(l=y(l,t)),b([{aabb:s},{aabb:f},{aabb:u},{aabb:c}])})}}},{"gl-vec2":139,"mouse-change":170,regl:177}],209:[function(e,t,r){var d=e("regl")({extensions:"OES_texture_float"}),m=e("mouse-change")();t.exports={execute:function(){var s=Array(2).fill().map(function(){return d.framebuffer({radius:512,colorType:"float",depthStencil:!1})}),f=d({vert:"\n            precision mediump float;\n            attribute vec2 position;\n            void main () {\n            gl_Position = vec4(position, 0, 1);\n            }\n            ",frag:"\n            precision highp float;\n            uniform sampler2D state;\n            uniform float shapeX, shapeY, deltaT, gravity;\n            void main () {\n            vec2 shape = vec2(shapeX, shapeY);\n            vec4 prevState = texture2D(state,\n                gl_FragCoord.xy / shape);\n            vec2 position = prevState.xy;\n            vec2 velocity = prevState.zw;\n            position += 0.5 * velocity * deltaT;\n            if (position.x < -1.0 || position.x > 1.0) {\n                velocity.x *= -1.0;\n            }\n            if (position.y < -1.0 || position.y > 1.0) {\n                velocity.y *= -1.0;\n            }\n            position += 0.5 * velocity * deltaT;\n            velocity.y = velocity.y + gravity * deltaT;\n            gl_FragColor = vec4(position, velocity);\n            }\n            ",depth:{enable:!1},framebuffer:function(e){e=e.tick;return s[(e+3)%2]},uniforms:{state:function(e){e=e.tick;return s[e%2]},shapeX:d.context("viewportWidth"),shapeY:d.context("viewportHeight"),deltaT:.1,gravity:-.5},attributes:{position:[0,-4,4,4,-4,4]},primitive:"triangles",elements:null,offset:0,count:3}),u=d({vert:"\n            precision highp float;\n            attribute vec2 sprite;\n            uniform sampler2D state;\n            varying vec2 rg;\n            void main () {\n            vec2 position = texture2D(state, sprite).xy;\n            gl_PointSize = 16.0;\n            rg = sprite;\n            gl_Position = vec4(position, 0, 1);\n            }\n            ",frag:"\n            precision highp float;\n            varying vec2 rg;\n            void main () {\n            gl_FragColor = vec4(rg, 1.0 - max(rg.x, rg.y), 1);\n            }\n            ",attributes:{sprite:Array(262144).fill().map(function(e,t){return[t%512/512,(t/512|0)/512]}).reverse()},uniforms:{state:function(e){e=e.tick;return s[e%2]}},primitive:"points",offset:function(e,t){return 262144-t.count},elements:null,count:d.prop("count")}),c=0,l={data:new Float32Array(256),width:64,height:1},p=document.createElement("div");function h(e,t,r){return Math.min(Math.max(2*r*e/t-1,-.999),.999)}Object.assign(p.style,{color:"white",position:"absolute",left:"20px",top:"20px","z-index":20}),document.body.appendChild(p),d.frame(function(e){var t=e.tick,r=e.drawingBufferWidth,n=e.drawingBufferHeight,e=e.pixelRatio,i=h(m.x,r,e),a=-h(m.y,n,e);if(m.buttons){for(var o=0;o<64;++o)l.data[4*o]=i,l.data[4*o+1]=a,l.data[4*o+2]=.25*(Math.random()-.5),l.data[4*o+3]=Math.random();s[t%2].color[0].subimage(l,c%512,(c/512|0)%512),c+=64,p.innerText=Math.min(c,262144)}f(),d.clear({color:[0,0,0,1],depth:1}),u({count:Math.min(c,262144)})})}}},{"mouse-change":170,regl:177}],210:[function(e,t,r){var i=e("regl")({extensions:["angle_instanced_arrays"]});t.exports={execute:function(){for(var t=[],e=0;e<100;e++)t[e]=Math.random()*(2*Math.PI);var r=i.buffer({length:4*t.length,type:"float",usage:"dynamic"}),n=i({frag:"\n        precision mediump float;\n        varying vec3 vColor;\n        void main() {\n            gl_FragColor = vec4(vColor, 1.0);\n        }",vert:"\n        precision mediump float;\n        attribute vec2 position;\n        // These three are instanced attributes.\n        attribute vec3 color;\n        attribute vec2 offset;\n        attribute float angle;\n        varying vec3 vColor;\n        void main() {\n            gl_Position = vec4(\n            cos(angle) * position.x + sin(angle) * position.y + offset.x,\n                -sin(angle) * position.x + cos(angle) * position.y + offset.y, 0, 1);\n            vColor = color;\n        }",attributes:{position:[[0,-.05],[-.05,0],[.05,.05]],offset:{buffer:i.buffer(Array(100).fill().map(function(e,t){return[2*Math.floor(t/10)/10-1+.1,t%10*2/10-1+.1]})),divisor:1},color:{buffer:i.buffer(Array(100).fill().map(function(e,t){var r=Math.floor(t/10)/10,t=t%10/10;return[r,t,r*t+.7]})),divisor:1},angle:{buffer:r,divisor:1}},depth:{enable:!1},count:3,instances:100});i.frame(function(){i.clear({color:[0,0,0,1]});for(var e=0;e<100;e++)t[e]+=.02;r.subdata(t),n()})}}},{regl:177}]},{},[1]);
</script>
</html>
